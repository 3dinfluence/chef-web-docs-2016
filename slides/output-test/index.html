<!DOCTYPE html>


<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title align="left">Slide Deck &mdash; Slide Deck</title>

    

    
<link rel="stylesheet" href="_static/css/reveal.min.css">
<link rel="stylesheet" href="_static/css/theme/default.css" id="theme">
<link rel="stylesheet" href="_static/lib/css/zenburn.css">
<link rel="stylesheet" href="_static/revealjs.css" type="text/css" />

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
        if(window.location.search.match(/print-pdf/gi)) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = '_static/css/print/pdf.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        }
    </script>

    <!--[if lt IE 9]>
    <script src="_static/lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="reveal">
      <div class="slides" align="left">
        
  <div class="section" id="slide-deck">
<h1>Slide Deck<a class="headerlink" href="#slide-deck" title="Permalink to this headline">Â¶</a></h1>
<section>
<h2>First Slide!</h2>
<p class="first">The first slide in the deck should be splashy, and with a better image than this one.</p>
<img alt="_images/chef_run_landscape_300dpi.png" class="last align-center" src="_images/chef_run_landscape_300dpi.png" />
</section>
<section>
<h2>Introductions</h2>
<p class="first">Use this slide to introduce a section of slides. A simple, concise statement that is followed by a few short bullets is all that is necessary. For example, chef-slides uses a very small subset of the Sphinx directive set, including:</p>
<ul class="last simple">
<li>Paragraphs, including bold, italics, and code.</li>
<li>Ordered and unordered lists.</li>
<li>Fully qualified URLs, e.g. <a class="reference external" href="http://chef.io">http://chef.io</a>.</li>
<li>Code blocks, both by themselves and within ordered lists.</li>
<li>Images. Used well, images are terrific! Used poorly, well ...</li>
<li>List-tables, which are tables built using an unordered list and whitespace.</li>
</ul>
</section>
<section>
<h2>Text</h2>
<p class="first">A paragraph is a series of sentences. You can add <em>emphasis</em> to words, make them <strong>bolder</strong> if necessary, and also highlight code <tt class="docutils literal"><span class="pre">5tr!ng+</span></tt> that may need to appear in paragraphs.</p>
<p>If a bulleted or numbered list doesn&#8217;t work, use additional paragraphs in the slide to help display the information.</p>
<p>Obviously, text can contain ordered and unordered lists.</p>
<ul class="simple">
<li>foo</li>
<li>bar</li>
</ul>
<p>and</p>
<ol class="arabic simple">
<li>foo</li>
<li>bar</li>
</ol>
<p class="last">Just use the white space in the source slide to ensure readability.</p>
</section>
<section>
<h2>Ordered Lists</h2>
<p class="first">This is an ordered list:</p>
<ol class="arabic simple">
<li>first item</li>
<li>second item</li>
<li>third item third item third item third item third item third item third item third item third item third item third item third item</li>
<li>fourth item</li>
</ol>
<p>Here&#8217;s the code:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span class="no">This</span> <span class="n">is</span> <span class="n">an</span> <span class="n">ordered</span> <span class="ss">list</span><span class="p">:</span>

<span class="c1">#. first item</span>
<span class="c1">#. second item</span>
<span class="c1">#. third item ...</span>
</pre></div>
</div>
</section>
<section>
<h2>Unordered Lists</h2>
<p class="first">This is an unordered list:</p>
<ul class="last simple">
<li>first item</li>
<li>second item</li>
<li>third item</li>
</ul>
</section>
<section>
<h2>Links</h2>
<p class="first">There are three types of links:</p>
<ul class="simple">
<li>Hardcoded, i.e. <a class="reference external" href="http://ampledata.org/splunk_storm_chef_handler.html">http://ampledata.org/splunk_storm_chef_handler.html</a></li>
<li><tt class="docutils literal"><span class="pre">`linkName</span> <span class="pre">&lt;http://docs.chef.io/&gt;`__</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:doc:`pageTitle</span> <span class="pre">&lt;/filename&gt;`</span></tt></li>
</ul>
<p>The hardcoded link is preferable here because the source files are used in both HTML and PDF output. PDF output requires that URLs be fully disclosed so that computering folks can type them in later.</p>
<p class="last">The other link styles are shown because they are used in chef-docs and you might run into them. That said, there isn&#8217;t a good scenario for using these in chef-slides.</p>
</section>
<section>
<h2>Tables w/Headers</h2>
<p class="first">This is a table with table headers:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Things</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>thing 1</td>
<td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur elementum lobortis orci non suscipit. Mauris sodales justo eu metus dignissim bibendum.</td>
</tr>
<tr class="row-odd"><td>thing 2</td>
<td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur elementum lobortis orci non suscipit. Mauris sodales justo eu metus dignissim bibendum.</td>
</tr>
<tr class="row-even"><td>thing 3</td>
<td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur elementum lobortis orci non suscipit. Mauris sodales justo eu metus dignissim bibendum.</td>
</tr>
</tbody>
</table>
</section>
<section>
<h2>Code Blocks</h2>
<p class="first">A code block shows a block of code (obviously). If Pygments is enabled for Sphinx, use the code-block directive to show colors applied. Use a double colon (<tt class="docutils literal"><span class="pre">::</span></tt>) to introduce the default code block. For example, Ruby code:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">package</span> <span class="s2">&quot;foo&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and the same without the directive:</p>
<div class="last highlight-python"><div class="highlight"><pre>package &quot;foo&quot; do
  action :install
end
</pre></div>
</div>
</section>
<section>
<h2>Command Line Options</h2>
<p class="first">This command has the following syntax:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef-client OPTION VALUE OPTION VALUE ...
</pre></div>
</div>
<table border="1" class="last docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-A</span></tt>, <tt class="docutils literal"><span class="pre">--long</span></tt></td>
<td>Use to do something. It&#8217;ll wrap because it&#8217;s in a table! It&#8217;ll wrap because it&#8217;s in a table! It&#8217;ll wrap because it&#8217;s in a table! It&#8217;ll wrap because it&#8217;s in a table!</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-B</span></tt>, <tt class="docutils literal"><span class="pre">--longer</span></tt></td>
<td><p class="first">Use to do something else.</p>
<p class="last">Adding paragraphs in tables is a whitespace thing in RST.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section>
<h2>Images</h2>
<p class="first">Images should be 300dpi so they look good in presentation mode and horizontally focused.</p>
<img alt="_images/attributes_table_300dpi.png" class="last" src="_images/attributes_table_300dpi.png" />
</section>
<section>
<h2>Structural Examples</h2>
<p class="first">The following sections show more ways to structure revealjs slide decks, including:</p>
<ul class="simple">
<li>The same exact slides we&#8217;ve just looked at, but vertically!</li>
<li>Some images, including a pair that share the same design footprint</li>
<li>Part of an actual lesson from actual Chef training</li>
</ul>
<p class="last">Each of these sections are accessed horizontally, but then after the first slide, the rest of the section is presented vertically.</p>
</section>
<section>
<section class="first">
<h2>First Slide!</h2>
<p class="first">The first slide in the deck should be splashy, and with a better image than this one.</p>
<img alt="_images/chef_run_landscape_300dpi.png" class="last align-center" src="_images/chef_run_landscape_300dpi.png" />
</section>
<section>
<h2>Introductions</h2>
<p class="first">Use this slide to introduce a section of slides. A simple, concise statement that is followed by a few short bullets is all that is necessary. For example, chef-slides uses a very small subset of the Sphinx directive set, including:</p>
<ul class="last simple">
<li>Paragraphs, including bold, italics, and code.</li>
<li>Ordered and unordered lists.</li>
<li>Fully qualified URLs, e.g. <a class="reference external" href="http://chef.io">http://chef.io</a>.</li>
<li>Code blocks, both by themselves and within ordered lists.</li>
<li>Images. Used well, images are terrific! Used poorly, well ...</li>
<li>List-tables, which are tables built using an unordered list and whitespace.</li>
</ul>
</section>
<section>
<h2>Text</h2>
<p class="first">A paragraph is a series of sentences. You can add <em>emphasis</em> to words, make them <strong>bolder</strong> if necessary, and also highlight code <tt class="docutils literal"><span class="pre">5tr!ng+</span></tt> that may need to appear in paragraphs.</p>
<p>If a bulleted or numbered list doesn&#8217;t work, use additional paragraphs in the slide to help display the information.</p>
<p>Obviously, text can contain ordered and unordered lists.</p>
<ul class="simple">
<li>foo</li>
<li>bar</li>
</ul>
<p>and</p>
<ol class="arabic simple">
<li>foo</li>
<li>bar</li>
</ol>
<p class="last">Just use the white space in the source slide to ensure readability.</p>
</section>
<section>
<h2>Ordered Lists</h2>
<p class="first">This is an ordered list:</p>
<ol class="arabic simple">
<li>first item</li>
<li>second item</li>
<li>third item third item third item third item third item third item third item third item third item third item third item third item</li>
<li>fourth item</li>
</ol>
<p>Here&#8217;s the code:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span class="no">This</span> <span class="n">is</span> <span class="n">an</span> <span class="n">ordered</span> <span class="ss">list</span><span class="p">:</span>

<span class="c1">#. first item</span>
<span class="c1">#. second item</span>
<span class="c1">#. third item ...</span>
</pre></div>
</div>
</section>
<section>
<h2>Unordered Lists</h2>
<p class="first">This is an unordered list:</p>
<ul class="last simple">
<li>first item</li>
<li>second item</li>
<li>third item</li>
</ul>
</section>
<section>
<h2>Links</h2>
<p class="first">There are three types of links:</p>
<ul class="simple">
<li>Hardcoded, i.e. <a class="reference external" href="http://ampledata.org/splunk_storm_chef_handler.html">http://ampledata.org/splunk_storm_chef_handler.html</a></li>
<li><tt class="docutils literal"><span class="pre">`linkName</span> <span class="pre">&lt;http://docs.chef.io/&gt;`__</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:doc:`pageTitle</span> <span class="pre">&lt;/filename&gt;`</span></tt></li>
</ul>
<p>The hardcoded link is preferable here because the source files are used in both HTML and PDF output. PDF output requires that URLs be fully disclosed so that computering folks can type them in later.</p>
<p class="last">The other link styles are shown because they are used in chef-docs and you might run into them. That said, there isn&#8217;t a good scenario for using these in chef-slides.</p>
</section>
<section>
<h2>Tables w/Headers</h2>
<p class="first">This is a table with table headers:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Things</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>thing 1</td>
<td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur elementum lobortis orci non suscipit. Mauris sodales justo eu metus dignissim bibendum.</td>
</tr>
<tr class="row-odd"><td>thing 2</td>
<td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur elementum lobortis orci non suscipit. Mauris sodales justo eu metus dignissim bibendum.</td>
</tr>
<tr class="row-even"><td>thing 3</td>
<td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur elementum lobortis orci non suscipit. Mauris sodales justo eu metus dignissim bibendum.</td>
</tr>
</tbody>
</table>
</section>
<section>
<h2>Code Blocks</h2>
<p class="first">A code block shows a block of code (obviously). If Pygments is enabled for Sphinx, use the code-block directive to show colors applied. Use a double colon (<tt class="docutils literal"><span class="pre">::</span></tt>) to introduce the default code block. For example, Ruby code:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">package</span> <span class="s2">&quot;foo&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and the same without the directive:</p>
<div class="last highlight-python"><div class="highlight"><pre>package &quot;foo&quot; do
  action :install
end
</pre></div>
</div>
</section>
<section>
<h2>Command Line Options</h2>
<p class="first">This command has the following syntax:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef-client OPTION VALUE OPTION VALUE ...
</pre></div>
</div>
<table border="1" class="last docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-A</span></tt>, <tt class="docutils literal"><span class="pre">--long</span></tt></td>
<td>Use to do something. It&#8217;ll wrap because it&#8217;s in a table! It&#8217;ll wrap because it&#8217;s in a table! It&#8217;ll wrap because it&#8217;s in a table! It&#8217;ll wrap because it&#8217;s in a table!</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-B</span></tt>, <tt class="docutils literal"><span class="pre">--longer</span></tt></td>
<td><p class="first">Use to do something else.</p>
<p class="last">Adding paragraphs in tables is a whitespace thing in RST.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section class="last">
<h2>Images</h2>
<p class="first">Images should be 300dpi so they look good in presentation mode and horizontally focused.</p>
<img alt="_images/attributes_table_300dpi.png" class="last" src="_images/attributes_table_300dpi.png" />
</section>
</section>
<section>
<section class="first">
<h2>chef-client Run</h2>
<p class="first">This is an image about the chef-client run!</p>
<img alt="_images/chef_run_landscape_300dpi.png" class="last" src="_images/chef_run_landscape_300dpi.png" />
</section>
<section>
<h2>Github Branching (part 1)</h2>
<p class="first">Github branching!</p>
<img alt="_images/gitbranch_300dpi.png" class="last" src="_images/gitbranch_300dpi.png" />
</section>
<section class="last">
<h2>Github Branching (part 2)</h2>
<p class="first">More github branching!</p>
<img alt="_images/gitbranch_inline_300dpi.png" class="last" src="_images/gitbranch_inline_300dpi.png" />
</section>
</section>
<section>
<section class="first">
<h2>Lesson Objectives (Handlers)</h2>
<p class="first">After completing this lesson, you will be able to</p>
<ul class="last simple">
<li>Describe Chef handlers</li>
<li>Write custom report handlers</li>
<li>Distribute handlers to nodes</li>
<li>Configure Chef to use custom handlers</li>
</ul>
</section>
<section>
<h2>Handlers</h2>
<p class="first">Handlers run at the start or end of a chef-client run</p>
<p>They are Ruby programs that can read the status information of your chef-client run</p>
<p>There are three types of handlers:</p>
<ul class="last simple">
<li>Report</li>
<li>Exception</li>
<li>Start</li>
</ul>
</section>
<section>
<h2>Report Handlers</h2>
<p class="first">Report handlers are used when the chef-client run succeeds</p>
<p>Runs when <tt class="docutils literal"><span class="pre">run_status.success?</span></tt> is true</p>
<p>Community Examples:</p>
<ul class="last simple">
<li><a class="reference external" href="http://ampledata.org/splunk_storm_chef_handler.html">http://ampledata.org/splunk_storm_chef_handler.html</a></li>
<li><a class="reference external" href="http://onddo.github.io/chef-handler-zookeeper/">http://onddo.github.io/chef-handler-zookeeper/</a></li>
<li><a class="reference external" href="https://github.com/realityforge/chef-graphite_handler">https://github.com/realityforge/chef-graphite_handler</a></li>
</ul>
</section>
<section>
<h2>Exception Handlers</h2>
<p class="first">Exception handlers are used when the chef-client run fails</p>
<p>Runs when <tt class="docutils literal"><span class="pre">run_status.failed?</span></tt> is true</p>
<p>Community Examples:</p>
<ul class="last simple">
<li><a class="reference external" href="https://github.com/morgoth/airbrake_handler">https://github.com/morgoth/airbrake_handler</a></li>
<li><a class="reference external" href="https://github.com/jblaine/syslog_handler">https://github.com/jblaine/syslog_handler</a></li>
<li><a class="reference external" href="http://onddo.github.io/chef-handler-sns/">http://onddo.github.io/chef-handler-sns/</a></li>
</ul>
</section>
<section>
<h2>Start Handlers</h2>
<p class="first">Start handlers are used to run events at the beginning of the chef-client run</p>
<p>Does not load the chef_handler resource</p>
<p>Install start handlers using the chef_gem resource or add the <tt class="docutils literal"><span class="pre">start_handlers</span></tt> setting to the client.rb file.</p>
<p class="last"><a class="reference external" href="https://github.com/opscode/chef-reporting">https://github.com/opscode/chef-reporting</a></p>
</section>
<section>
<h2>Writing Custom Handlers</h2>
<ul class="first last simple">
<li>Use any ruby gem or library</li>
<li>Distribute to nodes with the chef_handler or chef-client cookbooks</li>
<li>Optionally configure through client.rb settings</li>
</ul>
</section>
<section>
<h2>Exercise: Download the chef_handler cookbook</h2>
<p class="first">Download the chef_handler cookbook:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>knife cookbook site download chef_handler 1.1.6
</pre></div>
</div>
<p>Returns:</p>
<div class="last highlight-bash"><div class="highlight"><pre>Downloading chef_handler from the cookbooks site at version 1.1.6 to /Users/YOU/chef-repo/chef_handler-1.1.6.tar.gz

Cookbook saved: /Users/YOU/chef-repo/chef_handler-1.1.6.tar.gz
</pre></div>
</div>
</section>
<section>
<h2>Exercise: Download the chef-client cookbook</h2>
<p class="first">Download the chef_handler cookbook:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tar -zxvf chef_handler-1.1.6.tar.gz -C cookbooks/
</pre></div>
</div>
<p>Returns:</p>
<div class="last highlight-bash"><div class="highlight"><pre>x chef_handler/
x chef_handler/CHANGELOG.md
x chef_handler/README.md
x chef_handler/attributes
x chef_handler/attributes/default.rb
x chef_handler/files
x chef_handler/files/default
x chef_handler/files/default/handlers
x chef_handler/files/default/handlers/README
x chef_handler/libraries
x chef_handler/libraries/matchers.rb
</pre></div>
</div>
</section>
<section>
<h2>Exercise: Upload the chef_handler cookbook</h2>
<p class="first">Use Knife to upload the chef_handler cookbook:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>knife cookbook upload chef_handler
</pre></div>
</div>
<p>Returns:</p>
<div class="last highlight-bash"><div class="highlight"><pre>Uploading chef_handler         <span class="o">[</span>1.1.6<span class="o">]</span>
Uploaded 1 cookbook.
</pre></div>
</div>
</section>
<section>
<h2>Letâs Write a Handler</h2>
<p class="first">Weâre going to write a new handler that will email us when chef-client runs</p>
<p>It will send us all of the resources that changed during the chef-client run</p>
<p class="last"><a class="reference external" href="http://docs.chef.io/handlers.html">http://docs.chef.io/handlers.html</a></p>
</section>
<section>
<h2>Library Cookbook Pattern</h2>
<p class="first">We could modify the chef_handler cookbook to add a recipe for the email handler</p>
<p>However, we&#8217;d basically be &#8220;forking&#8221; an upstream cookbook</p>
<p>Instead, let&#8217;s create our own cookbook and use chef_handler as a &#8220;library&#8221;</p>
<p class="last">Code reusability!</p>
</section>
<section>
<h2>Exercise: Create a cookbook named âemail_handlerâ</h2>
<p class="first">Use Knife to create the email_handler cookbook:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>knife cookbook create email_handler
</pre></div>
</div>
<p>Returns:</p>
<div class="last highlight-bash"><div class="highlight"><pre>** Creating cookbook email_handler
** Creating README <span class="k">for </span>cookbook: email_handler
** Creating CHANGELOG <span class="k">for </span>cookbook: email_handler
** Creating metadata <span class="k">for </span>cookbook: email_handler
</pre></div>
</div>
</section>
<section>
<h2>Exercise: Edit the default recipe</h2>
<ol class="first last arabic">
<li><p class="first">Open cookbooks/email_handler/recipes/default.rb</p>
</li>
<li><p class="first">Add:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">chef_gem</span> <span class="s2">&quot;pony&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="n">include_recipe</span> <span class="s2">&quot;chef_handler&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the file.</p>
</li>
</ol>
</section>
<section>
<h2>The chef_handler Resource</h2>
<p class="first">chef_handler is a resource packaged with the chef_handler cookbook</p>
<p>It has two actions: :enable and :disable</p>
<p>It has three arguments:</p>
<ul class="simple">
<li>source - the file containing the handler code</li>
<li>arguments - any pieces of information needed to initialize the handler</li>
<li>supports - :report, :exception</li>
</ul>
<p>Defaults:</p>
<ul class="last simple">
<li>:enable</li>
<li>:report =&gt; true, :exception =&gt; true</li>
</ul>
</section>
<section>
<h2>Exercise: Setup the handler</h2>
<ol class="first last arabic">
<li><p class="first">Open cookbooks/email_handler/recipes/default.rb</p>
</li>
<li><p class="first">Add:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/email_handler.rb&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;handlers/email_handler.rb&quot;</span>
  <span class="n">owner</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">group</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">mode</span> <span class="s2">&quot;0644&quot;</span>
<span class="k">end</span>

<span class="n">chef_handler</span> <span class="s2">&quot;MyCompany::EmailMe&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/email_handler.rb&quot;</span>
  <span class="n">arguments</span> <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;email_handler&#39;</span><span class="o">][</span><span class="s1">&#39;from_address&#39;</span><span class="o">]</span><span class="p">,</span>
             <span class="n">node</span><span class="o">[</span><span class="s1">&#39;email_handler&#39;</span><span class="o">][</span><span class="s1">&#39;to_address&#39;</span><span class="o">]]</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the file.</p>
</li>
</ol>
</section>
<section>
<h2>Exercise: Set the attributes</h2>
<ol class="first last arabic">
<li><p class="first">Open cookbooks/email_handler/attributes/default.rb</p>
</li>
<li><p class="first">Add:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">default</span><span class="o">[</span><span class="s1">&#39;email_handler&#39;</span><span class="o">][</span><span class="s1">&#39;from_address&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;chef@localhost&quot;</span>
<span class="n">default</span><span class="o">[</span><span class="s1">&#39;email_handler&#39;</span><span class="o">][</span><span class="s1">&#39;to_address&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;chef@localhost&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the file.</p>
</li>
</ol>
</section>
<section>
<h2>Exercise: Write the handler</h2>
<ol class="first arabic">
<li><p class="first">Open ../email_handler/files/default/handlers/email_handler.rb</p>
</li>
<li><p class="first">Add:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;pony&#39;</span>

<span class="k">module</span> <span class="nn">MyCompany</span>
  <span class="k">class</span> <span class="nc">EmailMe</span> <span class="o">&lt;</span> <span class="ss">Chef</span><span class="p">:</span><span class="ss">:Handler</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the file.</p>
</li>
</ol>
<ul class="last simple">
<li>All custom exception and report handlers are defined using Ruby and must be a subclass of the Chef::Handler class.</li>
<li>The module and class match what we defined as the name of the chef_handler in the recipe</li>
</ul>
</section>
<section>
<h2>The initialize Method</h2>
<ol class="first arabic">
<li><p class="first">Open ../email_handler/files/default/handlers/email_handler.rb</p>
</li>
<li><p class="first">Add:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EmailMe</span> <span class="o">&lt;</span> <span class="ss">Chef</span><span class="p">:</span><span class="ss">:Handler</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">from_address</span><span class="p">,</span> <span class="n">to_address</span><span class="p">)</span>
    <span class="vi">@from_address</span> <span class="o">=</span> <span class="n">from_address</span>
    <span class="vi">@to_address</span> <span class="o">=</span> <span class="n">to_address</span>
  <span class="k">end</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the file.</p>
</li>
</ol>
<ul class="last simple">
<li>Initialize the handler with the arguments we passed in the definition</li>
<li>You can create the method with any args you need to meet your requirements</li>
</ul>
</section>
<section>
<h2>The report Method</h2>
<ol class="first arabic">
<li><p class="first">Open ../email_handler/files/default/handlers/email_handler.rb</p>
</li>
<li><p class="first">Add:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="vi">@to_address</span> <span class="o">=</span> <span class="n">to_address</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">report</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">success?</span> <span class="p">?</span> <span class="s2">&quot;Successful&quot;</span> <span class="p">:</span> <span class="s2">&quot;Failed&quot;</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">status</span><span class="si">}</span><span class="s2"> Chef run report from </span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="n">report_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the file.</p>
</li>
</ol>
<ul class="last simple">
<li>The report interface is used to define how a handler will behave and is a required part of any custom handler</li>
</ul>
</section>
<section>
<h2>The updated_resources Hash</h2>
<ol class="first arabic">
<li><p class="first">Open ../email_handler/files/default/handlers/email_handler.rb</p>
</li>
<li><p class="first">Add:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="c1"># report on changed resources</span>
<span class="k">if</span> <span class="o">!</span> <span class="n">run_status</span><span class="o">.</span><span class="n">updated_resources</span><span class="o">.</span><span class="n">empty?</span>
  <span class="c1"># get some info about all the changed resources!</span>
  <span class="n">run_status</span><span class="o">.</span><span class="n">updated_resources</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
    <span class="n">report_string</span> <span class="o">+=</span> <span class="s2">&quot;The resource </span><span class="si">#{</span><span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> was changed in cookbook</span>
<span class="s2">                      </span><span class="si">#{</span><span class="n">r</span><span class="o">.</span><span class="n">cookbook_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">#{</span><span class="n">r</span><span class="o">.</span><span class="n">source_line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="k">end</span>
  <span class="k">else</span>
    <span class="n">report_string</span> <span class="o">+=</span> <span class="s2">&quot;No resources changed by chef-client</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="k">end</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the file.</p>
</li>
</ol>
<ul class="last simple">
<li>updated_resources records information about all the resources changed during a chef-client run</li>
<li>read through this hash with .each, pull interesting information out about each resource</li>
</ul>
</section>
<section>
<h2>Exercise: Finish email_handler.rb</h2>
<ol class="first arabic">
<li><p class="first">Open ../email_handler/files/default/handlers/email_handler.rb</p>
</li>
<li><p class="first">Add:</p>
<div class="highlight-ruby"><div class="highlight"><pre>    <span class="n">report_string</span> <span class="o">+=</span> <span class="s2">&quot;No resources changed by chef-client</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="k">end</span>

      <span class="no">Pony</span><span class="o">.</span><span class="n">mail</span><span class="p">(</span><span class="ss">:to</span> <span class="o">=&gt;</span> <span class="vi">@to_address</span><span class="p">,</span>
                <span class="ss">:from</span> <span class="o">=&gt;</span> <span class="vi">@from_address</span><span class="p">,</span>
                <span class="ss">:subject</span> <span class="o">=&gt;</span> <span class="n">subject</span><span class="p">,</span>
                <span class="ss">:body</span> <span class="o">=&gt;</span> <span class="n">report_string</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the file.</p>
</li>
</ol>
<ul class="last simple">
<li>Use Pony.mail to send a message containing info on changed resources</li>
</ul>
</section>
<section class="last">
<h2>Other Dependencies</h2>
<ul class="first last simple">
<li>Make sure all necessary functions are available!</li>
<li>Some sort of mail transfer agent (MTA)</li>
<li>Some sort of email reader (MUA)</li>
<li>These are distinct functional pieces</li>
<li>May have uses other than the handler</li>
<li>Get to be their own cookbooks!</li>
</ul>
</section>
</section>
<section>
<section class="first">
<h2>Package Resource</h2>
Use the <strong>package</strong> resource to manage packages. When the package is installed from a local file (such as with RubyGems, dpkg, or RPM Package Manager), the file must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</section>
<section>
<h2>Github Branching (part 1)</h2>
Use the <strong>package</strong> resource to manage packages. When the package is installed from a local file (such as with RubyGems, dpkg, or RPM Package Manager), the file must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</section>
<section class="last">
<h2>Github Branching (part 2)</h2>
Use the <strong>package</strong> resource to manage packages. When the package is installed from a local file (such as with RubyGems, dpkg, or RPM Package Manager), the file must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</section>
</section>
</div>


      </div>
    </div>
    
<script src="_static/js/jquery.min.js"></script>
<script src="_static/lib/js/head.min.js"></script>
<script src="_static/js/reveal.min.js"></script>
    <script>

      // change DOM for reveal.js
      $("div.section h1").remove();
      var content = $("div.section").html();
      $("div.section").remove();
      $("div.slides").html(content);

      Reveal.initialize({
        width: 1440,
        height: 900,

        margin: 0.3,

        minScale: 0.2,
        maxScale: 1.0,

        controls: true,
        progress: false,
        history: false,
        center: false,

        keyboard : true,
        overview: false,
        touch: true,
        loop: false,
        rtl: false,
        fragments: false,

        autoSlide: 0,
        mouseWheel: false,
        rollingLinks: true,
        previewLinks: false,

        transitionSpeed: "default",
        backgroundTransition: "default",

        slideNumber: false,
        embedded: false,
        autoSlideStoppable: true,
        hideAddressBar: true,

        parallaxBackgroundImage: "",
        parallaxBackgroundSize: "",

        focusBodyOnPageVisiblityChange: true,

        viewDistance: 3,

        theme: Reveal.getQueryHash().theme || "chef_slides",
        transition: Reveal.getQueryHash().transition || "default",

        

        dependencies: [
           { src: '_static/lib/js/classList.js', condition: function() { return !document.body.classList; } },
           { src: '_static/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
           { src: '_static/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
           { src: '_static/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
           { src: '_static/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
           { src: '_static/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });
    </script>
    
  </body>
</html>