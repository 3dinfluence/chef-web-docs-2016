

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>About the Recipe DSL &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="next" title="attribute? Method" href="dsl_recipe_method_attribute.html" />
    <link rel="prev" title="/pushy/node_states/NODE_NAME" href="api_pushy_node_state_node_name.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="dsl_recipe_method_attribute.html" title="attribute? Method"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="api_pushy_node_state_node_name.html" title="/pushy/node_states/NODE_NAME"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">About the Recipe DSL</a><ul>
<li><a class="reference internal" href="#use-ruby">Use Ruby</a><ul>
<li><a class="reference internal" href="#if-statements">if Statements</a></li>
<li><a class="reference internal" href="#case-statements">case Statements</a></li>
<li><a class="reference internal" href="#include-method">include? Method</a></li>
<li><a class="reference internal" href="#array-syntax-shortcut">Array Syntax Shortcut</a></li>
</ul>
</li>
<li><a class="reference internal" href="#include-recipes">Include Recipes</a><ul>
<li><a class="reference internal" href="#reload-attributes">Reload Attributes</a></li>
<li><a class="reference internal" href="#accessor-methods">Accessor Methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recipe-dsl-methods">Recipe DSL Methods</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="about-the-recipe-dsl">
<h1>About the Recipe DSL<a class="headerlink" href="#about-the-recipe-dsl" title="Permalink to this headline">¶</a></h1>
<p>The Recipe DSL is a Ruby DSL that is primarily used to declare resources from within a recipe. The Recipe DSL also helps ensure that recipes interact with nodes (and node properties) in the desired manner. Most of the methods in the Recipe DSL are used to find a specific parameter and then tell Chef what action(s) to take, based on whether that parameter is present on a node.</p>
<p>Because the Recipe DSL is a Ruby DSL, then anything that can be done using Ruby can also be done in a recipe, including <tt class="docutils literal"><span class="pre">if</span></tt> and <tt class="docutils literal"><span class="pre">case</span></tt> statements, using the <tt class="docutils literal"><span class="pre">include?</span></tt> Ruby method, including recipes in recipes, and checking for dependencies.</p>
<div class="section" id="use-ruby">
<h2>Use Ruby<a class="headerlink" href="#use-ruby" title="Permalink to this headline">¶</a></h2>
<p>Common Ruby techniques can be used with the Recipe DSL methods.</p>
<div class="section" id="if-statements">
<h3>if Statements<a class="headerlink" href="#if-statements" title="Permalink to this headline">¶</a></h3>
<p>An <tt class="docutils literal"><span class="pre">if</span></tt> statement can be used to specify part of a recipe to be used when certain conditions are met. <tt class="docutils literal"><span class="pre">else</span></tt> and <tt class="docutils literal"><span class="pre">elseif</span></tt> statements can be used to handle situations where either the initial condition is not met or when there are other possible conditions that can be met. Since this behavior is 100% Ruby, do this in a recipe the same way here as anywhere else.</p>
<p>For example, using an <tt class="docutils literal"><span class="pre">if</span></tt> statement with the <tt class="docutils literal"><span class="pre">platform</span></tt> node attribute:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;ubuntu&quot;</span>
  <span class="c1"># do ubuntu things</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="case-statements">
<h3>case Statements<a class="headerlink" href="#case-statements" title="Permalink to this headline">¶</a></h3>
<p>A <tt class="docutils literal"><span class="pre">case</span></tt> statement can be used to handle a situation where there are a lot of conditions. Use the <tt class="docutils literal"><span class="pre">when</span></tt> statement for each condition, as many as are required.</p>
<p>For example, using a <tt class="docutils literal"><span class="pre">case</span></tt> statement with the <tt class="docutils literal"><span class="pre">platform</span></tt> node attribute:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform&quot;</span><span class="o">]</span>
<span class="k">when</span> <span class="s2">&quot;debian&quot;</span><span class="p">,</span> <span class="s2">&quot;ubuntu&quot;</span>
  <span class="c1"># do debian/ubuntu things</span>
<span class="k">when</span> <span class="s2">&quot;redhat&quot;</span><span class="p">,</span> <span class="s2">&quot;centos&quot;</span><span class="p">,</span> <span class="s2">&quot;fedora&quot;</span>
  <span class="c1"># do redhat/centos/fedora things</span>
<span class="k">end</span>
</pre></div>
</div>
<p>For example, using a <tt class="docutils literal"><span class="pre">case</span></tt> statement with the <tt class="docutils literal"><span class="pre">platform_family</span></tt> node attribute:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform_family&quot;</span><span class="o">]</span>
<span class="k">when</span> <span class="s2">&quot;debian&quot;</span>
  <span class="c1"># do things on debian-ish platforms (debian, ubuntu, linuxmint)</span>
<span class="k">when</span> <span class="s2">&quot;rhel&quot;</span>
  <span class="c1"># do things on RHEL platforms (redhat, centos, scientific, etc)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="include-method">
<h3>include? Method<a class="headerlink" href="#include-method" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">include?</span></tt> method can be used to ensure that a specific parameter is included before an action is taken. For example, using the <tt class="docutils literal"><span class="pre">include?</span></tt> method to find a specific parameter:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">if</span> <span class="o">[</span><span class="s2">&quot;debian&quot;</span><span class="p">,</span> <span class="s2">&quot;ubuntu&quot;</span><span class="o">].</span><span class="n">include?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform&quot;</span><span class="o">]</span><span class="p">)</span>
  <span class="c1"># do debian/ubuntu things</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">if</span> <span class="sx">%w{rhel}</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform_family&quot;</span><span class="o">]</span><span class="p">)</span>
  <span class="c1"># do RHEL things</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="array-syntax-shortcut">
<h3>Array Syntax Shortcut<a class="headerlink" href="#array-syntax-shortcut" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">%w</span></tt> syntax is a Ruby shortcut for creating an array without requiring quotes and commas around the elements.</p>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">if</span> <span class="sx">%w{debian ubuntu}</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform&quot;</span><span class="o">]</span><span class="p">)</span>
  <span class="c1"># do debian/ubuntu things with the Ruby array %w{} shortcut</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To disable a Telnet client/server:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="sx">%w{ TelnetServer TelnetClient }</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">feature</span><span class="o">|</span>
  <span class="n">windows_feature</span> <span class="n">feature</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:remove</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="include-recipes">
<h2>Include Recipes<a class="headerlink" href="#include-recipes" title="Permalink to this headline">¶</a></h2>
<p>A recipe can include one (or more) recipes found in other cookbooks by using the <tt class="docutils literal"><span class="pre">include_recipe</span></tt> keyword. When a recipe is included, the resources found in that recipe will be inserted (in the same exact order) at the point where the <tt class="docutils literal"><span class="pre">include_recipe</span></tt> keyword is located. The syntax for including a recipe is like this:</p>
<div class="highlight-python"><pre>include_recipe "recipe"</pre>
</div>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">include_recipe</span> <span class="s2">&quot;apache2::mod_ssl&quot;</span>
</pre></div>
</div>
<p>If a recipe is included more than once in a recipe, only the first inclusion will be processed and any subsequent inclusion will be ignored.</p>
<div class="section" id="reload-attributes">
<h3>Reload Attributes<a class="headerlink" href="#reload-attributes" title="Permalink to this headline">¶</a></h3>
<p>Attributes sometimes depend on actions taken from within recipes, so it may be necessary to reload a given attribute from within a recipe. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">ruby_block</span> <span class="s1">&#39;some_code&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="n">node</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">run_context</span><span class="o">.</span><span class="n">resolve_attribute</span><span class="p">(</span><span class="s2">&quot;COOKBOOK_NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;ATTR_FILE&quot;</span><span class="p">))</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="accessor-methods">
<h3>Accessor Methods<a class="headerlink" href="#accessor-methods" title="Permalink to this headline">¶</a></h3>
<p>Attribute accessor methods are automatically created and the method invocation can be used interchangeably with the keys. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">default</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">dir</span>          <span class="o">=</span> <span class="s2">&quot;/etc/apache2&quot;</span>
<span class="n">default</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">listen_ports</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;80&quot;</span><span class="p">,</span><span class="s2">&quot;443&quot;</span> <span class="o">]</span>
</pre></div>
</div>
<p>This is a matter of style and preference for how attributes are reloaded from recipes, and may be seen when &#8220;retrieving&#8221; the value of an attribute.</p>
</div>
</div>
<div class="section" id="recipe-dsl-methods">
<h2>Recipe DSL Methods<a class="headerlink" href="#recipe-dsl-methods" title="Permalink to this headline">¶</a></h2>
<p>The Recipe DSL provides support for using attributes, data bags (and encrypted data), and search results in a recipe, as well as four helper methods that can be used to check for a node&#8217;s platform from the recipe to ensure that specific actions are taken for specific platforms. The helper methods are:</p>
<ul class="simple">
<li>platform?</li>
<li>platform_family?</li>
<li>value_for_platform</li>
<li>value_for_platform_family</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Methods</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_attribute.html"><em>attribute?</em></a></td>
<td>Use in a recipe to include an attribute.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="dsl_recipe_method_data_bag.html"><em>data_bag, data_bag_item</em></a></td>
<td>Use in a recipe to include a data bag or data bag item.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_cookbook_name.html"><em>cookbook_name</em></a></td>
<td>Use in a recipe to get the name of the cookbook in which a recipe is located.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="dsl_recipe_method_platform.html"><em>platform?</em></a></td>
<td>Use in a recipe to check for the platform.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_platform_family.html"><em>platform_family?</em></a></td>
<td>Use in a recipe to check for the platform family.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="dsl_recipe_method_recipe_name.html"><em>recipe_name</em></a></td>
<td>Use in a recipe to get the name of a recipe.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_resources.html"><em>resources</em></a></td>
<td>Use in a recipe to include a resource.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="dsl_recipe_method_search.html"><em>search</em></a></td>
<td>Use in a recipe to include search results.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_tag.html"><em>tag, tagged?, untag</em></a></td>
<td>Use in a recipe to use and apply tags.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="dsl_recipe_method_value_for_platform.html"><em>value_for_platform</em></a></td>
<td>Use in a recipe to check for a value for a platform.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_value_for_platform_family.html"><em>value_for_platform_family</em></a></td>
<td>Use in a recipe to check for a value for a platform family.</td>
</tr>
</tbody>
</table>
<p>The following recipe DSL methods can be used to interact with Microsoft Windows registry keys.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Methods</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_registry_data_exists.html"><em>registry_data_exists?</em></a></td>
<td>Find out if a registry key contains data.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="dsl_recipe_method_registry_get_subkeys.html"><em>registry_get_subkeys</em></a></td>
<td>Get a list of sub-keys for a registry setting.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_registry_get_values.html"><em>registry_get_values</em></a></td>
<td>Get values (name, type, and data) for a given registry key.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="dsl_recipe_method_registry_has_subkeys.html"><em>registry_has_subkeys?</em></a></td>
<td>Find out if a registry key has one (or more) sub-keys.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="dsl_recipe_method_registry_key_exists.html"><em>registry_key_exists?</em></a></td>
<td>Find out if a registry key exists.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="dsl_recipe_method_registry_value_exists.html"><em>registry_value_exists?</em></a></td>
<td>Find out if a registry key has values set (name, type, and data).</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The recommended order in which registry key-specific methods should be used within a recipe is: <tt class="docutils literal"><span class="pre">key_exists?</span></tt>, <tt class="docutils literal"><span class="pre">value_exists?</span></tt>, <tt class="docutils literal"><span class="pre">data_exists?</span></tt>, <tt class="docutils literal"><span class="pre">get_values</span></tt>, <tt class="docutils literal"><span class="pre">has_subkeys?</span></tt>, and then <tt class="docutils literal"><span class="pre">get_subkeys</span></tt>.</p>
</div>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="dsl_recipe_method_attribute.html" title="attribute? Method"
             >next</a></li>
        <li class="right" >
          <a href="api_pushy_node_state_node_name.html" title="/pushy/node_states/NODE_NAME"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>