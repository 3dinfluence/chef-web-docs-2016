

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Chef Server API &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="next" title="/clients" href="api_chef_server_clients.html" />
    <link rel="prev" title="chef-solo" href="chef_solo.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="api_chef_server_clients.html" title="/clients"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="chef_solo.html" title="chef-solo"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Chef Server API</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#authentication-headers">Authentication Headers</a><ul>
<li><a class="reference internal" href="#header-format">Header Format</a></li>
<li><a class="reference internal" href="#required-headers">Required Headers</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#endpoints">Endpoints</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="chef-server-api">
<h1>Chef Server API<a class="headerlink" href="#chef-server-api" title="Permalink to this headline">¶</a></h1>
<p>The Chef Server API is used to provide access to objects on the Chef Server, including nodes, environments, roles, cookbooks (and cookbook versions), and to manage an API client list and the associated RSA public key-pairs.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The Chef Server API has the following requirements:</p>
<ul class="simple">
<li>Access to a Chef Server running Chef 0.9.x or above</li>
<li>The <tt class="docutils literal"><span class="pre">Accept</span></tt> header must be set to &#8220;application/json&#8221;</li>
<li>The <tt class="docutils literal"><span class="pre">X-Chef-Version</span></tt> header must be set to the version of the Chef Server API that is being used</li>
<li>A request must be signed using <tt class="docutils literal"><span class="pre">Mixlib::Authentication</span></tt></li>
<li>A request must be well-formatted. The easiest way to ensure a well-formatted request is to use the <tt class="docutils literal"><span class="pre">Chef::REST</span></tt> library that is bundled with Chef.</li>
</ul>
</div>
<div class="section" id="authentication-headers">
<h2>Authentication Headers<a class="headerlink" href="#authentication-headers" title="Permalink to this headline">¶</a></h2>
<p>Authentication to the Chef Server occurs when a specific set of HTTP headers are signed using a private key that is associated with the machine from which the request is made. The request is authorized if the Chef Server can verify the signature using the public key. Only authorized actions are allowed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most authentication requests made to the Chef Server are abstracted from the user. Such as when using Knife or the Chef Server user interface. In some cases, such as when using the <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">exec</span></tt> subcommand, the authentication requests need to be made more explicitly, but still in a way that does not require authentication headers. In a few cases, such as when using arbitrary Ruby code or cURL, it may be necessary to include the full authentication header as part of the request to the Chef Server.</p>
</div>
<div class="section" id="header-format">
<h3>Header Format<a class="headerlink" href="#header-format" title="Permalink to this headline">¶</a></h3>
<p>All hashing is done using SHA1 and encoded in Base64. Base64 encoding should have line breaks every 60 characters.  Each canonical header should be encoded in the following format:</p>
<div class="highlight-bash"><div class="highlight"><pre>Method:HTTP_METHOD
HashedPath:HASHED_PATH
X-Ops-Content-Hash:HASHED_BODY
X-Ops-Timestamp:TIME
X-Ops-UserId:USERID
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">HTTP_METHOD</span></tt> is the method used in the API request (<tt class="docutils literal"><span class="pre">GET</span></tt>, <tt class="docutils literal"><span class="pre">POST</span></tt>, and so on)</li>
<li><tt class="docutils literal"><span class="pre">HASHED_PATH</span></tt> is the path of the request (<tt class="docutils literal"><span class="pre">/name_of_endpoint</span></tt> for the open source Chef Server and <tt class="docutils literal"><span class="pre">/organizations/organization_name/name_of_endpoint</span></tt> for Hosted Chef or Private Chef). The <tt class="docutils literal"><span class="pre">HASHED_PATH</span></tt> must be hashed using SHA1 and encoded using Base64 and must not have repeated forward slashes (<tt class="docutils literal"><span class="pre">/</span></tt>) or end in a forward slash (unless the path is <tt class="docutils literal"><span class="pre">/</span></tt>).</li>
<li>The private key must be an RSA key in the SSL .pem file format. This signature is then broken into character strings (of not more than 60 characters per line) and placed in the header.</li>
</ul>
<p>The Chef Server decrypts this header and ensures its content matches the content of the non-encrypted headers that were in the request. The timestamp of the message is checked to ensure the request was received within a reasonable amount of time. One approach generating the signed headers is to use <a class="reference external" href="https://github.com/opscode/mixlib-authentication">mixlib-authentication</a>, which is a class-based header signing authentication object similar to the one used in Chef.</p>
</div>
<div class="section" id="required-headers">
<h3>Required Headers<a class="headerlink" href="#required-headers" title="Permalink to this headline">¶</a></h3>
<p>The following authentication headers are required:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Feature</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Accept</span></tt></td>
<td>The format in which response data will be provided, such as <tt class="docutils literal"><span class="pre">json</span></tt>, <tt class="docutils literal"><span class="pre">xml</span></tt>, <tt class="docutils literal"><span class="pre">html</span></tt>, and so on. This header is not required, but is often included to ensure that response data is returned in the desired format.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Host</span></tt></td>
<td>The host name (and port number) to which a request is sent. (Port number <tt class="docutils literal"><span class="pre">80</span></tt> does not need to be specified.) For example: <tt class="docutils literal"><span class="pre">api.opscode.com</span></tt> (which is the same as <tt class="docutils literal"><span class="pre">api.opscode.com:80</span></tt>) or <tt class="docutils literal"><span class="pre">api.opscode.com:443</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">X-Chef-Version</span></tt></td>
<td>The version of the Chef executable from which a request is made. This header ensures that responses are in the correct format. For example: <tt class="docutils literal"><span class="pre">11.0.4.x</span></tt> or <tt class="docutils literal"><span class="pre">0.10.x</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">X-Ops-Authorization-N</span></tt></td>
<td>One (or more) 60 character segments that comprise the canonical header. A canonical header is signed with the private key used by the client machine from which the request is sent, and is also encoded using Base64. If more than one segment is required, each should be named sequentially, e.g. <tt class="docutils literal"><span class="pre">X-Ops-Authorization-1</span></tt>, <tt class="docutils literal"><span class="pre">X-Ops-Authorization-2</span></tt>, <tt class="docutils literal"><span class="pre">X-Ops-Authorization-N</span></tt>, where <tt class="docutils literal"><span class="pre">N</span></tt> represents the integer used by the last header that is part of the request.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">X-Ops-Content-Hash</span></tt></td>
<td>The body of the request. The body should be hashed using SHA1 and encoded using Base64. All hashing is done using SHA1 and encoded in Base64. Base64 encoding should have line breaks every 60 characters.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">X-Ops-Sign</span></tt></td>
<td>Set this header to the following value: <tt class="docutils literal"><span class="pre">version=1.0</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">X-Ops-Timestamp</span></tt></td>
<td>The timestamp, in ISO-8601 format and with UTC indicated by a trailing <tt class="docutils literal"><span class="pre">Z</span></tt> and separated by the character <tt class="docutils literal"><span class="pre">T</span></tt>. For example: <tt class="docutils literal"><span class="pre">2013-03-10T14:14:44Z</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">X-Ops-UserId</span></tt></td>
<td>The name of the API client whose private key will be used to create the authorization header.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The following example shows an authentication request to Hosted Chef:</p>
<div class="highlight-http"><pre>GET /organizations/organization_name/nodes HTTP/1.1
  Accept: application/json
  Accept-Encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3
  X-Ops-Sign: algorithm=sha1;version=1.0;
  X-Ops-Userid: user_id
  X-Ops-Timestamp: 2013-03-12T17:13:28Z
  X-Ops-Content-Hash: 2jmj7l5rfasfgSw0ygaVb/vlWAghYkK/YBwk=
  X-Ops-Authorization-1: BE3NnHeh5yFTiT3ifuwLSPCCYasdfXaRN5oZb4c6hbW0aefI
  X-Ops-Authorization-2: sL4j1qtEZzi/2WeF67UuytdsdfgbOc5CjgECQwqrym9gCUON
  X-Ops-Authorization-3: yf0p7PrLRCNasdfaHhQ2LWoE/+kTcu0dkasdfvaTghfCDC57
  X-Ops-Authorization-4: 155i+ZlthfasfhbfrtukusbIUGBKUYFjhbvcds3k0i0gqs+V
  X-Ops-Authorization-5: /sLcR7JjQky7sdafIHNEEBQrISktNCDGfFI9o6hbFIayFBx3
  X-Ops-Authorization-6: nodilAGMb166@haC/fttwlWQ2N1LasdqqGomRedtyhSqXA==
  Host: api.opscode.com:443
  X-Chef-Version: 11.4.0
  User-Agent: Chef Knife/11.4.0 (ruby-1.9.2-p320; ohai-6.16.0; x86_64-darwin11.3.0; +http://opscode.com)</pre>
</div>
</div>
</div>
<div class="section" id="endpoints">
<h2>Endpoints<a class="headerlink" href="#endpoints" title="Permalink to this headline">¶</a></h2>
<p>For Hosted Chef and Private Chef, each authentication request must include <tt class="docutils literal"><span class="pre">/organizations/organization_name</span></tt> as part of the name for the endpoint. For the open source Chef Server, each authentication request must include <tt class="docutils literal"><span class="pre">/clients</span></tt> as part of the name of the endpoint. For example, the full endpoint for getting a list of roles on Hosted Chef or Private Chef:</p>
<div class="highlight-html"><div class="highlight"><pre>GET /organizations/organization_name/roles
</pre></div>
</div>
<p>and for the same request, but to the open source Chef Server:</p>
<div class="highlight-html"><div class="highlight"><pre>GET /clients/roles
</pre></div>
</div>
<p>The Chef Server API has the following endpoints:</p>
<ul class="simple">
<li><a class="reference internal" href="api_chef_server_clients.html"><em>/clients</em></a></li>
<li><a class="reference internal" href="api_chef_server_clients_name.html"><em>/clients/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_cookbooks.html"><em>/cookbooks</em></a></li>
<li><a class="reference internal" href="api_chef_server_cookbooks_name.html"><em>/cookbooks/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_cookbooks_version.html"><em>/cookbooks/NAME/VERSION</em></a></li>
<li><a class="reference internal" href="api_chef_server_data_bag.html"><em>/data</em></a></li>
<li><a class="reference internal" href="api_chef_server_data_bag_item.html"><em>/data/NAME/ITEM</em></a></li>
<li><a class="reference internal" href="api_chef_server_data_bag_name.html"><em>/data/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_environments.html"><em>/environments</em></a></li>
<li><a class="reference internal" href="api_chef_server_environments_name.html"><em>/environments/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_environments_cookbook_name.html"><em>/environments/NAME/cookbooks/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_environments_cookbook_version.html"><em>/environments/NAME/cookbook_versions</em></a></li>
<li><a class="reference internal" href="api_chef_server_environments_cookbooks.html"><em>/environments/NAME/cookbooks</em></a></li>
<li><a class="reference internal" href="api_chef_server_environments_node.html"><em>/environments/NAME/nodes</em></a></li>
<li><a class="reference internal" href="api_chef_server_environments_recipe.html"><em>/environments/NAME/recipes</em></a></li>
<li><a class="reference internal" href="api_chef_server_environments_role.html"><em>/environments/NAME/roles/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_nodes.html"><em>/nodes</em></a></li>
<li><a class="reference internal" href="api_chef_server_nodes_name.html"><em>/nodes/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_roles.html"><em>/roles</em></a></li>
<li><a class="reference internal" href="api_chef_server_roles_name.html"><em>/roles/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_roles_name_environments.html"><em>/roles/NAME/environments</em></a></li>
<li><a class="reference internal" href="api_chef_server_roles_name_environments_name.html"><em>/roles/NAME/environments/NAME</em></a></li>
<li><a class="reference internal" href="api_chef_server_sandboxes.html"><em>/sandboxes</em></a></li>
<li><a class="reference internal" href="api_chef_server_sandboxes_id.html"><em>/sandboxes/ID</em></a></li>
<li><a class="reference internal" href="api_chef_server_search.html"><em>/search</em></a></li>
<li><a class="reference internal" href="api_chef_server_search_index.html"><em>/search/INDEX</em></a></li>
<li><a class="reference internal" href="api_chef_server_user.html"><em>/user</em></a></li>
</ul>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="api_chef_server_clients.html" title="/clients"
             >next</a></li>
        <li class="right" >
          <a href="chef_solo.html" title="chef-solo"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>