

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Lightweight Providers w/Chef Resources &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="up" title="About LWRPs" href="lwrp.html" />
    <link rel="next" title="Lightweight Providers w/Custom Ruby" href="lwrp_custom_provider_ruby.html" />
    <link rel="prev" title="Custom LWRPs" href="lwrp_custom.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="lwrp_custom_provider_ruby.html" title="Lightweight Providers w/Custom Ruby"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="lwrp_custom.html" title="Custom LWRPs"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="lwrp.html" accesskey="U">About LWRPs</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Lightweight Providers w/Chef Resources</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#dsl-provider-methods">Provider DSL Methods</a><ul>
<li><a class="reference internal" href="#action">action</a></li>
<li><a class="reference internal" href="#current-resource">current_resource</a></li>
<li><a class="reference internal" href="#load-current-resource">load_current_resource</a></li>
<li><a class="reference internal" href="#new-resource">new_resource</a></li>
<li><a class="reference internal" href="#updated-by-last-action">updated_by_last_action</a></li>
<li><a class="reference internal" href="#use-inline-resources">use_inline_resources</a></li>
<li><a class="reference internal" href="#whyrun-supported">whyrun_supported?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#condition-statements">Condition Statements</a></li>
<li><a class="reference internal" href="#log-entries">Log Entries</a><ul>
<li><a class="reference internal" href="#rescue">rescue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#aws-ebs-volume">aws_ebs_volume</a></li>
<li><a class="reference internal" href="#cron-d">cron_d</a></li>
<li><a class="reference internal" href="#rabbitmq-plugin">rabbitmq_plugin</a></li>
<li><a class="reference internal" href="#ssh-known-hosts-entry">ssh_known_hosts_entry</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="lightweight-providers-w-chef-resources">
<h1>Lightweight Providers w/Chef Resources<a class="headerlink" href="#lightweight-providers-w-chef-resources" title="Permalink to this headline">¶</a></h1>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state. These steps are de-coupled from the request itself. The request is made in a recipe and is defined by a lightweight resource. The steps are then defined by a lightweight provider.</p>
<p>A lightweight provider is a custom provider that defines the steps that are required to complete one (or more) actions defined by a lightweight resource. A lightweight provider and lightweight resource work together, each being defined in the same cookbook (the <tt class="docutils literal"><span class="pre">/providers</span></tt> and <tt class="docutils literal"><span class="pre">/resources</span></tt> subdirectories, respectively); together, they are referred as a LWRP (or &#8220;lightweight resource provider&#8221;). A lightweight provider is always authored using Ruby. Anything that can be done using Ruby can be done in a lightweight provider. In addition to using Ruby, the Provider DSL provides additional methods that are specific to Chef.</p>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<p>This section shows some of the common structural elements that appear a lightweight provider that is built in a way that leverages core Chef resources (such as <strong>file</strong>, <strong>template</strong>, or <strong>package</strong>). Remember:</p>
<ul class="simple">
<li>A lightweight provider tells Chef how to complete a task</li>
<li>The structure of a lightweight provider will vary, depending on the complexity of the tasks required to complete an action</li>
<li>At its core, a lightweight provider is just Ruby code, which means that anything that can be done in Ruby can be done in a lightweight provider</li>
</ul>
<p>The basic syntax for a lightweight provider that is built to leverage Chef resources is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">whyrun_supported?</span>
  <span class="kp">true</span>
<span class="k">end</span>

<span class="n">use_inline_resources</span>

<span class="n">action</span> <span class="ss">:action_name</span> <span class="k">do</span>
  <span class="n">condition</span> <span class="nb">test</span>
    <span class="n">resource</span> <span class="s2">&quot;resource_name&quot;</span> <span class="k">do</span>
      <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">log_type</span> <span class="s2">&quot;log_message&quot;</span>
      <span class="c1"># a Chef recipe</span>
      <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">()</span>
  <span class="c1"># some Ruby code</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">whyrun_supported?</span></tt> indicates whether a lightweight provider can be run in why-run mode</li>
<li><tt class="docutils literal"><span class="pre">use_inline_resources</span></tt> is used to tell Chef to execute <tt class="docutils literal"><span class="pre">action</span></tt> blocks as part of a self-contained Chef run. Using this method ensures that Chef can notify parent lightweight resources after embedded resources have finished processing</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> is the code block that tells Chef what to do when the <tt class="docutils literal"><span class="pre">:action_name</span></tt> is used in a recipe</li>
<li><tt class="docutils literal"><span class="pre">condition</span></tt> is a Ruby condition statement (<tt class="docutils literal"><span class="pre">if</span></tt>, <tt class="docutils literal"><span class="pre">else</span></tt>, <tt class="docutils literal"><span class="pre">elseif</span></tt>, <tt class="docutils literal"><span class="pre">unless</span></tt>, <tt class="docutils literal"><span class="pre">while</span></tt>, <tt class="docutils literal"><span class="pre">until</span></tt>, <tt class="docutils literal"><span class="pre">case</span></tt>, or <tt class="docutils literal"><span class="pre">for</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">test</span></tt> is used to test for idempotence; <tt class="docutils literal"><span class="pre">test</span></tt> can be defined inline (within the <tt class="docutils literal"><span class="pre">action</span></tt> block), defined as a method using a definition block elsewhere in the lightweight provider (shown as <tt class="docutils literal"><span class="pre">def</span> <span class="pre">test()</span></tt>), or defined using any other pattern that is available in Ruby</li>
<li><tt class="docutils literal"><span class="pre">resource</span></tt> is a Chef resource written as a recipe</li>
<li><tt class="docutils literal"><span class="pre">Chef::Log.log_type</span></tt> is used to tell Chef to create a log entry, where <tt class="docutils literal"><span class="pre">log_type</span></tt> is one of the following types: <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt>, <tt class="docutils literal"><span class="pre">warn</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, or <tt class="docutils literal"><span class="pre">fatal</span></tt></li>
<li><tt class="docutils literal"><span class="pre">updated_by_last_action</span></tt> is used to notify that a node was updated successfully</li>
</ul>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">whyrun_supported?</span>
  <span class="kp">true</span>
<span class="k">end</span>

<span class="n">use_inline_resources</span>

<span class="n">action</span> <span class="ss">:delete</span> <span class="k">do</span>
  <span class="k">if</span> <span class="n">user_exists?</span><span class="p">(</span><span class="n">new_resource</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="n">cmdStr</span> <span class="o">=</span> <span class="s2">&quot;rabbitmqctl delete_user </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">execute</span> <span class="n">cmdStr</span> <span class="k">do</span>
      <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;rabbitmq_user_delete: </span><span class="si">#{</span><span class="n">cmdStr</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;Deleting RabbitMQ user &#39;</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
      <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">user_exists?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="n">cmdStr</span> <span class="o">=</span> <span class="s2">&quot;rabbitmqctl -q list_users |grep &#39;^</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="se">\\</span><span class="s2">b&#39;&quot;</span>
  <span class="n">cmd</span> <span class="o">=</span> <span class="no">Mixlib</span><span class="o">::</span><span class="no">ShellOut</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">cmdStr</span><span class="p">)</span>
  <span class="n">cmd</span><span class="o">.</span><span class="n">environment</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span> <span class="s1">&#39;/root&#39;</span><span class="p">)</span>
  <span class="n">cmd</span><span class="o">.</span><span class="n">run_command</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;rabbitmq_user_exists?: </span><span class="si">#{</span><span class="n">cmdStr</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;rabbitmq_user_exists?: </span><span class="si">#{</span><span class="n">cmd</span><span class="o">.</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">begin</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">error!</span>
    <span class="kp">true</span>
  <span class="k">rescue</span>
    <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="dsl-provider-methods">
<h2>Provider DSL Methods<a class="headerlink" href="#dsl-provider-methods" title="Permalink to this headline">¶</a></h2>
<p>The Provider DSL is a Ruby DSL that is used to help define a lightweight provider and to ensure that a lightweight provider takes the correct actions when it is called from a recipe. The Provider DSL is a small DSL with just a few methods that are specific to Chef. Because the Provider DSL is a Ruby DSL, anything that can be done using Ruby can also be done when defining a lightweight provider.</p>
<div class="section" id="action">
<h3>action<a class="headerlink" href="#action" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">action</span></tt> method is used to define the steps that will be taken for each of the possible actions defined by the lightweight resource. Each action must be defined in separate <tt class="docutils literal"><span class="pre">action</span></tt> blocks within the same file. The syntax for the <tt class="docutils literal"><span class="pre">action</span></tt> method is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:action_name</span> <span class="k">do</span>
  <span class="k">if</span> <span class="vi">@current_resource</span><span class="o">.</span><span class="n">exists</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;</span><span class="si">#{</span> <span class="vi">@new_resource</span> <span class="si">}</span><span class="s2"> already exists - nothing to do.&quot;</span>
  <span class="k">else</span>
    <span class="n">resource</span> <span class="s2">&quot;resource_name&quot;</span> <span class="k">do</span>
      <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;</span><span class="si">#{</span> <span class="vi">@new_resource</span> <span class="si">}</span><span class="s2"> created.&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">:action_name</span></tt> corresponds to an action defined by a lightweight resource</li>
<li><tt class="docutils literal"><span class="pre">if</span> <span class="pre">&#64;current_resource.exists</span></tt> is a condition test that is using an instance variable to see if the object already exists on the node; this is an example of a test for idempotence</li>
<li>If the object already exists, a <tt class="docutils literal"><span class="pre">#{</span> <span class="pre">&#64;new_resource</span> <span class="pre">}</span> <span class="pre">already</span> <span class="pre">exists</span> <span class="pre">-</span> <span class="pre">nothing</span> <span class="pre">to</span> <span class="pre">do.</span></tt> log entry is created</li>
<li>If the object does not already exists, the <tt class="docutils literal"><span class="pre">resource</span></tt> block is run. This block is a recipe that tells Chef what to do. A <tt class="docutils literal"><span class="pre">#{</span> <span class="pre">&#64;new_resource</span> <span class="pre">}</span> <span class="pre">created.</span></tt> log entry is created</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">converge_by</span></tt> method is not included in the previous syntax example because when why-run mode is enabled in a lightweight provider that leverages core Chef resources, the <tt class="docutils literal"><span class="pre">converge_by</span></tt> blocks are already defined by the core Chef resources.</p>
</div>
</div>
<div class="section" id="current-resource">
<h3>current_resource<a class="headerlink" href="#current-resource" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">current_resource</span></tt> method is used to represent a resource as it exists on the node at the beginning of the Chef run. In other words: what the resource is currently. Chef compares the resource as it exists on the node to the resource that is created during the Chef run to determine what steps need to be taken to bring the resource into the desired state. This method is often used as an instance variable (<tt class="docutils literal"><span class="pre">&#64;current_resource</span></tt>).</p>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:add</span> <span class="k">do</span>
  <span class="k">unless</span> <span class="vi">@current_resource</span><span class="o">.</span><span class="n">exists</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">appcmd</span><span class="si">}</span><span class="s2"> add app /site.name:</span><span class="se">\&quot;</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">app_name</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
    <span class="n">cmd</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; /path:</span><span class="se">\&quot;</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
    <span class="n">cmd</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; /applicationPool:</span><span class="se">\&quot;</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">application_pool</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="vi">@new_resource</span><span class="o">.</span><span class="n">application_pool</span>
    <span class="n">cmd</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot; /physicalPath:</span><span class="se">\&quot;</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">physical_path</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="vi">@new_resource</span><span class="o">.</span><span class="n">physical_path</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="n">shell_out!</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;App created&quot;</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="si">}</span><span class="s2"> app already exists - nothing to do&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">unless</span></tt> conditional statement checks to make sure the resource doesn&#8217;t already exist on a node, and then runs a series of commands when it doesn&#8217;t. If the resource already exists, the log entry would be &#8220;Foo app already exists - nothing to do.&#8221;</p>
</div>
<div class="section" id="load-current-resource">
<h3>load_current_resource<a class="headerlink" href="#load-current-resource" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">load_current_resource</span></tt> method is used to find a resource on a node based on a collection of attributes. These attributes are defined in a lightweight resource and are loaded by Chef when processing a recipe during a Chef run. This method will ask Chef to look on the node to see if a resource exists with specific matching attributes.</p>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">load_current_resource</span>
  <span class="vi">@current_resource</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Resource</span><span class="o">::</span><span class="no">TransmissionTorrentFile</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="si">}</span><span class="s2"> torrent hash = </span><span class="si">#{</span><span class="n">torrent_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="vi">@transmission</span> <span class="o">=</span> <span class="no">Opscode</span><span class="o">::</span><span class="no">Transmission</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;foo:</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">att1</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">att2</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">att3</span><span class="si">}</span><span class="s2">/path&quot;</span><span class="p">)</span>
  <span class="vi">@torrent</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="k">begin</span>
    <span class="vi">@torrent</span> <span class="o">=</span> <span class="vi">@transmission</span><span class="o">.</span><span class="n">get_torrent</span><span class="p">(</span><span class="n">torrent_hash</span><span class="p">)</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found existing </span><span class="si">#{</span><span class="vi">@new_resource</span><span class="si">}</span><span class="s2"> in swarm with name of &#39;</span><span class="si">#{</span><span class="vi">@torrent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; and status of &#39;</span><span class="si">#{</span><span class="vi">@torrent</span><span class="o">.</span><span class="n">status_message</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="vi">@current_resource</span><span class="o">.</span><span class="n">torrent</span><span class="p">(</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">torrent</span><span class="p">)</span>
  <span class="k">rescue</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cannot find </span><span class="si">#{</span><span class="vi">@new_resource</span><span class="si">}</span><span class="s2"> in the swarm&quot;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="vi">@current_resource</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="new-resource">
<h3>new_resource<a class="headerlink" href="#new-resource" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">new_resource</span></tt> method is used to represent a resource as loaded by Chef during the Chef run. In other words: what the resource should be. Chef compares the resource as it exists on the node to the resource that is created during the Chef run to determine what steps need to be taken to bring the resource into the desired state. This method can be used as an instance variable (<tt class="docutils literal"><span class="pre">&#64;new_resource</span></tt>).</p>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre> <span class="n">action</span> <span class="ss">:delete</span> <span class="k">do</span>
  <span class="k">if</span> <span class="n">exists?</span>
    <span class="k">if</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">writable?</span><span class="p">(</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
      <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting </span><span class="si">#{</span><span class="vi">@new_resource</span><span class="si">}</span><span class="s2"> at </span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
      <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="k">raise</span> <span class="s2">&quot;Cannot delete </span><span class="si">#{</span><span class="vi">@new_resource</span><span class="si">}</span><span class="s2"> at </span><span class="si">#{</span><span class="vi">@new_resource</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">!&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where Chef checks to see if the file exists, then if the file is writable, and then attempts to delete the resource. <tt class="docutils literal"><span class="pre">path</span></tt> is an attribute of the new resource that is defined by the lightweight resource.</p>
</div>
<div class="section" id="updated-by-last-action">
<h3>updated_by_last_action<a class="headerlink" href="#updated-by-last-action" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">updated_by_last_action</span></tt> method is used to notify a lightweight resource that a node was updated successfully. For example, the <tt class="docutils literal"><span class="pre">cron_d</span></tt> lightweight resource in the <strong>cron</strong> cookbook:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:create</span> <span class="k">do</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">template</span> <span class="s2">&quot;/etc/cron.d/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">cookbook</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">cookbook</span>
    <span class="n">source</span> <span class="s2">&quot;cron.d.erb&quot;</span>
    <span class="n">mode</span> <span class="s2">&quot;0644&quot;</span>
    <span class="n">variables</span><span class="p">({</span>
        <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="ss">:minute</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
        <span class="ss">:hour</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
        <span class="ss">:day</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
        <span class="ss">:month</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
        <span class="ss">:weekday</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">weekday</span><span class="p">,</span>
        <span class="ss">:command</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">command</span><span class="p">,</span>
        <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
        <span class="ss">:mailto</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">mailto</span><span class="p">,</span>
        <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="ss">:home</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">home</span><span class="p">,</span>
        <span class="ss">:shell</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">shell</span>
      <span class="p">})</span>
    <span class="n">action</span> <span class="ss">:create</span>
  <span class="k">end</span>
  <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">updated_by_last_action?</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">t.updated_by_last_action?</span></tt> uses a variable to check whether a new crontab entry was created.</p>
</div>
<div class="section" id="use-inline-resources">
<h3>use_inline_resources<a class="headerlink" href="#use-inline-resources" title="Permalink to this headline">¶</a></h3>
<p>A lightweight resource is created by the <tt class="docutils literal"><span class="pre">action</span></tt> block of a lightweight provider. When the resource collection is compiled, and as a lightweight resource is discovered by Chef, each lightweight resource is inserted into the resource collection after the point at which it was discovered. For example, a resource collection may start out like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">resource_one</span>
<span class="n">resource_two</span>
<span class="n">resource_three</span>
</pre></div>
</div>
<p>If a lightweight resource is discovered while processing the second resource, it will be inserted into the resource collection like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">resource_one</span>
<span class="n">resource_two</span>
  <span class="n">lightweight_resource_one</span>
<span class="n">resource_three</span>
</pre></div>
</div>
<p>If that lightweight resource then contains references to other Chef resources (like <strong>file</strong>, <strong>template</strong>, or <strong>cookbook_file</strong>), then those additional resources are inserted into the resource collection in much the same way as a lightweight resource. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">resource_one</span>
<span class="n">resource_two</span>
  <span class="n">lightweight_resource_one</span>
    <span class="n">embedded_resource_a</span>
    <span class="n">embedded_resource_b</span>
<span class="n">resource_three</span>
</pre></div>
</div>
<p>where resources are processed in exactly the same order as defined by the resource collection. In addition, each resource is processed fully before Chef moves on to the next resource in the resource collection.</p>
<p>This behavior can create a situation where Chef resources that have been embedded into the resource collection by a lightweight resource are unable to notify their parent lightweight resource when processing is finished. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">resource_one</span>
  <span class="n">lightweight_resource_one</span>
    <span class="n">a</span>
    <span class="n">b</span>
<span class="n">resource_two</span>
  <span class="n">lightweight_resource_two</span>
    <span class="n">c</span>
<span class="n">resource_three</span>
</pre></div>
</div>
<p>where embedded resources <tt class="docutils literal"><span class="pre">a</span></tt> and <tt class="docutils literal"><span class="pre">b</span></tt> would be unable to notify <tt class="docutils literal"><span class="pre">lightweight_resource_one</span></tt> and embedded resource <tt class="docutils literal"><span class="pre">c</span></tt> would be unable to notify <tt class="docutils literal"><span class="pre">lightweight_resource_two</span></tt>.</p>
<p>This is the default behavior of Chef. This may not be the desired behavior. To change the default behavior so that Chef can notify its parent lightweight resource, use the <tt class="docutils literal"><span class="pre">use_inline_resources</span></tt> method at the top of the lightweight provider. This ensures that Chef executes the <tt class="docutils literal"><span class="pre">action</span></tt> blocks within that lightweight resource as part of a self-contained Chef run. Once notified, the parent lightweight resource is marked as updated (<tt class="docutils literal"><span class="pre">updated_by_last_action</span></tt>) and then any notifications that are set on that lightweight resource may be triggered normally.</p>
</div>
<div class="section" id="whyrun-supported">
<h3>whyrun_supported?<a class="headerlink" href="#whyrun-supported" title="Permalink to this headline">¶</a></h3>
<p>why-run mode is a way to see what Chef would have configured, had an actual Chef run occurred. This approach is similar to the concept of &#8220;no-operation&#8221; (or &#8220;no-op&#8221;): decide what should be done, but then don&#8217;t actually do anything until it&#8217;s done right. This approach to configuration management can help identify where complexity exists in the system, where inter-dependencies may be located, and to verify that everything will be configured in the desired manner.</p>
<p>When why-run mode is enabled, a Chef run will occur that does everything up to the point at which configuration would normally occur. This includes getting the configuration data, authenticating to the Chef Server, rebuilding the node object, expanding the run list, getting the necessary cookbook files, resetting node attributes, identifying the resources, and building the resource collection and does not include mapping each resource to a provider or configuring any part of the system.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">why-run mode is not a replacement for running cookbooks in a test environment that mirrors the production environment. Opscode uses why-run mode to learn more about what is going on, but also test-kitchen on developer systems, along with an internal OpenStack cloud and external cloud providers to test more thoroughly.</p>
</div>
<p>When Chef is run in why-run mode, certain assumptions are made:</p>
<ul class="simple">
<li>If the <strong>service</strong> resource cannot find the appropriate command to verify the status of a service, why-run mode will assume that the command would have been installed by a previous resource and that the service would not be running</li>
<li>For <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> attribute, why-run mode will assume these are commands or blocks that are safe to run. These conditions are not designed to be used to change the state of the system, but rather to help facilitate idempotency for the resource itself. That said, it may be possible that these attributes are being used in a way that modifies the system state</li>
<li>The closer the current state of the system is to the desired state, the more useful why-run mode will be. For example, if a full run-list is run against a fresh system, that run-list may not be completely correct on the first try, but also that run-list will produce more output than smaller run-list</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">whyrun_supported?</span></tt> method is used to set a lightweight provider to support why-run mode. The syntax for the <tt class="docutils literal"><span class="pre">whyrun_supported?</span></tt> method is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">whyrun_supported?</span>
  <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">whyrun_supported?</span></tt> is set to <tt class="docutils literal"><span class="pre">true</span></tt> for any lightweight provider that supports using why-run mode. When why-run mode is supported by the a lightweight provider, the <tt class="docutils literal"><span class="pre">converge_by</span></tt> method is used to define the strings that are logged by Chef when it is run in why-run mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a lightweight provider contains only Chef resources, the <tt class="docutils literal"><span class="pre">converge_by</span></tt> method is not required because it is already built into all of the Chef <a class="reference external" href="http://docs.opscode.com/resource.html">resources</a>.</p>
</div>
</div>
</div>
<div class="section" id="condition-statements">
<h2>Condition Statements<a class="headerlink" href="#condition-statements" title="Permalink to this headline">¶</a></h2>
<p>A lightweight provider can use any conditional statement that can be used in Ruby: <tt class="docutils literal"><span class="pre">if</span></tt>, <tt class="docutils literal"><span class="pre">else</span></tt>, <tt class="docutils literal"><span class="pre">elseif</span></tt>, <tt class="docutils literal"><span class="pre">unless</span></tt>, <tt class="docutils literal"><span class="pre">while</span></tt>, <tt class="docutils literal"><span class="pre">until</span></tt>, <tt class="docutils literal"><span class="pre">case</span></tt>, and <tt class="docutils literal"><span class="pre">for</span></tt>. A condition statement can test for:</p>
<ul class="simple">
<li>A Ruby class (such as <tt class="docutils literal"><span class="pre">::File</span></tt> or <tt class="docutils literal"><span class="pre">::String</span></tt>)</li>
<li>A Chef class (such as <tt class="docutils literal"><span class="pre">::Chef::Mixin::ShellOut</span></tt>)</li>
<li>Conditions present on the node by using <tt class="docutils literal"><span class="pre">&#64;current_resource</span></tt></li>
<li>Conditions present within the resource being processed by Chef during the Chef run by using <tt class="docutils literal"><span class="pre">new_resource</span></tt> or <tt class="docutils literal"><span class="pre">&#64;new_resource</span></tt></li>
<li>To verify if a resource was updated by using <tt class="docutils literal"><span class="pre">updated_by_last_action</span></tt>, for example: <tt class="docutils literal"><span class="pre">&#64;new_resource.updated_by_last_action</span></tt></li>
</ul>
<p>and so on.</p>
<p>For example, an <tt class="docutils literal"><span class="pre">if</span></tt> statement is used to check if a file exists (<tt class="docutils literal"><span class="pre">::File.exists?</span></tt>), and then if the file exists to delete a key from that file.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:remove</span> <span class="k">do</span>
  <span class="k">if</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="s2">&quot;/etc/pki/rpm-gpg/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;Removing </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> key from /etc/pki/rpm-gpg/&quot;</span>
    <span class="n">file</span> <span class="s2">&quot;/etc/pki/rpm-gpg/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
      <span class="n">action</span> <span class="ss">:delete</span>
    <span class="k">end</span>
    <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In the following example an <tt class="docutils literal"><span class="pre">unless</span></tt> statement is used to add a key, unless that node object already has that key assigned to it:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">unless</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">nil?</span>
  <span class="n">remote_file</span> <span class="s2">&quot;/etc/pki/rpm-gpg/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">url</span>
    <span class="n">mode</span> <span class="s2">&quot;0644&quot;</span>
    <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s2">&quot;execute[import-rpm-gpg-key-</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">action</span> <span class="ss">:add</span> <span class="k">do</span>
  <span class="k">unless</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="s2">&quot;/etc/yum.repos.d/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">.repo&quot;</span><span class="p">)</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;Adding </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">repo_name</span><span class="si">}</span><span class="s2"> repository to /etc/yum.repos.d/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">.repo&quot;</span>
    <span class="n">repo_config</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="log-entries">
<h2>Log Entries<a class="headerlink" href="#log-entries" title="Permalink to this headline">¶</a></h2>
<p>Use the <tt class="docutils literal"><span class="pre">Chef::Log</span></tt> class in a lightweight provider to define log entries that are created during a Chef run. The syntax for a log message is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">log_type</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">log_type</span></tt> can be <tt class="docutils literal"><span class="pre">.debug</span></tt>, <tt class="docutils literal"><span class="pre">.info</span></tt>, <tt class="docutils literal"><span class="pre">.warn</span></tt>, <tt class="docutils literal"><span class="pre">.error</span></tt>, or <tt class="docutils literal"><span class="pre">.fatal</span></tt></li>
<li><tt class="docutils literal"><span class="pre">&quot;message&quot;</span></tt> is the message that is logged. For example: <tt class="docutils literal"><span class="pre">&quot;#{&#64;new_resource}</span> <span class="pre">added</span> <span class="pre">module</span> <span class="pre">'#{&#64;new_resource.module_name}'&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;#{&#64;new_resource}</span> <span class="pre">module</span> <span class="pre">already</span> <span class="pre">exists</span> <span class="pre">-</span> <span class="pre">nothing</span> <span class="pre">to</span> <span class="pre">do&quot;</span></tt></li>
</ul>
<p>For example, from the <tt class="docutils literal"><span class="pre">repository.rb</span></tt> provider in the <strong>yum</strong> cookbook:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:add</span> <span class="k">do</span>
  <span class="k">unless</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="s2">&quot;/etc/yum.repos.d/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">.repo&quot;</span><span class="p">)</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;Adding </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">repo_name</span><span class="si">}</span><span class="s2"> repository to /etc/yum.repos.d/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">.repo&quot;</span>
    <span class="n">repo_config</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">Chef::Log</span></tt> class appends <tt class="docutils literal"><span class="pre">.info</span></tt> as the log type. If the name of the repo was &#8220;foo&#8221;, then the log message would be &#8220;Adding foo repository to /etc/yum.repos.d/foo.repo&#8221;.</p>
<p>Another example shows two log entries, one that is triggered when a service is being restarted, and then another that is triggered after the service has been restarted:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:restart</span> <span class="k">do</span>
  <span class="k">if</span> <span class="vi">@current_resource</span><span class="o">.</span><span class="n">running</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;Restarting </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">shell_out!</span><span class="p">(</span><span class="n">restart_command</span><span class="p">)</span>
    <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;Restarted </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="section" id="rescue">
<h3>rescue<a class="headerlink" href="#rescue" title="Permalink to this headline">¶</a></h3>
<p>Use the <tt class="docutils literal"><span class="pre">rescue</span></tt> clause to make sure that a log message is always provided. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">load_current_resource</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="k">begin</span>
    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="k">rescue</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cannot find </span><span class="si">#{</span><span class="vi">@new_resource</span><span class="si">}</span><span class="s2"> in the swarm&quot;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The following examples show various lightweight providers that use core Chef resources.</p>
<div class="section" id="aws-ebs-volume">
<h3>aws_ebs_volume<a class="headerlink" href="#aws-ebs-volume" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">aws_ebs_volume</span></tt> lightweight provider (found in the <a class="reference external" href="https://github.com/opscode-cookbooks/aws">aws</a> cookbook maintained by Opscode) defines how Chef would handle a recipe that uses the <tt class="docutils literal"><span class="pre">ebs_volume</span></tt> lightweight resource and the <tt class="docutils literal"><span class="pre">:detach</span></tt> action. The following <tt class="docutils literal"><span class="pre">action</span></tt> block tells Chef what to do with the <tt class="docutils literal"><span class="pre">:detach</span></tt> action:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:detach</span> <span class="k">do</span>
  <span class="n">vol</span> <span class="o">=</span> <span class="n">determine_volume</span>
  <span class="k">return</span> <span class="k">if</span> <span class="n">vol</span><span class="o">[</span><span class="ss">:aws_instance_id</span><span class="o">]</span> <span class="o">!=</span> <span class="n">instance_id</span>
  <span class="n">converge_by</span><span class="p">(</span><span class="s2">&quot;detach volume with id: </span><span class="si">#{</span><span class="n">vol</span><span class="o">[</span><span class="ss">:aws_id</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">detach_volume</span><span class="p">(</span><span class="n">vol</span><span class="o">[</span><span class="ss">:aws_id</span><span class="o">]</span><span class="p">,</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and the following <tt class="docutils literal"><span class="pre">def</span></tt> block defines the <tt class="docutils literal"><span class="pre">vol</span></tt> variable called by the <tt class="docutils literal"><span class="pre">determine_volume</span></tt> method:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">determine_volume</span>
  <span class="n">vol</span> <span class="o">=</span> <span class="n">currently_attached_volume</span><span class="p">(</span><span class="n">instance_id</span><span class="p">,</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
  <span class="n">vol_id</span> <span class="o">=</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">volume_id</span> <span class="o">||</span> <span class="n">volume_id_in_node_data</span> <span class="o">||</span> <span class="p">(</span> <span class="n">vol</span> <span class="p">?</span> <span class="n">vol</span><span class="o">[</span><span class="ss">:aws_id</span><span class="o">]</span> <span class="p">:</span> <span class="kp">nil</span> <span class="p">)</span>
  <span class="k">raise</span> <span class="s2">&quot;volume_id attribute not set ... no volume is attached at the device&quot;</span> <span class="k">unless</span> <span class="n">vol_id</span>

  <span class="n">vol</span> <span class="o">=</span> <span class="n">volume_by_id</span><span class="p">(</span><span class="n">vol_id</span><span class="p">)</span>
  <span class="k">raise</span> <span class="s2">&quot;No volume with id </span><span class="si">#{</span><span class="n">vol_id</span><span class="si">}</span><span class="s2"> exists&quot;</span> <span class="k">unless</span> <span class="n">vol</span>

  <span class="n">vol</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="cron-d">
<h3>cron_d<a class="headerlink" href="#cron-d" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">cron_d</span></tt> lightweight provider (found in the <a class="reference external" href="https://github.com/opscode-cookbooks/cron">cron</a> cookbook maintained by Opscode) is used to tell Chef what to do whenever the <tt class="docutils literal"><span class="pre">cron_d</span></tt> lightweight resource is used in a recipe:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:delete</span> <span class="k">do</span>
  <span class="n">file</span> <span class="s2">&quot;/etc/cron.d/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:delete</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">action</span> <span class="ss">:create</span> <span class="k">do</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">template</span> <span class="s2">&quot;/etc/cron.d/</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">cookbook</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">cookbook</span>
    <span class="n">source</span> <span class="s2">&quot;cron.d.erb&quot;</span>
    <span class="n">mode</span> <span class="s2">&quot;0644&quot;</span>
    <span class="n">variables</span><span class="p">({</span>
        <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="ss">:minute</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
        <span class="ss">:hour</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
        <span class="ss">:day</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
        <span class="ss">:month</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
        <span class="ss">:weekday</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">weekday</span><span class="p">,</span>
        <span class="ss">:command</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">command</span><span class="p">,</span>
        <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
        <span class="ss">:mailto</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">mailto</span><span class="p">,</span>
        <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="ss">:home</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">home</span><span class="p">,</span>
        <span class="ss">:shell</span> <span class="o">=&gt;</span> <span class="n">new_resource</span><span class="o">.</span><span class="n">shell</span>
      <span class="p">})</span>
    <span class="n">action</span> <span class="ss">:create</span>
  <span class="k">end</span>
  <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">updated_by_last_action?</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>two <tt class="docutils literal"><span class="pre">action</span></tt> blocks are defined, one for the <tt class="docutils literal"><span class="pre">:create</span></tt> action and one for the <tt class="docutils literal"><span class="pre">:delete</span></tt> action</li>
<li>the <tt class="docutils literal"><span class="pre">:delete</span></tt> action block calls the <strong>file</strong> resource (and it&#8217;s <tt class="docutils literal"><span class="pre">:delete</span></tt> action) to delete a file in the <tt class="docutils literal"><span class="pre">/etc/cron.d</span></tt> folder</li>
<li>the <tt class="docutils literal"><span class="pre">:create</span></tt> action block creates a new entry in the <tt class="docutils literal"><span class="pre">/etc/cron.d</span></tt> folder.</li>
</ul>
<p>For example, if a recipe used the <tt class="docutils literal"><span class="pre">cron_d</span></tt> lightweight resource similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cron_d</span> <span class="s2">&quot;daily-usage-report&quot;</span> <span class="k">do</span>
  <span class="n">minute</span> <span class="mi">0</span>
  <span class="n">hour</span> <span class="mi">23</span>
  <span class="n">command</span> <span class="s2">&quot;/srv/app/scripts/daily_report&quot;</span>
  <span class="n">user</span> <span class="s2">&quot;appuser&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>this tells Chef to use the <tt class="docutils literal"><span class="pre">cron_d</span></tt> lightweight provider and the credentials for a user named <tt class="docutils literal"><span class="pre">appuser</span></tt> to create a crontab entry named &#8220;daily-usage-report&#8221;. This crontab entry executes a command located in the <tt class="docutils literal"><span class="pre">/srv/app/scripts/daily_report</span></tt> directory at a specified interval (defined by the <tt class="docutils literal"><span class="pre">minute</span></tt> and <tt class="docutils literal"><span class="pre">hour</span></tt> attributes). Any of the attributes that are not specified in the recipe (such as <tt class="docutils literal"><span class="pre">mailto</span></tt>, <tt class="docutils literal"><span class="pre">weekday</span></tt>, and <tt class="docutils literal"><span class="pre">day</span></tt>) just use the default attribute values defined by the lightweight resource.</p>
</div>
<div class="section" id="rabbitmq-plugin">
<h3>rabbitmq_plugin<a class="headerlink" href="#rabbitmq-plugin" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">rabbitmq_plugin</span></tt> lightweight provider (found in the <a class="reference external" href="https://github.com/opscode-cookbooks/rabbitmq">rabbitmq</a> cookbook maintained by Opscode) is used to tell Chef how to handle two actions (<tt class="docutils literal"><span class="pre">:disable</span></tt> and <tt class="docutils literal"><span class="pre">:enable</span></tt>) that are used to manage RabbitMQ plugins. Using this lightweight resource in a recipe is simple:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">rabbitmq_plugin</span> <span class="s2">&quot;my_plugin&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The lightweight provider then does most of the work:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:enable</span> <span class="k">do</span>
  <span class="k">unless</span> <span class="n">plugin_enabled?</span><span class="p">(</span><span class="n">new_resource</span><span class="o">.</span><span class="n">plugin</span><span class="p">)</span>
    <span class="n">execute</span> <span class="s2">&quot;rabbitmq-plugins enable </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">plugin</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
      <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span> <span class="s2">&quot;Enabling RabbitMQ plugin &#39;</span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">plugin</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
      <span class="n">path</span> <span class="n">plugins_bin_path</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
      <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">plugins_bin_path</span><span class="p">(</span><span class="n">return_array</span><span class="o">=</span><span class="kp">false</span><span class="p">)</span>
  <span class="n">path</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:/usr/lib/rabbitmq/bin&#39;</span>
  <span class="n">return_array</span> <span class="p">?</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="p">:</span> <span class="n">path</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">plugin_enabled?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="n">cmdStr</span> <span class="o">=</span> <span class="s2">&quot;rabbitmq-plugins list -e &#39;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="se">\\</span><span class="s2">b&#39;&quot;</span>
  <span class="n">cmd</span> <span class="o">=</span> <span class="no">Mixlib</span><span class="o">::</span><span class="no">ShellOut</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">cmdStr</span><span class="p">)</span>
  <span class="n">cmd</span><span class="o">.</span><span class="n">environment</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span> <span class="s1">&#39;/root&#39;</span><span class="p">)</span>
  <span class="n">cmd</span><span class="o">.</span><span class="n">environment</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">plugins_bin_path</span>
  <span class="n">cmd</span><span class="o">.</span><span class="n">run_command</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;rabbitmq_plugin_enabled?: </span><span class="si">#{</span><span class="n">cmdStr</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span> <span class="s2">&quot;rabbitmq_plugin_enabled?: </span><span class="si">#{</span><span class="n">cmd</span><span class="o">.</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">cmd</span><span class="o">.</span><span class="n">error!</span>
  <span class="n">cmd</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=~</span> <span class="sr">/\b</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="sr">\b/</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="ssh-known-hosts-entry">
<h3>ssh_known_hosts_entry<a class="headerlink" href="#ssh-known-hosts-entry" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ssh_known_hosts_entry</span></tt> lightweight provider (found in the <a class="reference external" href="https://github.com/opscode-cookbooks/ssh_known_hosts">ssh_known_hosts</a> cookbook maintained by Opscode)(from the <tt class="docutils literal"><span class="pre">ssh_known_hosts</span></tt> cookbook) is used to add hosts and keys to the <tt class="docutils literal"><span class="pre">/etc/ssh_known_hosts</span></tt> file.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">action</span> <span class="ss">:create</span> <span class="k">do</span>
  <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_resource</span><span class="o">.</span><span class="n">key</span> <span class="o">||</span> <span class="sb">`ssh-keyscan -H </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="sb"> 2&gt;&amp;1`</span><span class="p">)</span>
  <span class="n">comment</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>

  <span class="no">Chef</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">fatal!</span> <span class="s2">&quot;Could not resolve </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">key</span> <span class="o">=~</span> <span class="sr">/getaddrinfo/</span>

  <span class="n">file</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;ssh_known_hosts&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">action</span>        <span class="ss">:create</span>
    <span class="n">backup</span>        <span class="kp">false</span>
    <span class="n">content</span>
    <span class="n">only_if</span> <span class="k">do</span>
      <span class="o">!::</span><span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;ssh_known_hosts&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span><span class="p">)</span> <span class="o">||</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;ssh_known_hosts&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">ruby_block</span> <span class="s2">&quot;add </span><span class="si">#{</span><span class="n">new_resource</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2"> to </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;ssh_known_hosts&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">block</span> <span class="k">do</span>
      <span class="n">file</span> <span class="o">=</span> <span class="o">::</span><span class="no">Chef</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">FileEdit</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;ssh_known_hosts&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span><span class="p">)</span>
      <span class="n">file</span><span class="o">.</span><span class="n">insert_line_if_no_match</span><span class="p">(</span><span class="sr">/</span><span class="si">#{</span><span class="no">Regexp</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span><span class="si">}</span><span class="sr">|</span><span class="si">#{</span><span class="no">Regexp</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
      <span class="n">file</span><span class="o">.</span><span class="n">write_file</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">new_resource</span><span class="o">.</span><span class="n">updated_by_last_action</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="lwrp_custom_provider_ruby.html" title="Lightweight Providers w/Custom Ruby"
             >next</a></li>
        <li class="right" >
          <a href="lwrp_custom.html" title="Custom LWRPs"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="lwrp.html" >About LWRPs</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>