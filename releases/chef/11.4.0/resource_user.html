

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>user &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="up" title="About Resources and Providers" href="resource.html" />
    <link rel="next" title="yum_package" href="resource_yum.html" />
    <link rel="prev" title="template" href="resource_template.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="resource_yum.html" title="yum_package"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="resource_template.html" title="template"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="resource.html" accesskey="U">About Resources and Providers</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">user</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#actions">Actions</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#supported-features">Supported Features</a></li>
<li><a class="reference internal" href="#password-shadow-hash">Password Shadow Hash</a></li>
<li><a class="reference internal" href="#providers">Providers</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="user">
<h1>user<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h1>
<p>A <a class="reference external" href="http://docs.opscode.com/resource.html">resource</a> is a key part of a <a class="reference external" href="http://docs.opscode.com/essentials_cookbook_recipes.html">recipe</a> that defines the actions that can be taken against a piece of the system. These actions are identified during each <a class="reference external" href="http://docs.opscode.com/essentials_nodes_chef_run.html">Chef run</a> as the resource collection is compiled. Once identified, each resource (in turn) is mapped to a provider, which then configures each piece of the system.</p>
<p>The <strong>user</strong> resource is used to manage a local user.</p>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<p>The syntax for using the <strong>user</strong> resource in a recipe is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">user</span> <span class="s2">&quot;name&quot;</span> <span class="k">do</span>
  <span class="n">some_attribute</span> <span class="s2">&quot;value&quot;</span> <span class="c1"># see attributes section below</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="n">action</span> <span class="ss">:action</span> <span class="c1"># see actions section below</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">user</span></tt> tells Chef to use one of the following providers during the Chef run: <tt class="docutils literal"><span class="pre">Chef::Provider::User::Useradd</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::User::Pw</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::User::Dscl</span></tt>, or <tt class="docutils literal"><span class="pre">Chef::Provider::User::Windows</span></tt>. The provider that is used by Chef depends on the platform of the machine on which the Chef run is taking place</li>
<li><tt class="docutils literal"><span class="pre">&quot;name&quot;</span></tt> is the user name</li>
<li><tt class="docutils literal"><span class="pre">attribute</span></tt> is zero (or more) of the attributes that are available for this resource</li>
<li><tt class="docutils literal"><span class="pre">:action</span></tt> is the step that the resource will ask the provider to take during the Chef run</li>
</ul>
</div>
<div class="section" id="actions">
<h2>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p>This resource has the following actions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:create</span></tt></td>
<td>Default. Use to create a user with given attributes. If the user already exists, use to ensure that the resource is in the correct state (which is effectively the same as <tt class="docutils literal"><span class="pre">:modify</span></tt>).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:remove</span></tt></td>
<td>Use to remove a user.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:modify</span></tt></td>
<td>Use to modify an existing user. This action will raise an exception if the user does not exist.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:manage</span></tt></td>
<td>Use to manage an existing user. This action will do nothing if the user does not exist.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:lock</span></tt></td>
<td>Use to lock a user&#8217;s password.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:unlock</span></tt></td>
<td>Use to unlock a user&#8217;s password.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p>This resource has the following attributes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">comment</span></tt></td>
<td>One (or more) comments about the user. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">gid</span></tt></td>
<td>The primary group identifier. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">home</span></tt></td>
<td>The location of the home directory. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">password</span></tt></td>
<td>The password shadow hash. This attribute requires that <tt class="docutils literal"><span class="pre">ruby-shadow</span></tt> be installed. This is part of the Debian package: <tt class="docutils literal"><span class="pre">libshadow-ruby1.8</span></tt>. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">provider</span></tt></td>
<td>Optional. Use to specify a provider by using its long name. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt>. See the Providers section below for the list of providers available to this resource.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">shell</span></tt></td>
<td>The login shell. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">supports</span></tt></td>
<td>A Mash where keys represent features and values are booleans that indicate if that feature is supported. Default value: <tt class="docutils literal"><span class="pre">{:manage_home</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:non_unique</span> <span class="pre">=&gt;</span> <span class="pre">false</span> <span class="pre">}</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">system</span></tt></td>
<td>Indicates that a system user should be created. This attribute may be used with <tt class="docutils literal"><span class="pre">useradd</span></tt> as the provider to create a system user which passes the <tt class="docutils literal"><span class="pre">-r</span></tt> flag to <tt class="docutils literal"><span class="pre">useradd</span></tt>. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">uid</span></tt></td>
<td>The numeric user identifier. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">username</span></tt></td>
<td>The name of the user. Default value: <tt class="docutils literal"><span class="pre">name</span></tt>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="supported-features">
<h2>Supported Features<a class="headerlink" href="#supported-features" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">supports</span></tt> attribute allows a list of supported features to be identified. There are two features of note:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">:manage_home</span></tt> indicates whether a user&#8217;s home directory will be created when the user is created. When the <tt class="docutils literal"><span class="pre">Useradd</span></tt> provider is used, <tt class="docutils literal"><span class="pre">-dm</span></tt> wil be passed to <tt class="docutils literal"><span class="pre">useradd</span></tt> (when the <tt class="docutils literal"><span class="pre">:create</span></tt> action is used) and <tt class="docutils literal"><span class="pre">-d</span></tt> will be passed to <tt class="docutils literal"><span class="pre">usermod</span></tt> (when the <tt class="docutils literal"><span class="pre">:manage</span></tt> or <tt class="docutils literal"><span class="pre">:modify</span></tt> actions are used). If <tt class="docutils literal"><span class="pre">supports</span> <span class="pre">:manage_home=&gt;true</span></tt>, the <strong>user</strong> resource does not pass the <tt class="docutils literal"><span class="pre">-d</span></tt> and <tt class="docutils literal"><span class="pre">-m</span></tt> parameters together (i.e. <tt class="docutils literal"><span class="pre">-dm</span></tt>) to <tt class="docutils literal"><span class="pre">usermod</span></tt>.</p>
<p>When the <tt class="docutils literal"><span class="pre">Windows</span></tt> provider is used, Microsoft Windows does not create a home directory for a user until that user logs on for the first time; specifying the home directory does not have any effect as to where Microsoft Windows ultimately places the home directory.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">:non_unique</span></tt> indicates whether non-unique UIDs are allowed. This option is currently unused by the existing providers.</p>
</li>
</ul>
</div>
<div class="section" id="password-shadow-hash">
<h2>Password Shadow Hash<a class="headerlink" href="#password-shadow-hash" title="Permalink to this headline">¶</a></h2>
<p>There are a number of encryption options and tools that can be used to create a password shadow hash. In general, using a strong encryption method like SHA-512 and the <tt class="docutils literal"><span class="pre">passwd</span></tt> command in the OpenSSL toolkit is a good approach, however the encryption options and tools that are available may be different from one distribution to another. The following examples show how the command line can be used to create a password shadow hash. When using the <tt class="docutils literal"><span class="pre">passwd</span></tt> command in the OpenSSL tool:</p>
<div class="highlight-bash"><div class="highlight"><pre>openssl passwd -1 <span class="s2">&quot;theplaintextpassword&quot;</span>
</pre></div>
</div>
<p>When using <tt class="docutils literal"><span class="pre">mkpasswd</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>mkpasswd -m sha-512
</pre></div>
</div>
<p>For more information:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.openssl.org/docs/apps/passwd.html">http://www.openssl.org/docs/apps/passwd.html</a></li>
<li>Check the local documentation or package repository for the distribution that is being used. For example, on Ubuntu 9.10-10.04, the <tt class="docutils literal"><span class="pre">mkpasswd</span></tt> package is required and on Ubuntu 10.10+ the <tt class="docutils literal"><span class="pre">whois</span></tt> package is required.</li>
</ul>
</div>
<div class="section" id="providers">
<h2>Providers<a class="headerlink" href="#providers" title="Permalink to this headline">¶</a></h2>
<p>The following providers are available. Use the short name to use the provider in a recipe:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="15%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Long name</th>
<th class="head">Short name</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::User::Useradd</span></tt></td>
<td><tt class="docutils literal"><span class="pre">user</span></tt></td>
<td>The default provider for the <strong>user</strong> resource.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Chef::Provider::User::Pw</span></tt></td>
<td><tt class="docutils literal"><span class="pre">user</span></tt></td>
<td>The provider that is used with the FreeBSD platform.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::User::Dscl</span></tt></td>
<td><tt class="docutils literal"><span class="pre">user</span></tt></td>
<td>The provider that is used with the Mac OS X platform.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Chef::Provider::User::Windows</span></tt></td>
<td><tt class="docutils literal"><span class="pre">user</span></tt></td>
<td>The provider that is used with all Microsoft Windows platforms.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Opscode uses resources in recipes, take a closer look at the cookbooks that Opscode authors and maintains: <a class="reference external" href="https://github.com/opscode-cookbooks">https://github.com/opscode-cookbooks</a>.</p>
<p><strong>Create a random user</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">user</span> <span class="s2">&quot;random&quot;</span> <span class="k">do</span>
  <span class="n">comment</span> <span class="s2">&quot;Random User&quot;</span>
  <span class="n">uid</span> <span class="mi">1000</span>
  <span class="n">gid</span> <span class="s2">&quot;users&quot;</span>
  <span class="n">home</span> <span class="s2">&quot;/home/random&quot;</span>
  <span class="n">shell</span> <span class="s2">&quot;/bin/zsh&quot;</span>
  <span class="n">password</span> <span class="s2">&quot;$1$JJsvHslV$szsCjVEroftprNn4JHtDi.&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a system user</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">user</span> <span class="s2">&quot;systemguy&quot;</span> <span class="k">do</span>
  <span class="n">comment</span> <span class="s2">&quot;system guy&quot;</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">shell</span> <span class="s2">&quot;/bin/false&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a system user with a variable</strong></p>
<p>The following example shows how to create a system user using a variable called <tt class="docutils literal"><span class="pre">user_home</span></tt> where the matching nodes have a group identifier that is the same as the node, and the login shell is <tt class="docutils literal"><span class="pre">/bin/bash</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">user_home</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:user</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">user</span> <span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:group</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">gid</span> <span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:group</span><span class="o">]</span>
  <span class="n">shell</span> <span class="s2">&quot;/bin/bash&quot;</span>
  <span class="n">home</span> <span class="n">user_home</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">matching_node</span></tt> represents a type of node in the Chef organization. For example, if the <tt class="docutils literal"><span class="pre">user_home</span></tt> variable specified <tt class="docutils literal"><span class="pre">{node[:nginx]...}</span></tt>, a recipe might look something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">user_home</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:nginx</span><span class="o">][</span><span class="ss">:user</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">user</span> <span class="n">node</span><span class="o">[</span><span class="ss">:nginx</span><span class="o">][</span><span class="ss">:group</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">gid</span> <span class="n">node</span><span class="o">[</span><span class="ss">:nginx</span><span class="o">][</span><span class="ss">:group</span><span class="o">]</span>
  <span class="n">shell</span> <span class="s2">&quot;/bin/bash&quot;</span>
  <span class="n">home</span> <span class="n">user_home</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="resource_yum.html" title="yum_package"
             >next</a></li>
        <li class="right" >
          <a href="resource_template.html" title="template"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="resource.html" >About Resources and Providers</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>