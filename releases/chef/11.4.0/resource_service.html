

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>service &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="up" title="About Resources and Providers" href="resource.html" />
    <link rel="next" title="template" href="resource_template.html" />
    <link rel="prev" title="script" href="resource_script.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="resource_template.html" title="template"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="resource_script.html" title="script"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="resource.html" accesskey="U">About Resources and Providers</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">service</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#actions">Actions</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#providers">Providers</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="service">
<h1>service<a class="headerlink" href="#service" title="Permalink to this headline">¶</a></h1>
<p>A <a class="reference external" href="http://docs.opscode.com/resource.html">resource</a> is a key part of a <a class="reference external" href="http://docs.opscode.com/essentials_cookbook_recipes.html">recipe</a> that defines the actions that can be taken against a piece of the system. These actions are identified during each <a class="reference external" href="http://docs.opscode.com/essentials_nodes_chef_run.html">Chef run</a> as the resource collection is compiled. Once identified, each resource (in turn) is mapped to a provider, which then configures each piece of the system.</p>
<p>The <strong>service</strong> resource is used to manage a service.</p>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<p>The syntax for using the <strong>service</strong> resource in a recipe is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;name&quot;</span> <span class="k">do</span>
  <span class="n">some_attribute</span> <span class="s2">&quot;value&quot;</span> <span class="c1"># see attributes section below</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="n">action</span> <span class="ss">:action</span> <span class="c1"># see actions section below</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">service</span></tt> tells Chef to use one of the following providers during the Chef run: <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Debian</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Upstart</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Freebsd</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Gentoo</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Redhat</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Solaris</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Windows</span></tt>, or <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Macosx</span></tt>. The provider that is used by Chef depends on the platform of the machine on which the Chef run is taking place</li>
<li><tt class="docutils literal"><span class="pre">&quot;name&quot;</span></tt> is the name of the service</li>
<li><tt class="docutils literal"><span class="pre">attribute</span></tt> is zero (or more) of the attributes that are available for this resource</li>
<li><tt class="docutils literal"><span class="pre">:action</span></tt> is the step that the resource will ask the provider to take during the Chef run</li>
</ul>
</div>
<div class="section" id="actions">
<h2>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p>This resource has the following actions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:enable</span></tt></td>
<td>Use to enable a service at boot.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:disable</span></tt></td>
<td>Use to disable a service.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:nothing</span></tt></td>
<td>Default. Use to do nothing with a service.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:start</span></tt></td>
<td>Use to start a service (and keep it running until stopped or disabled).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:stop</span></tt></td>
<td>Use to stop a service.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:restart</span></tt></td>
<td>Use to restart a service. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:reload</span></tt></td>
<td>Use to reload the configuration for this service.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p>This resource has the following attributes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">pattern</span></tt></td>
<td>The pattern to look for in the process table. Default value: <tt class="docutils literal"><span class="pre">service_name</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">provider</span></tt></td>
<td>Optional. Use to specify a provider by using its long name. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt>. See the Providers section below for the list of providers available to this resource.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">reload_command</span></tt></td>
<td>The command used to tell a service to reload its configuration. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">restart_command</span></tt></td>
<td>The command used to restart a service.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">service_name</span></tt></td>
<td>The name of the service. Default value: <tt class="docutils literal"><span class="pre">name</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">start_command</span></tt></td>
<td>The command used to start a service. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">status_command</span></tt></td>
<td>The command used to check the run status for a service. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">stop_command</span></tt></td>
<td>The command used to stop a service. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">supports</span></tt></td>
<td>A list of attributes that controls how Chef will attempt to manage a service: <tt class="docutils literal"><span class="pre">:restart</span></tt>, <tt class="docutils literal"><span class="pre">:reload</span></tt>, <tt class="docutils literal"><span class="pre">:status</span></tt>. For <tt class="docutils literal"><span class="pre">:restart</span></tt>, the init script or other service provider can use a restart command; if <tt class="docutils literal"><span class="pre">:restart</span></tt> is not specified, Chef will attempt to stop and then start a service. For <tt class="docutils literal"><span class="pre">:reload</span></tt>, the init script or other service provider can use a reload command. For <tt class="docutils literal"><span class="pre">:status</span></tt>, the init script or other service provider can use a status command to determine if the service is running; if <tt class="docutils literal"><span class="pre">:status</span></tt> is not specified, Chef will attempt to match the <tt class="docutils literal"><span class="pre">service_name</span></tt> against the process table as a regular expression, unless a pattern is specified as a parameter attribute. Default value: <tt class="docutils literal"><span class="pre">{</span> <span class="pre">:restart</span> <span class="pre">=&gt;</span> <span class="pre">true,</span> <span class="pre">:status</span> <span class="pre">=&gt;</span> <span class="pre">true</span> <span class="pre">}</span></tt>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="providers">
<h2>Providers<a class="headerlink" href="#providers" title="Permalink to this headline">¶</a></h2>
<p>The following providers are available. Use the short name to call the provider from a recipe:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="15%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Long name</th>
<th class="head">Short name</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>When this short name is used, Chef will determine the correct provider during the Chef run.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Debian</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>The provider that is used with the Debian and Ubuntu platforms.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Upstart</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>The provider that is used with the Upstart platform.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Freebsd</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>The provider that is used with the FreeBSD platform.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Gentoo</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>The provider that is used with the Gentoo platform.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Redhat</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>The provider that is used with the Red Hat and CentOS platforms.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Solaris</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>The provider that is used with the Oracle Solaris platform.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Windows</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>The provider that is used with the Microsoft Windows platform.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Macosx</span></tt></td>
<td><tt class="docutils literal"><span class="pre">service</span></tt></td>
<td>The provider that is used with the Mac OS X platform.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Opscode uses resources in recipes, take a closer look at the cookbooks that Opscode authors and maintains: <a class="reference external" href="https://github.com/opscode-cookbooks">https://github.com/opscode-cookbooks</a>.</p>
<p><strong>Start a service</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;example_service&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Start a service, enable it</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;example_service&quot;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a pattern</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;samba&quot;</span> <span class="k">do</span>
  <span class="n">pattern</span> <span class="s2">&quot;smbd&quot;</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the :nothing common action</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;memcached&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:stop</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;apache&quot;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports and providers common attributes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;some_service&quot;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage a service, depending on the node platform</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;example_service&quot;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform&quot;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s2">&quot;CentOS&quot;</span><span class="p">,</span><span class="s2">&quot;RedHat&quot;</span><span class="p">,</span><span class="s2">&quot;Fedora&quot;</span>
    <span class="n">service_name</span> <span class="s2">&quot;redhat_name&quot;</span>
  <span class="k">else</span>
    <span class="n">service_name</span> <span class="s2">&quot;other_name&quot;</span>
  <span class="k">end</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Change a service provider, depending on the node platform</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;example_service&quot;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform&quot;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s2">&quot;ubuntu&quot;</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s2">&quot;platform_version&quot;</span><span class="o">].</span><span class="n">to_f</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="o">.</span><span class="mi">10</span>
      <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload a service using a template</strong></p>
<p>To reload a service based on a template, use the <strong>template</strong> and <strong>service</strong> resources together in the same recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">template</span> <span class="s2">&quot;/tmp/somefile&quot;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s2">&quot;0644&quot;</span>
  <span class="n">source</span> <span class="s2">&quot;somefile.erb&quot;</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s2">&quot;apache&quot;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
  <span class="n">subscribes</span> <span class="ss">:reload</span><span class="p">,</span> <span class="n">resources</span><span class="p">(</span><span class="s2">&quot;template[/tmp/somefile]&quot;</span><span class="p">),</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification is used to reload the service using the template specified by the <strong>template</strong> resource.</p>
<p><strong>Enable a service after a restart or reload</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;apache&quot;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set an IP address using variables and a template</strong></p>
<p>The following example shows how a template resource can be used in a recipe to combine settings stored in an attributes file, variables within a recipe, and a template to set the IP addresses that are used by the Nginx service. The attributes file contains the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;/etc/nginx&quot;</span>
</pre></div>
</div>
<p>The recipe then does the following to:</p>
<ul class="simple">
<li>Declare two variables at the beginning of the recipe, one for the remote IP address and the other for the authorized IP address</li>
<li>Use the <strong>service</strong> resource to restart and reload the Nginx service</li>
<li>Load a template named &#8220;authorized_ip.erb&#8221; from the <tt class="docutils literal"><span class="pre">templates/</span></tt> directory that is used to set the IP address values based on the variables specified in the recipe</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;remote_addr&quot;</span>
<span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;127.0.0.1/32&quot;</span><span class="o">]</span>

<span class="n">service</span> <span class="s2">&quot;nginx&quot;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s2">&quot;authorized_ip&quot;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/authorized_ip&quot;</span>
  <span class="n">source</span> <span class="s2">&quot;modules/authorized_ip.erb&quot;</span>
  <span class="n">owner</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">group</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">mode</span> <span class="mo">00644</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:remote_ip_var</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:authorized_ips</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span>
  <span class="p">)</span>

  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="n">resources</span><span class="p">(</span><span class="ss">:service</span> <span class="o">=&gt;</span> <span class="s2">&quot;nginx&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">variables</span></tt> attribute tells the template to use the variables set at the beginning of the recipe and the <tt class="docutils literal"><span class="pre">source</span></tt> attribute is used to call a template file located in the cookbook&#8217;s <tt class="docutils literal"><span class="pre">templates/</span></tt> directory. The template file looks something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">geo</span> <span class="vg">$&lt;</span><span class="sx">%= @remote_ip_var %&gt; $authorized_ip {</span>
<span class="sx">  default no;</span>
<span class="sx">  &lt;% @authorized_ips.each do |ip| %&gt;</span>
<span class="sx">  &lt;%=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> yes;&quot;</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;% end %&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Use a cron timer to manage a service</strong></p>
<p>The following example shows how to install crond using two Chef resources and a variable:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cron_package</span> <span class="o">=</span> <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s2">&quot;redhat&quot;</span><span class="p">,</span> <span class="s2">&quot;centos&quot;</span><span class="p">,</span> <span class="s2">&quot;scientific&quot;</span><span class="p">,</span> <span class="s2">&quot;fedora&quot;</span><span class="p">,</span> <span class="s2">&quot;amazon&quot;</span>
    <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_version&#39;</span><span class="o">].</span><span class="n">to_f</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="o">.</span><span class="mi">0</span> <span class="o">?</span> <span class="s2">&quot;cronie&quot;</span> <span class="p">:</span> <span class="s2">&quot;vixie-cron&quot;</span>
  <span class="k">else</span>
    <span class="s2">&quot;cron&quot;</span>
  <span class="k">end</span>

<span class="n">package</span> <span class="n">cron_package</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s2">&quot;crond&quot;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s2">&quot;redhat&quot;</span><span class="p">,</span> <span class="s2">&quot;centos&quot;</span><span class="p">,</span> <span class="s2">&quot;scientific&quot;</span><span class="p">,</span> <span class="s2">&quot;fedora&quot;</span><span class="p">,</span> <span class="s2">&quot;amazon&quot;</span>
    <span class="n">service_name</span> <span class="s2">&quot;crond&quot;</span>
  <span class="k">when</span> <span class="s2">&quot;debian&quot;</span><span class="p">,</span> <span class="s2">&quot;ubuntu&quot;</span><span class="p">,</span> <span class="s2">&quot;suse&quot;</span>
    <span class="n">service_name</span> <span class="s2">&quot;cron&quot;</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:start</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cron_package</span></tt> is a variable that is used to identify which platforms apply to which install packages</li>
<li><tt class="docutils literal"><span class="pre">package</span></tt> uses the <tt class="docutils literal"><span class="pre">cron_package</span></tt> variable to determine how to install crond on various nodes (with various platforms)</li>
<li><tt class="docutils literal"><span class="pre">service</span></tt> enables the crond service on nodes that have Red Hat, CentOS, Red Hat Enterprise Linux, Fedora, or Amazon Web Services, and the cron service on nodes that run Debian, Ubuntu, or SuSE.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example comes from the following cookbook on github: <a class="reference external" href="https://github.com/opscode-cookbooks/cron">https://github.com/opscode-cookbooks/cron</a>.</p>
</div>
<p><strong>Restart a service, and then notify a different service</strong></p>
<p>The following example shows how start a service named &#8220;example_service&#8221; and immediately notify the Nginx service to restart.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;example_service&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Init</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s2">&quot;service[nginx]&quot;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where by using the default <tt class="docutils literal"><span class="pre">provider</span></tt> for the <strong>service</strong>, the recipe is telling Chef to determine the specific provider to be used during the Chef run based on the platform of the node on which the recipe will run.</p>
<p><strong>Stop a service, do stuff, and then restart it</strong></p>
<p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p>
<ul class="simple">
<li>Checks to see if the Amazon EC2 node has MySQL</li>
<li>If the node has MySQL, stops MySQL</li>
<li>Installs MySQL</li>
<li>Mounts the node</li>
<li>Restarts MySQL</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attribute?</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">))</span>

  <span class="n">service</span> <span class="s2">&quot;mysql&quot;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:stop</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s2">&quot;install-mysql&quot;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;mv </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">not_if</span> <span class="k">do</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
    <span class="n">directory</span> <span class="n">dir</span> <span class="k">do</span>
      <span class="n">owner</span> <span class="s2">&quot;mysql&quot;</span>
      <span class="n">group</span> <span class="s2">&quot;mysql&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">device</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span>
    <span class="n">fstype</span> <span class="s2">&quot;none&quot;</span>
    <span class="n">options</span> <span class="s2">&quot;bind,rw&quot;</span>
    <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">service</span> <span class="s2">&quot;mysql&quot;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:start</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the two <tt class="docutils literal"><span class="pre">service</span></tt> blocks are used to stop, and then restart the MySQL service</li>
<li>the <tt class="docutils literal"><span class="pre">execute</span></tt> block is used to install MySQL</li>
<li>the <tt class="docutils literal"><span class="pre">mount</span></tt> block is used to mount the node and enable MySQL</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example comes from the <tt class="docutils literal"><span class="pre">server_ec2</span></tt> recipe in the following cookbook: <a class="reference external" href="https://github.com/opscode-cookbooks/mysql">https://github.com/opscode-cookbooks/mysql</a>.</p>
</div>
<p><strong>If a node doesn&#8217;t have MySQL, install MySQL</strong></p>
<p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p>
<ul class="simple">
<li>Checks to see if the Amazon EC2 node has MySQL</li>
<li>If the node has MySQL, stops MySQL</li>
<li>Installs MySQL</li>
<li>Mounts the node</li>
<li>Restarts MySQL</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attribute?</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">))</span>

  <span class="n">service</span> <span class="s2">&quot;mysql&quot;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:stop</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s2">&quot;install-mysql&quot;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;mv </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">not_if</span> <span class="k">do</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
    <span class="n">directory</span> <span class="n">dir</span> <span class="k">do</span>
      <span class="n">owner</span> <span class="s2">&quot;mysql&quot;</span>
      <span class="n">group</span> <span class="s2">&quot;mysql&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">device</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span>
    <span class="n">fstype</span> <span class="s2">&quot;none&quot;</span>
    <span class="n">options</span> <span class="s2">&quot;bind,rw&quot;</span>
    <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">service</span> <span class="s2">&quot;mysql&quot;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:start</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the two <tt class="docutils literal"><span class="pre">service</span></tt> blocks are used to stop, and then restart the MySQL service</li>
<li>the <tt class="docutils literal"><span class="pre">execute</span></tt> block is used to install MySQL</li>
<li>the <tt class="docutils literal"><span class="pre">mount</span></tt> block is used to mount the node and enable MySQL</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example comes from the <tt class="docutils literal"><span class="pre">server_ec2</span></tt> recipe in the following cookbook: <a class="reference external" href="https://github.com/opscode-cookbooks/mysql">https://github.com/opscode-cookbooks/mysql</a>.</p>
</div>
<p><strong>Control a service using the execute resource</strong></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an example of something that should NOT be done. Use the <strong>service</strong> resource to control a service, not the <strong>execute</strong> resource.</p>
</div>
<p>Do something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">service</span> <span class="s2">&quot;tomcat&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and NOT something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">execute</span> <span class="s2">&quot;start-tomcat&quot;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">&quot;/etc/init.d/tomcat6 start&quot;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p>There is no reason to use the <strong>execute</strong> resource to control a service because the <strong>service</strong> resource exposes the <tt class="docutils literal"><span class="pre">start_command</span></tt> attribute directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="resource_template.html" title="template"
             >next</a></li>
        <li class="right" >
          <a href="resource_script.html" title="script"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="resource.html" >About Resources and Providers</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>