

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cookbook_file &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="up" title="About Resources and Providers" href="resource.html" />
    <link rel="next" title="cron" href="resource_cron.html" />
    <link rel="prev" title="Windows File Security" href="resource_common_windows_file_security.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="resource_cron.html" title="cron"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="resource_common_windows_file_security.html" title="Windows File Security"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="resource.html" accesskey="U">About Resources and Providers</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">cookbook_file</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#actions">Actions</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a><ul>
<li><a class="reference internal" href="#windows-file-security">Windows File Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#providers">Providers</a></li>
<li><a class="reference internal" href="#file-specificity">File Specificity</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="cookbook-file">
<h1>cookbook_file<a class="headerlink" href="#cookbook-file" title="Permalink to this headline">¶</a></h1>
<p>A <a class="reference external" href="http://docs.opscode.com/resource.html">resource</a> is a key part of a <a class="reference external" href="http://docs.opscode.com/essentials_cookbook_recipes.html">recipe</a> that defines the actions that can be taken against a piece of the system. These actions are identified during each <a class="reference external" href="http://docs.opscode.com/essentials_nodes_chef_run.html">Chef run</a> as the resource collection is compiled. Once identified, each resource (in turn) is mapped to a provider, which then configures each piece of the system.</p>
<p>The <strong>cookbook_file</strong> resource is used to transfer files from a sub-directory of the <tt class="docutils literal"><span class="pre">files/</span></tt> directory in a cookbook to a specified path that is located on the host running the chef-client or chef-solo. The file in a cookbook is selected according to file specificity, which allows different source files to be used based on the hostname, host platform (operating system, distro, or as appropriate), or platform version. Files that are located under <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/default</span></tt> can be used on any platform.</p>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<p>The syntax for using the <strong>cookbook_file</strong> resource in a recipe is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cookbook_file</span> <span class="s2">&quot;name&quot;</span> <span class="k">do</span>
  <span class="n">some_attribute</span> <span class="s2">&quot;value&quot;</span> <span class="c1"># see attributes section below</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="n">action</span> <span class="ss">:action</span> <span class="c1"># see actions section below</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cookbook_file</span></tt> tells Chef to use the <tt class="docutils literal"><span class="pre">Chef::Provider::CookbookFile</span></tt> provider during the Chef run</li>
<li><tt class="docutils literal"><span class="pre">&quot;name&quot;</span></tt> is the destination path and file name on the node</li>
<li><tt class="docutils literal"><span class="pre">attribute</span></tt> is zero (or more) of the attributes that are available for this resource</li>
<li><tt class="docutils literal"><span class="pre">:action</span></tt> is the step that the resource will ask the provider to take during the Chef run</li>
</ul>
<p>The following is an example of how the <strong>cookbook_file</strong> resource can work when used in a recipe. In this example, a cookbook file named &#8220;/tmp/cookbook_test_file&#8221; will be created, but only if the cookbook is not already there. The file that will be used to create the cookbook file is located in &#8220;/tmp/test&#8221; in the current cookbook, which is different than the destination path and filename on the node where the file will be created. Backups will not be kept.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cookbook_file</span> <span class="s2">&quot;/tmp/cookbook_test_file&quot;</span> <span class="k">do</span>
  <span class="n">backup</span> <span class="kp">false</span>
  <span class="n">path</span> <span class="s2">&quot;/tmp/test&quot;</span>
  <span class="n">action</span> <span class="ss">:create_if_missing</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="actions">
<h2>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h2>
<p>This resource has the following actions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:create</span></tt></td>
<td>Default. Use to create a file.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:create_if_missing</span></tt></td>
<td>Use to create a file if it doesn&#8217;t already exist.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:delete</span></tt></td>
<td>Use to delete a file.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p>This resource has the following attributes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">backup</span></tt></td>
<td>The number of backups of a file that should be kept. Set to <tt class="docutils literal"><span class="pre">false</span></tt> to prevent backups from being kept. Default value: <tt class="docutils literal"><span class="pre">5</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">cookbook</span></tt></td>
<td>The cookbook in which a file is located. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt> (the current cookbook).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">group</span></tt></td>
<td>A string or ID that identifies the group owner by group name, including fully qualified group names such as <tt class="docutils literal"><span class="pre">domain\group</span></tt> or <tt class="docutils literal"><span class="pre">group&#64;domain</span></tt>. If this value is not specified, existing groups will remain unchanged and new group assignments will use the default <tt class="docutils literal"><span class="pre">POSIX</span></tt> group (if available).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">inherits</span></tt></td>
<td>Microsoft Windows only. Indicates that a file inherits rights from its parent. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">mode</span></tt></td>
<td><p class="first">The octal mode for a file.</p>
<p>UNIX- and Linux-based systems: The octal mode of the file that is passed to chmod. If the value is specified as a quoted string, it will work exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">0777</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: The octal mode of the file that is translated into rights for Microsoft Windows security. Values up to <tt class="docutils literal"><span class="pre">0777</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This attribute cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This attribute has no effect if not specified, but when this attribute and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects will be cumulative.</p>
</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">owner</span></tt></td>
<td>A string or ID that identifies the group owner by user name, including fully qualified user names such as <tt class="docutils literal"><span class="pre">domain\user</span></tt> or <tt class="docutils literal"><span class="pre">user&#64;domain</span></tt>. If this value is not specified, existing owners will remain unchanged and new owner assignments will use the current user (when necessary).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">path</span></tt></td>
<td>The path to the file. Default value: <tt class="docutils literal"><span class="pre">name</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">provider</span></tt></td>
<td>Optional. Use to specify a provider by using its long name. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt>. See the Providers section below for the list of providers available to this resource.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">rights</span></tt></td>
<td>Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">&lt;permissions&gt;,</span> <span class="pre">&lt;principal&gt;,</span> <span class="pre">&lt;options&gt;</span></tt> where <tt class="docutils literal"><span class="pre">&lt;permissions&gt;</span></tt> specifies the rights granted to the principal, <tt class="docutils literal"><span class="pre">&lt;principal&gt;</span></tt> is the group or user name, and <tt class="docutils literal"><span class="pre">&lt;options&gt;</span></tt> is a hash with one (or more) advanced rights options.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">source</span></tt></td>
<td>The location of the source file. Can be used to distribute specific files to specific platforms (see the section &#8220;File Specificity&#8221;, below). Default value: basename of <tt class="docutils literal"><span class="pre">name</span></tt>.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the <tt class="docutils literal"><span class="pre">owner</span></tt> and <tt class="docutils literal"><span class="pre">right</span></tt> attributes and avoid the <tt class="docutils literal"><span class="pre">group</span></tt> and <tt class="docutils literal"><span class="pre">mode</span></tt> attributes whenever possible. The <tt class="docutils literal"><span class="pre">group</span></tt> and <tt class="docutils literal"><span class="pre">mode</span></tt> attributes are not true Microsoft Windows concepts and are provided more for backward compatibility than for best practice.</p>
</div>
<div class="section" id="windows-file-security">
<h3>Windows File Security<a class="headerlink" href="#windows-file-security" title="Permalink to this headline">¶</a></h3>
<p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p>
<p><strong>Access Control Lists (ACLs)</strong></p>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> attribute can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. The syntax for the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">rights</span> <span class="n">permission</span><span class="p">,</span> <span class="n">principal</span><span class="p">,</span> <span class="n">option</span>
</pre></div>
</div>
<p>where</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">permission</span></tt> is used to specify which rights will be granted to the <tt class="docutils literal"><span class="pre">principal</span></tt>. The possible values are: <tt class="docutils literal"><span class="pre">:read</span></tt>, <tt class="docutils literal"><span class="pre">:write</span></tt>, <tt class="docutils literal"><span class="pre">:full_control</span></tt>, and <tt class="docutils literal"><span class="pre">:deny</span></tt>. These permissions are cumulative. If <tt class="docutils literal"><span class="pre">:write</span></tt> is specified, then it includes <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:full_control</span></tt> is specified, then it includes both <tt class="docutils literal"><span class="pre">:write</span></tt> and <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:deny</span></tt> is specified, then the user or group will not have rights to the object. (For those who know the Microsoft Windows API: <tt class="docutils literal"><span class="pre">:read</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt> and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:write</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:full_control</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_ALL</span></tt>, which allows a user to change the owner and other metadata about a file.)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">principal</span></tt> is used to specify a group or user name. This is identical to what is entered in the login box for Microsoft Windows, such as <tt class="docutils literal"><span class="pre">user_name</span></tt>, <tt class="docutils literal"><span class="pre">domain\user_name</span></tt>, or <tt class="docutils literal"><span class="pre">user_name&#64;fully_qualified_domain_name</span></tt>. Chef does not need to know if a principal is a user or a group.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">option</span></tt> is a hash that contains advanced rights options. For example, the rights to a directory that only applies to its children might look something like: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:write,</span> <span class="pre">&quot;domain\group_name&quot;,</span> <span class="pre">:option_type</span> <span class="pre">=&gt;</span> <span class="pre">value</span></tt> where <tt class="docutils literal"><span class="pre">option_type</span></tt> is one of the following:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><p class="first last">Option Type</p>
</th>
<th class="head"><p class="first last">Description</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">:applies_to_children</span></tt></p>
</td>
<td><p class="first last">Use to specify how permissions are applied to children. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to inherit both child directories and files;  <tt class="docutils literal"><span class="pre">false</span></tt> to not inherit any child directories or files; <tt class="docutils literal"><span class="pre">:containers_only</span></tt> to inherit only child directories (and not files); <tt class="docutils literal"><span class="pre">:objects_only</span></tt> to recursively inherit files (and not child directories).</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">:applies_to_self</span></tt></p>
</td>
<td><p class="first last">Indicates whether a permission is applied to the parent directory. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply to the parent directory or file and its children; <tt class="docutils literal"><span class="pre">false</span></tt> to not apply only to child directories and files.</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">:one_level_deep</span></tt></p>
</td>
<td><p class="first last">Indicates the depth to which permissions will be applied. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply only to the first level of children; <tt class="docutils literal"><span class="pre">false</span></tt> to apply to all children.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> attribute can be used as many times as necessary; Chef will apply them to the file or directory as required. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">resource</span> <span class="s2">&quot;x.txt&quot;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s2">&quot;Everyone&quot;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s2">&quot;domain\group&quot;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s2">&quot;group_name_or_user_name&quot;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s2">&quot;user_name&quot;</span><span class="p">,</span> <span class="n">option</span> <span class="o">=&gt;</span> <span class="ss">:applies_to_children</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Some other important things to know when using the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute:</p>
<ul class="simple">
<li>Order independence. It doesn&#8217;t matter if <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:deny,</span> <span class="pre">&quot;Sally&quot;</span></tt> is placed before or after <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:read,</span> <span class="pre">&quot;Sally&quot;</span></tt>, Sally will be unable to read the document.</li>
<li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li>
<li>If rights are not specified, nothing will be changed. Chef does not clear out the rights on a file or directory if rights are not specified.</li>
<li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li>
</ul>
<p><strong>Inheritance</strong></p>
<p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <tt class="docutils literal"><span class="pre">inherits</span></tt> attribute can be used to specifically tell Chef to apply (or not apply) inherited rights from its parent directory.</p>
<p>For example, the following example specifies the rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span> <span class="c1"># Sauron is the only person who should have any sort of access</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">:deny</span></tt> permission were to be used instead, something could slip through unless all users and groups were denied.</p>
<p>Another example also shows how to specify rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;SHIRE\Frodo&#39;</span> <span class="c1"># Who put that there I didn&#39;t put that there</span>
<span class="k">end</span>
</pre></div>
</div>
<p>but then not use the <tt class="docutils literal"><span class="pre">inherits</span></tt> attribute to deny those rights on a child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:deny</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span> <span class="c1"># Oops, not specific enough</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the <tt class="docutils literal"><span class="pre">inherits</span></tt> attribute is not specified, Chef will default it to <tt class="docutils literal"><span class="pre">true</span></tt>, which will ensure that security settings for existing files remain unchanged.</p>
</div>
</div>
<div class="section" id="providers">
<h2>Providers<a class="headerlink" href="#providers" title="Permalink to this headline">¶</a></h2>
<p>The following providers are available. Use the short name to call the provider from a recipe:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="15%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Long name</th>
<th class="head">Short name</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::CookbookFile</span></tt></td>
<td><tt class="docutils literal"><span class="pre">cookbook_file</span></tt></td>
<td>The default provider for all platforms.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="file-specificity">
<h2>File Specificity<a class="headerlink" href="#file-specificity" title="Permalink to this headline">¶</a></h2>
<p>A cookbook will frequently be designed to work across many platforms and will often be required to distribute a specific file to a specific platform. A cookbook can be designed to support distributing files across platforms, but ensuring that the right file ends up on each system. For example, a cookbook may have a directory structure like this:</p>
<div class="highlight-python"><pre>files/
   host-foo.example.com
   ubuntu-10.04
   ubuntu-10
   ubuntu
   default</pre>
</div>
<p>and a cookbook_file resource like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cookbook_file</span> <span class="s2">&quot;/usr/local/bin/apache2_module_conf_generate.pl&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;apache2_module_conf_generate.pl&quot;</span>
  <span class="n">mode</span> <span class="mo">0755</span>
  <span class="n">owner</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">group</span> <span class="s2">&quot;root&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>would be matched in the same order as the cookbook directory structure. For a node named &#8220;foo.example.com&#8221; that is running Ubuntu 10.04, the second item would be the matching item and the location to which the file identified in the cookbook_resource would be distributed:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">host</span><span class="o">-</span><span class="n">foo</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
<span class="n">ubuntu</span><span class="o">-</span><span class="mi">8</span><span class="o">.</span><span class="mo">04</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
<span class="n">ubuntu</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
<span class="n">ubuntu</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
<span class="n">default</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">apache_module_conf_generate.pl</span></tt> file was located in the cookbook directory under <tt class="docutils literal"><span class="pre">files/host-foo.example.com/</span></tt>, the specified file(s) would only be copied to the machine with the domain name foo.example.com.</p>
<p>So, the pattern for file specificity is as follows:</p>
<ol class="arabic simple">
<li>host-node[:fqdn]</li>
<li>node[:platform]-node[:platform_version]</li>
<li>node[:platform]-version_components: The version string is split on decimals and searched from greatest specificity to least; for example, if the location from the last rule was centos-5.7.1, then centos-5.7 and centos-5 would also be searched.</li>
<li>node[:platform]</li>
<li>default</li>
</ol>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Opscode uses resources in recipes, take a closer look at the cookbooks that Opscode authors and maintains: <a class="reference external" href="https://github.com/opscode-cookbooks">https://github.com/opscode-cookbooks</a>.</p>
<p><strong>Transfer a file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cookbook_file</span> <span class="s2">&quot;/tmp/testfile&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;testfile&quot;</span>
  <span class="n">mode</span> <span class="mo">00644</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Handle cookbook_file and yum_package resources in the same recipe</strong></p>
<p>When a <strong>cookbook_file</strong> resource and a <strong>yum_package</strong> resource are both called from within the same recipe, dump the cache and use the new repository immediately to ensure that the correct package is installed:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cookbook_file</span> <span class="s2">&quot;/etc/yum.repos.d/custom.repo&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;custom&quot;</span>
  <span class="n">mode</span> <span class="mo">00644</span>
<span class="k">end</span>

<span class="n">yum_package</span> <span class="s2">&quot;only-in-custom-repo&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">flush_cache</span> <span class="o">[</span><span class="ss">:before</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install repositories from a file, trigger a command, and force the internal cache to reload</strong></p>
<p>The following example shows how to install new yum repositories from a file, where the installation of the repository triggers a creation of the yum cache that forces the internal Chef cache to reload:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">execute</span> <span class="s2">&quot;create-yum-cache&quot;</span> <span class="k">do</span>
 <span class="n">command</span> <span class="s2">&quot;yum -q makecache&quot;</span>
 <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s2">&quot;reload-internal-yum-cache&quot;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Yum</span><span class="o">::</span><span class="no">YumCache</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">reload</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s2">&quot;/etc/yum.repos.d/custom.repo&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;custom&quot;</span>
  <span class="n">mode</span> <span class="mo">00644</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s2">&quot;execute[create-yum-cache]&quot;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s2">&quot;ruby_block[reload-internal-yum-cache]&quot;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a case statement</strong></p>
<p>The following example shows how a <tt class="docutils literal"><span class="pre">case</span></tt> statement can be used to handle a situation where an application needs to be installed on multiple platforms, but the where the install directories are different, depending on the platform:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">cookbook_file</span> <span class="s2">&quot;application.pm&quot;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span>
  <span class="k">when</span> <span class="s2">&quot;centos&quot;</span><span class="p">,</span><span class="s2">&quot;redhat&quot;</span>
    <span class="n">path</span> <span class="s2">&quot;/usr/lib/version/1.2.3/dir/application.pm&quot;</span>
  <span class="k">when</span> <span class="s2">&quot;arch&quot;</span>
    <span class="n">path</span> <span class="s2">&quot;/usr/share/version/core_version/dir/application.pm&quot;</span>
  <span class="k">else</span>
    <span class="n">path</span> <span class="s2">&quot;/etc/version/dir/application.pm&quot;</span>
  <span class="k">end</span>
  <span class="n">source</span> <span class="s2">&quot;application-</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:languages</span><span class="o">][</span><span class="ss">:perl</span><span class="o">][</span><span class="ss">:version</span><span class="o">]</span><span class="si">}</span><span class="s2">.pm&quot;</span>
  <span class="n">owner</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">group</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">mode</span> <span class="mo">0644</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the data_bag_item method in the recipe DSL</strong></p>
<p>The following example shows how to use a data bag named &#8220;ssl_certificate&#8221; to:</p>
<ul class="simple">
<li>Create a log entry every time the data bag is used</li>
<li>Set variables for each data bag item</li>
<li>Specify what to do if the <tt class="docutils literal"><span class="pre">ssl_certificates</span></tt> data bag cannot be found and in which cookbook files to look for the default certificates</li>
<li>Create a log entry every time the default SSL certificates are used</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">data_bag_item</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Cookbook</span><span class="o">.</span><span class="n">get_ssl_certificate_data_bag</span>

<span class="k">if</span> <span class="n">data_bag_item</span><span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:ssl_certificate</span><span class="o">][</span><span class="ss">:key</span><span class="o">]]</span>

  <span class="n">log</span> <span class="s2">&quot;Used ssl_certificate data bag entry for </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:ssl_certificate</span><span class="o">][</span><span class="ss">:key</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">level</span> <span class="ss">:info</span>
  <span class="k">end</span>

  <span class="n">data_bag_item</span> <span class="o">=</span> <span class="n">data_bag_item</span><span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:ssl_certificate</span><span class="o">][</span><span class="ss">:key</span><span class="o">]]</span>
    <span class="n">certificate</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Cookbook</span><span class="o">.</span><span class="n">get_ssl_certificate_crt</span><span class="p">(</span><span class="n">data_bag_item</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Cookbook</span><span class="o">.</span><span class="n">get_ssl_certificate_key</span><span class="p">(</span><span class="n">data_bag_item</span><span class="p">)</span>

  <span class="c1"># a collection of file resource blocks that use the certificates</span>

<span class="k">else</span>

  <span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/certificates/site_proxy.crt&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="s2">&quot;cert_file.crt&quot;</span>
    <span class="n">mode</span> <span class="s2">&quot;077&quot;</span>
    <span class="n">action</span> <span class="ss">:create</span>
  <span class="k">end</span>

  <span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/certificates/site_proxy.key&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="s2">&quot;key_file.key&quot;</span>
    <span class="n">mode</span> <span class="s2">&quot;077&quot;</span>
    <span class="n">action</span> <span class="ss">:create</span>
  <span class="k">end</span>

  <span class="n">log</span> <span class="s2">&quot;Could not find ssl_certificate data bag, default certificate used.&quot;</span> <span class="k">do</span>
    <span class="n">level</span> <span class="ss">:warn</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">matching_node</span></tt> represents a type of node in the Chef organization.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="resource_cron.html" title="cron"
             >next</a></li>
        <li class="right" >
          <a href="resource_common_windows_file_security.html" title="Windows File Security"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="resource.html" >About Resources and Providers</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>