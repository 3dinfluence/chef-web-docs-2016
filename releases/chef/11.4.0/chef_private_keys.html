

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Public and Private Keys &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="next" title="Why Chef?" href="chef_why.html" />
    <link rel="prev" title="About Attributes" href="chef_overview_attributes.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="chef_why.html" title="Why Chef?"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="chef_overview_attributes.html" title="About Attributes"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Public and Private Keys</a><ul>
<li><a class="reference internal" href="#how-keys-are-used">How Keys are Used?</a><ul>
<li><a class="reference internal" href="#chef-client">chef-client</a></li>
<li><a class="reference internal" href="#knife">Knife</a></li>
<li><a class="reference internal" href="#chef-validator">chef-validator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#where-are-keys-stored">Where are Keys Stored?</a><ul>
<li><a class="reference internal" href="#nodes">Nodes</a></li>
<li><a class="reference internal" href="#workstations">Workstations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-keys">Generating Keys</a></li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="public-and-private-keys">
<h1>Public and Private Keys<a class="headerlink" href="#public-and-private-keys" title="Permalink to this headline">¶</a></h1>
<p>Chef is a systems and cloud infrastructure automation framework that makes it easy to deploy servers and applications to any physical, virtual, or cloud location, no matter the size of the infrastructure. Chef relies on abstract definitions (known as cookbooks and recipes) that are written in Ruby and are managed like source code. Each definition describes how a specific part of your infrastructure should be built and managed. Chef then applies those definitions to servers and applications, as specified, resulting in a fully automated infrastructure. When a new node is brought online, the only thing that Chef needs to know is which cookbooks and recipes to apply.</p>
<div class="section" id="how-keys-are-used">
<h2>How Keys are Used?<a class="headerlink" href="#how-keys-are-used" title="Permalink to this headline">¶</a></h2>
<p>The authentication process ensures the Chef Server responds only to requests made by trusted users. Chef uses public key encryption for all server types: Hosted Chef, Private Chef, and the open source Chef Server. When a node and/or a workstation is configured to run Chef, both public and private keys are created. The public key is stored on the Chef Server, while the private key is returned to the user for safe keeping. (The private key is a .pem file located in the .chef directory or in /etc/chef.) The following executables use the Chef Server API when communicating with the Chef Server:</p>
<ul class="simple">
<li>chef-client</li>
<li>Knife</li>
<li>chef-validator (only during the first Chef run on a node)</li>
</ul>
<p>Each request to the Chef Server from those executables encrypts a special group of HTTP headers along with the private key. The Chef Server then uses the public key to decrypt the headers and verify the contents.</p>
<div class="section" id="chef-client">
<h3>chef-client<a class="headerlink" href="#chef-client" title="Permalink to this headline">¶</a></h3>
<p>Chef uses RSA public key-pairs to authenticate a chef-client with the Chef Server every time a chef-client needs access to data that is stored on the Chef Server. This prevents any node from accessing data that it shouldn&#8217;t and ensures that only nodes that are properly registered with the Chef server can be managed by Chef.</p>
</div>
<div class="section" id="knife">
<h3>Knife<a class="headerlink" href="#knife" title="Permalink to this headline">¶</a></h3>
<p>Chef uses RSA public key-pairs to authenticate Knife with the Chef Server every time Knife attempts to access the Chef Server. This ensures that each instance of Knife is properly registered with the Chef Server and that only trusted users can make changes to the data.</p>
<p>Knife can also use the <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">exec</span></tt> subcommand to make specific, authenticated requests to the Chef Server. Knife plugins can also make authenticated requests to the Chef Server by leveraging the <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">exec</span></tt> subcommand.</p>
</div>
<div class="section" id="chef-validator">
<h3>chef-validator<a class="headerlink" href="#chef-validator" title="Permalink to this headline">¶</a></h3>
<p>Every request from the chef-client to the Chef Server must be an authenticated request using the Chef Server API. When the chef-client starts a Chef run, a check is done to see if the client key exists on the node at <tt class="docutils literal"><span class="pre">/etc/chef/client.pem</span></tt>. If the key exists, it is used as part of the authentication request to the Chef Server. If the key does not exist, Chef will use the key assigned to the chef-validator (<tt class="docutils literal"><span class="pre">/etc/chef/validation.pem</span></tt>) to ensure that each node can make an authenticated request to the Chef Server during its first Chef run. The key pair used by the chef-validator is created when Chef is installed on a node, either manually or using a Knife bootstrap operation. If the chef-validator is unable to make an authentication request to the Chef Server, the Chef run fails.</p>
</div>
</div>
<div class="section" id="where-are-keys-stored">
<h2>Where are Keys Stored?<a class="headerlink" href="#where-are-keys-stored" title="Permalink to this headline">¶</a></h2>
<p>Keys are stored in different locations, depending on if the location is a node or a workstation.</p>
<div class="section" id="nodes">
<h3>Nodes<a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h3>
<p>Each node stores its private key locally. This private key is generated as part of the bootstrap process that initially installs the chef-client on the node. The first time Chef runs on that node, it uses the chef-validator to authenticate, but then on each subsequent run it uses the private key generated for that client by the Chef Server.</p>
</div>
<div class="section" id="workstations">
<h3>Workstations<a class="headerlink" href="#workstations" title="Permalink to this headline">¶</a></h3>
<p>Each workstation stores its private key in the Chef repository. This private key is generated by the Chef Server and must be download from the server and copied to the <tt class="docutils literal"><span class="pre">.chef</span></tt> directory in the Chef repository. If a new private key is required, simply regenerate it from the Chef Server and re-copy it to the Chef repository.</p>
<p>The Chef repository is the location in which the following data objects are stored:</p>
<ul class="simple">
<li>Cookbooks (including recipes, versions, cookbook attributes, resources, providers, libraries, and templates)</li>
<li>Roles</li>
<li>Data bags</li>
<li>Environments</li>
<li>Configuration files (for clients, workstations, and servers)</li>
</ul>
<p>The Chef repository is located on a workstation and should be synchronized with a version control system, such as git. All of the data in the Chef repository should be treated like source code.</p>
<p>Knife is used to upload data to the Chef Server from the Chef repository. Once uploaded, that data is used by Chef to manage all of the nodes that are registered with the Chef Server and to ensure that the correct cookbooks, environments, roles, and other settings are applied to nodes correctly.</p>
<p>The <tt class="docutils literal"><span class="pre">.chef/</span></tt> directory is a hidden directory that is used to store .pem validation that are provided by the Chef Server and a knife.rb file. These files are required for interaction with a Chef Server.</p>
</div>
</div>
<div class="section" id="generating-keys">
<h2>Generating Keys<a class="headerlink" href="#generating-keys" title="Permalink to this headline">¶</a></h2>
<p>The Chef Server generates two types of private keys: one for nodes and workstations (typically referred to as a &#8220;client key&#8221;) and the other for the organization. If (for any reason) a new key is required, the Chef Server can re-generate these keys.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="chef_why.html" title="Why Chef?"
             >next</a></li>
        <li class="right" >
          <a href="chef_overview_attributes.html" title="About Attributes"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>