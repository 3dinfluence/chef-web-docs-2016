

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>chef-shell &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="next" title="Videos" href="videos.html" />
    <link rel="prev" title="Style Guide" href="style_guide.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="videos.html" title="Videos"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="style_guide.html" title="Style Guide"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">chef-shell</a><ul>
<li><a class="reference internal" href="#modes">Modes</a></li>
<li><a class="reference internal" href="#breakpoint-resource">Breakpoint Resource</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#actions">Actions</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#providers">Providers</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configure">Configure</a><ul>
<li><a class="reference internal" href="#chef-shell-rb">chef_shell.rb</a></li>
<li><a class="reference internal" href="#run-as-a-chef-client">Run as a chef-client</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manage">Manage</a></li>
<li><a class="reference internal" href="#debug-recipes">Debug Recipes</a><ul>
<li><a class="reference internal" href="#id1">Breakpoint Resource</a></li>
<li><a class="reference internal" href="#step-through-a-run-list">Step Through a Run-list</a></li>
<li><a class="reference internal" href="#debug-existing-recipe">Debug Existing Recipe</a></li>
<li><a class="reference internal" href="#advanced-debugging">Advanced Debugging</a></li>
<li><a class="reference internal" href="#help">Help</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2">Examples</a><ul>
<li><a class="reference internal" href="#hello-world">&#8220;Hello World&#8221;</a></li>
<li><a class="reference internal" href="#get-specific-nodes">Get Specific Nodes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="chef-shell">
<h1>chef-shell<a class="headerlink" href="#chef-shell" title="Permalink to this headline">¶</a></h1>
<p>chef-shell is a recipe debugging tool for Chef that allows the use of breakpoints within recipes. chef-shell runs as an Interactive Ruby (IRb) session. chef-shell supports both recipe and attribute file syntax, as well as interactive debugging features.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">chef-shell is the new name for Shef as of Chef 11.0.0. chef-shell is backwards compatible and aside from the name change, has the same set of functionality as with previous releases of Chef.</p>
</div>
<div class="section" id="modes">
<h2>Modes<a class="headerlink" href="#modes" title="Permalink to this headline">¶</a></h2>
<p>chef-shell is tool that allows Knife to be run using an Interactive Ruby (IRb) session. chef-shell currently supports recipe and attribute file syntax, as well as interactive debugging features. chef-shell has three run modes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Standalone</td>
<td>No cookbooks are loaded, and the run list is empty. This mode is the default.</td>
</tr>
<tr class="row-odd"><td>Solo</td>
<td>chef-shell acts as a chef-solo client. It attempts to load the chef-solo configuration file and JSON attributes. If the JSON attributes set a run list, it will be honored. Cookbooks will be loaded in the same way that chef-solo loads them. chef-solo mode is activated with the <tt class="docutils literal"><span class="pre">-s</span></tt> or <tt class="docutils literal"><span class="pre">--solo</span></tt> command line option, and JSON attributes are specified in the same way as for chef-solo, with <tt class="docutils literal"><span class="pre">-j</span> <span class="pre">/path/to/chef-solo.json</span></tt>.</td>
</tr>
<tr class="row-even"><td>Client</td>
<td>chef-shell acts as a chef-client. During startup, it reads the chef-client configuration file and contacts the Chef Server to get attributes and cookbooks. The run list will be set in the same way as normal chef-client runs. chef-client mode is activated with the <tt class="docutils literal"><span class="pre">-z</span></tt> or <tt class="docutils literal"><span class="pre">--client</span></tt> options. You can also specify the configuration file with <tt class="docutils literal"><span class="pre">-c</span> <span class="pre">CONFIG</span></tt> and the server URL with <tt class="docutils literal"><span class="pre">-S</span> <span class="pre">SERVER_URL</span></tt>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="breakpoint-resource">
<h2>Breakpoint Resource<a class="headerlink" href="#breakpoint-resource" title="Permalink to this headline">¶</a></h2>
<p>The <strong>breakpoint</strong> resource is used to add breakpoints to recipes in the same way as any other resource. When Chef is run in chef-shell mode, those breakpoints can be used to debug recipes. Breakpoints are ignored by Chef during an actual Chef run.  In general, breakpoints are used most often in a non-production environment, for the purpose of debugging recipes. After those recipes are debugged and the desired behavior has been tested, the breakpoints are typically removed from the recipes before uploading the cookbooks to a production environment (even if Chef ignores then when building the resource collection during an official Chef run).</p>
<div class="section" id="syntax">
<h3>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h3>
<p>The syntax for using the <strong>breakpoint</strong> resource in a recipe is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">breakpoint</span> <span class="s2">&quot;name&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">:break</span></tt> will tell Chef to stop running a recipe at this point when Chef is being run in chef-shell mode</li>
</ul>
</div>
<div class="section" id="actions">
<h3>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Action</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:break</span></tt></td>
<td>Use to add a breakpoint to a recipe.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<p>This resource does not have any attributes.</p>
</div>
<div class="section" id="providers">
<h3>Providers<a class="headerlink" href="#providers" title="Permalink to this headline">¶</a></h3>
<p>The following providers are available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="15%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Long name</th>
<th class="head">Short name</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Chef::Provider::Breakpoint</span></tt></td>
<td>breakpoint</td>
<td>The default provider for all recipes.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Opscode uses resources in recipes, take a closer look at the cookbooks that Opscode authors and maintains: <a class="reference external" href="https://github.com/opscode-cookbooks">https://github.com/opscode-cookbooks</a>.</p>
<p><strong>A recipe without a breakpoint</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">yum_key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">url</span>  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key_url&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:add</span>
<span class="k">end</span>

<span class="n">yum_repository</span> <span class="s2">&quot;elrepo&quot;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s2">&quot;ELRepo.org Community Enterprise Linux Extras Repository&quot;</span>
  <span class="n">key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span>
  <span class="n">mirrorlist</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">includepkgs</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;includepkgs&#39;</span><span class="o">]</span>
  <span class="n">exclude</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;exclude&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>The same recipe with breakpoints</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">breakpoint</span> <span class="s2">&quot;before yum_key node[&#39;yum&#39;][&#39;repo_name&#39;][&#39;key&#39;]&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">yum_key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">url</span>  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key_url&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:add</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;after yum_key node[&#39;yum&#39;][&#39;repo_name&#39;][&#39;key&#39;]&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;before yum_repository &#39;repo_name&#39;&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">yum_repository</span> <span class="s2">&quot;repo_name&quot;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s2">&quot;description&quot;</span>
  <span class="n">key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span>
  <span class="n">mirrorlist</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">includepkgs</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;includepkgs&#39;</span><span class="o">]</span>
  <span class="n">exclude</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;exclude&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;after yum_repository &#39;repo_name&#39;&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">&quot;name&quot;</span></tt> of each breakpoint is an arbitrary string. In the previous example, <tt class="docutils literal"><span class="pre">&quot;name&quot;</span></tt> is used to indicate if the breakpoint is before or after a resource, and then also to specify which resource.</p>
</div>
</div>
<div class="section" id="configure">
<h2>Configure<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h2>
<p>chef-shell determines which configuration file to load based on the following:</p>
<ol class="arabic simple">
<li>If a configuration file is specified using the <tt class="docutils literal"><span class="pre">-c</span></tt> option, chef-shell will use the specified configuration file</li>
<li>When chef-shell is started using a named configuration as an argument, chef-shell will search for a chef_shell.rb file in that directory under <tt class="docutils literal"><span class="pre">~/.chef</span></tt>. For example, if chef-shell is started using <tt class="docutils literal"><span class="pre">production</span></tt> as the named configuration, Chef will load a configuration file from <tt class="docutils literal"><span class="pre">~/.chef/production/chef_shell.rb</span></tt></li>
<li>If a named configuration is not provided, chef-shell will attempt to load the chef_shell.rb file from the <tt class="docutils literal"><span class="pre">.chef</span></tt> directory. For example: <tt class="docutils literal"><span class="pre">~/.chef/chef_shell.rb</span></tt></li>
<li>If a chef_shell.rb file is not found, chef-shell will attempt to load the client.rb file</li>
<li>If a chef_shell.rb file is not found, chef-shell will attempt to load the solo.rb file</li>
</ol>
<div class="section" id="chef-shell-rb">
<h3>chef_shell.rb<a class="headerlink" href="#chef-shell-rb" title="Permalink to this headline">¶</a></h3>
<p>The chef_shell.rb file can be used to configure chef-shell in the same way as the client.rb file is used to configure the chef-client. For example, to configure chef-shell to authenticate to the Chef Server, copy the <tt class="docutils literal"><span class="pre">node_name</span></tt>, <tt class="docutils literal"><span class="pre">client_key</span></tt>, and <tt class="docutils literal"><span class="pre">chef_server_url</span></tt> settings from the knife.rb file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">node_name</span>                <span class="s1">&#39;your-knife-clientname&#39;</span>
<span class="n">client_key</span>               <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;~/.chef/my-client.pem&#39;</span><span class="p">)</span>
<span class="n">chef_server_url</span>          <span class="s1">&#39;https://api.opscode.com/organizations/myorg&#39;</span>
</pre></div>
</div>
<p>and then add them to the chef_shell.rb file. Other configuration possibilities include disabling Ohai plugins (which will speed up the chef-shell boot process) or including arbitrary Ruby code in the chef_shell.rb file.</p>
</div>
<div class="section" id="run-as-a-chef-client">
<h3>Run as a chef-client<a class="headerlink" href="#run-as-a-chef-client" title="Permalink to this headline">¶</a></h3>
<p>By default, chef-shell loads in standalone mode and does not connect to the Chef Server. The chef-shell can be run as a chef-client to verify functionality that is only available when the chef-client connects to the Chef Server, such as search functionality or accessing data stored in data bags.</p>
<p>chef-shell can use the same credentials as Knife when connecting to a Chef Server. Make sure that the settings in chef_shell.rb are the same as those in knife.rb, and then use the <tt class="docutils literal"><span class="pre">-z</span></tt> option as part of the command. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef-shell -z
</pre></div>
</div>
</div>
</div>
<div class="section" id="manage">
<h2>Manage<a class="headerlink" href="#manage" title="Permalink to this headline">¶</a></h2>
<p>When chef-shell is configured to access a Chef Server, chef-shell can list, show, search for and edit cookbooks, clients, nodes, roles, environments, and data bags.</p>
<p>The syntax for managing objects on the Chef Server is as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef <span class="o">(</span>named_configuration<span class="o">)</span> &gt; items.command
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">named_configuration</span></tt> is a named configuration, such as <tt class="docutils literal"><span class="pre">production</span></tt>, <tt class="docutils literal"><span class="pre">staging</span></tt>, or <tt class="docutils literal"><span class="pre">test</span></tt></li>
<li><tt class="docutils literal"><span class="pre">items</span></tt> is the type of item to search for: <tt class="docutils literal"><span class="pre">cookbooks</span></tt>, <tt class="docutils literal"><span class="pre">clients</span></tt>, <tt class="docutils literal"><span class="pre">nodes</span></tt>, <tt class="docutils literal"><span class="pre">roles</span></tt>, <tt class="docutils literal"><span class="pre">environments</span></tt> or a data bag</li>
<li><tt class="docutils literal"><span class="pre">command</span></tt> is the command: <tt class="docutils literal"><span class="pre">list</span></tt>, <tt class="docutils literal"><span class="pre">show</span></tt>, <tt class="docutils literal"><span class="pre">find</span></tt>, or <tt class="docutils literal"><span class="pre">edit</span></tt></li>
</ul>
<p>For example, to list all of the nodes in a configuration named &#8220;preprod&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef <span class="o">(</span>preprod<span class="o">)</span> &gt; nodes.list
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="o">=</span>&gt; <span class="o">[</span>node<span class="o">[</span>i-f09a939b<span class="o">]</span>, node<span class="o">[</span>i-049a936f<span class="o">]</span>, node<span class="o">[</span>i-eaaaa581<span class="o">]</span>, node<span class="o">[</span>i-9154b1fb<span class="o">]</span>,
     node<span class="o">[</span>i-6a213101<span class="o">]</span>, node<span class="o">[</span>i-c2687aa9<span class="o">]</span>, node<span class="o">[</span>i-7abeaa11<span class="o">]</span>, node<span class="o">[</span>i-4eb8ac25<span class="o">]</span>,
     node<span class="o">[</span>i-9a2030f1<span class="o">]</span>, node<span class="o">[</span>i-a06875cb<span class="o">]</span>, node<span class="o">[</span>i-145f457f<span class="o">]</span>, node<span class="o">[</span>i-e032398b<span class="o">]</span>,
     node<span class="o">[</span>i-dc8c98b7<span class="o">]</span>, node<span class="o">[</span>i-6afdf401<span class="o">]</span>, node<span class="o">[</span>i-f49b119c<span class="o">]</span>, node<span class="o">[</span>i-5abfab31<span class="o">]</span>,
     node<span class="o">[</span>i-78b8ac13<span class="o">]</span>, node<span class="o">[</span>i-d99678b3<span class="o">]</span>, node<span class="o">[</span>i-02322269<span class="o">]</span>, node<span class="o">[</span>i-feb4a695<span class="o">]</span>,
     node<span class="o">[</span>i-9e2232f5<span class="o">]</span>, node<span class="o">[</span>i-6e213105<span class="o">]</span>, node<span class="o">[</span>i-cdde3ba7<span class="o">]</span>, node<span class="o">[</span>i-e8bfb083<span class="o">]</span>,
     node<span class="o">[</span>i-743c2c1f<span class="o">]</span>, node<span class="o">[</span>i-2eaca345<span class="o">]</span>, node<span class="o">[</span>i-aa7f74c1<span class="o">]</span>, node<span class="o">[</span>i-72fdf419<span class="o">]</span>,
     node<span class="o">[</span>i-140e1e7f<span class="o">]</span>, node<span class="o">[</span>i-f9d43193<span class="o">]</span>, node<span class="o">[</span>i-bd2dc8d7<span class="o">]</span>, node<span class="o">[</span>i-8e7f70e5<span class="o">]</span>,
     node<span class="o">[</span>i-78f2e213<span class="o">]</span>, node<span class="o">[</span>i-962232fd<span class="o">]</span>, node<span class="o">[</span>i-4c322227<span class="o">]</span>, node<span class="o">[</span>i-922232f9<span class="o">]</span>,
     node<span class="o">[</span>i-c02728ab<span class="o">]</span>, node<span class="o">[</span>i-f06c7b9b<span class="o">]]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">list</span></tt> command can take a code block, which will applied (but not saved) to each object that is returned from the server. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef <span class="o">(</span>preprod<span class="o">)</span> &gt; nodes.list <span class="o">{</span>|n| puts <span class="s2">&quot;#{n.name}: #{n.run_list}&quot;</span> <span class="o">}</span>
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="o">=</span>&gt; i-f09a939b: role<span class="o">[</span>lb<span class="o">]</span>, role<span class="o">[</span>preprod<span class="o">]</span>, recipe<span class="o">[</span>aws<span class="o">]</span>
     i-049a936f: role<span class="o">[</span>lb<span class="o">]</span>, role<span class="o">[</span>preprod<span class="o">]</span>, recipe<span class="o">[</span>aws<span class="o">]</span>
     i-9154b1fb: recipe<span class="o">[</span>erlang<span class="o">]</span>, role<span class="o">[</span>base<span class="o">]</span>, role<span class="o">[</span>couchdb<span class="o">]</span>, role<span class="o">[</span>preprod<span class="o">]</span>,
     i-6a213101: role<span class="o">[</span>chef<span class="o">]</span>, role<span class="o">[</span>preprod<span class="o">]</span>
     <span class="c"># more...</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">show</span></tt> command can be used to display a specific node. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef <span class="o">(</span>preprod<span class="o">)</span> &gt; <span class="nv">load_balancer</span> <span class="o">=</span> nodes.show<span class="o">(</span><span class="s1">&#39;i-f09a939b&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="o">=</span>&gt; node<span class="o">[</span>i-f09a939b<span class="o">]</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef <span class="o">(</span>preprod<span class="o">)</span> &gt; load_balancer.ec2.public_hostname
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="o">=</span>&gt; <span class="s2">&quot;ec2-111-22-333-44.compute-1.amazonaws.com&quot;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">find</span></tt> command can be used to search the Chef Server from the chef-shell. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef <span class="o">(</span>preprod<span class="o">)</span> &gt; pp nodes.find<span class="o">(</span>:ec2_public_hostname <span class="o">=</span>&gt; <span class="s1">&#39;ec2*&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>A code block can be used to format the results. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef <span class="o">(</span>preprod<span class="o">)</span> &gt; pp nodes.find<span class="o">(</span>:ec2_public_hostname <span class="o">=</span>&gt; <span class="s1">&#39;ec2*&#39;</span><span class="o">)</span> <span class="o">{</span>|n| n.ec2.ami_id <span class="o">}</span> and nil
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;ami-f8927a91&quot;</span>,
      <span class="s2">&quot;ami-f8927a91&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>
      <span class="c"># and more...</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-bash"><div class="highlight"><pre>chef <span class="o">(</span>preprod<span class="o">)</span> &gt; <span class="nv">amis</span> <span class="o">=</span> nodes.find<span class="o">(</span>:ec2_public_hostname <span class="o">=</span>&gt; <span class="s1">&#39;ec2*&#39;</span><span class="o">)</span> <span class="o">{</span>|n| n.ec2.ami_id <span class="o">}</span>
chef <span class="o">(</span>preprod<span class="o">)</span> &gt; puts amis.uniq.sort
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="o">=</span>&gt; ami-4b4ba522
     ami-a89870c1
     ami-eef61587
     ami-f8927a91
</pre></div>
</div>
</div>
<div class="section" id="debug-recipes">
<h2>Debug Recipes<a class="headerlink" href="#debug-recipes" title="Permalink to this headline">¶</a></h2>
<p>chef-shell allows the current position in a run-list to be manipulated during a Chef run. Add breakpoints to a recipe to take advantage of this functionality.</p>
<div class="section" id="id1">
<h3>Breakpoint Resource<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>A breakpoint is implemented in the same way as any Chef resource. The <strong>breakpoint</strong> resource does not have any attributes. Its default action is <tt class="docutils literal"><span class="pre">:break</span></tt>. When this action is placed in a recipe, Chef will determine if it is being run in chef-shell mode, and then if it is running in chef-shell mode, the Chef run is paused. (When Chef is running as the chef-client or as chef-solo, the <tt class="docutils literal"><span class="pre">:break</span></tt> action is ignored.)</p>
</div>
<div class="section" id="step-through-a-run-list">
<h3>Step Through a Run-list<a class="headerlink" href="#step-through-a-run-list" title="Permalink to this headline">¶</a></h3>
<p>To explore how using the <strong>breakpoint</strong> to manually step through a Chef run, create a simple recipe in chef-shell:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef &gt; recipe
  chef:recipe &gt; <span class="nb">echo </span>off
  chef:recipe &gt; file <span class="s2">&quot;/tmp/before-breakpoint&quot;</span>
  chef:recipe &gt; breakpoint <span class="s2">&quot;foo&quot;</span>
  chef:recipe &gt; file <span class="s2">&quot;/tmp/after-breakpoint&quot;</span>
</pre></div>
</div>
<p>and then run Chef:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; run_chef
  <span class="o">[</span>Fri, 15 Jan 2010 14:17:49 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, 15 Jan 2010 14:17:49 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, 15 Jan 2010 14:17:49 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> at /tmp/before-breakpoint
  <span class="o">[</span>Fri, 15 Jan 2010 14:17:49 -0800<span class="o">]</span> DEBUG: Processing <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="sb">`</span>new<span class="s1">&#39;]</span>
<span class="s1">  [Fri, 15 Jan 2010 14:17:49 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in `new&#39;</span><span class="o">]</span> using Chef::Provider::Breakpoint
</pre></div>
</div>
<p>Chef ran the first resource before the breakpoint (<tt class="docutils literal"><span class="pre">file[/tmp/before-breakpoint]</span></tt>), but then stopped after execution. Chef attempted to name the breakpoint after its position in the source file, but Chef was confused because the resource was entered interactively. From here, chef-shell can resume the Chef run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; chef_run.resume
  <span class="o">[</span>Fri, 15 Jan 2010 14:27:08 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span> at /tmp/after-breakpoint
</pre></div>
</div>
<p>A quick view of the <tt class="docutils literal"><span class="pre">/tmp</span></tt> directory shows that the following files were created:</p>
<div class="highlight-bash"><div class="highlight"><pre>after-breakpoint
before-breakpoint
</pre></div>
</div>
<p>The Chef run can also be rewound, and then stepped through.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; Chef::Log.level <span class="o">=</span> :debug <span class="c"># debug logging won&#39;t turn on automatically in this case</span>
    <span class="o">=</span>&gt; :debug
  chef:recipe &gt; chef_run.rewind
    <span class="o">=</span>&gt; 0
  chef:recipe &gt; chef_run.step
  <span class="o">[</span>Fri, 15 Jan 2010 14:40:52 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, 15 Jan 2010 14:40:52 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> using Chef::Provider::File
    <span class="o">=</span>&gt; 1
  chef:recipe &gt; chef_run.step
  <span class="o">[</span>Fri, 15 Jan 2010 14:40:54 -0800<span class="o">]</span> DEBUG: Processing <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="sb">`</span>new<span class="s1">&#39;]</span>
<span class="s1">  [Fri, 15 Jan 2010 14:40:54 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in `new&#39;</span><span class="o">]</span> using Chef::Provider::Breakpoint
    <span class="o">=</span>&gt; 2
  chef:recipe &gt; chef_run.step
  <span class="o">[</span>Fri, 15 Jan 2010 14:40:56 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, 15 Jan 2010 14:40:56 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span> using Chef::Provider::File
    <span class="o">=</span>&gt; 3
</pre></div>
</div>
<p>From the output, the rewound run-list is shown, but when the resources are executed again, they will repeat their checks for the existence of files. If they exist, Chef will skip creating them. If the files are deleted, then:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; ls<span class="o">(</span><span class="s2">&quot;/tmp&quot;</span><span class="o">)</span>.grep<span class="o">(</span>/breakpoint/<span class="o">)</span>.each <span class="o">{</span>|f| rm <span class="s2">&quot;/tmp/#{f}&quot;</span> <span class="o">}</span>
    <span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;after-breakpoint&quot;</span>, <span class="s2">&quot;before-breakpoint&quot;</span><span class="o">]</span>
</pre></div>
</div>
<p>Rewind, and then resume the Chef run to get the expected results:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; chef_run.rewind
  chef:recipe &gt; chef_run.resume
  <span class="o">[</span>Fri, 15 Jan 2010 14:48:56 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, 15 Jan 2010 14:48:56 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, 15 Jan 2010 14:48:56 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> at /tmp/before-breakpoint
  <span class="o">[</span>Fri, 15 Jan 2010 14:48:56 -0800<span class="o">]</span> DEBUG: Processing <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="sb">`</span>new<span class="s1">&#39;]</span>
<span class="s1">  [Fri, 15 Jan 2010 14:48:56 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in `new&#39;</span><span class="o">]</span> using Chef::Provider::Breakpoint
  chef:recipe &gt; chef_run.resume
  <span class="o">[</span>Fri, 15 Jan 2010 14:49:20 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, 15 Jan 2010 14:49:20 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, 15 Jan 2010 14:49:20 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span> at /tmp/after-breakpoint
</pre></div>
</div>
</div>
<div class="section" id="debug-existing-recipe">
<h3>Debug Existing Recipe<a class="headerlink" href="#debug-existing-recipe" title="Permalink to this headline">¶</a></h3>
<p>chef-shell can be used to debug existing recipes. The recipe first needs to be added to a run-list for the node, so that it is cached when starting chef-shell and then used for debugging. chef-shell will report which recipes are being cached when it is started:</p>
<div class="highlight-bash"><div class="highlight"><pre>Loading....<span class="o">[</span>Fri, 18 May 2012 11:30:08 -0700<span class="o">]</span> INFO: Run List is <span class="o">[</span>recipe<span class="o">[</span>getting-started<span class="o">]]</span>
<span class="o">[</span>Fri, 18 May 2012 11:30:08 -0700<span class="o">]</span> INFO: Run List expands to <span class="o">[</span>getting-started<span class="o">]</span>
<span class="o">[</span>Fri, 18 May 2012 11:30:09 -0700<span class="o">]</span> INFO: Loading cookbooks <span class="o">[</span>getting-started<span class="o">]</span>
<span class="k">done</span>.

This is chef-shell, the Chef shell.
 Chef Version: 0.10.10
 http://www.opscode.com/chef
 docs.opscode.com

run <span class="sb">`</span><span class="nb">help</span><span class="s1">&#39; for help, `exit&#39;</span> or ^D to quit.

Ohai2u NODENAME!
chef &gt;
</pre></div>
</div>
<p>To just load one recipe from the run-list, go into the recipe and use the <tt class="docutils literal"><span class="pre">include_recipe</span></tt> command. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef &gt; recipe
  chef:recipe &gt; include_recipe <span class="s2">&quot;getting-started&quot;</span>
    <span class="o">=</span>&gt; <span class="o">[</span><span class="c">#&lt;Chef::Recipe:0x10256f9e8 @cookbook_name=&quot;getting-started&quot;,</span>
  ... output truncated ...
</pre></div>
</div>
<p>To load all of the recipes from a run-list, use code similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">node</span><span class="o">.</span><span class="n">run_list</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span><span class="p">)</span><span class="o">.</span><span class="n">recipes</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
  <span class="n">include_recipe</span> <span class="n">r</span>
<span class="k">end</span>
</pre></div>
</div>
<p>After the recipes that are to be debugged have been loaded, use the <tt class="docutils literal"><span class="pre">run_chef</span></tt> command to run them.</p>
</div>
<div class="section" id="advanced-debugging">
<h3>Advanced Debugging<a class="headerlink" href="#advanced-debugging" title="Permalink to this headline">¶</a></h3>
<p>In chef-shell, it is possible to get extremely verbose debugging using the tracing feature in Interactive Ruby (IRb). chef-shell provides a shortcut for turning tracing on and off. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef &gt; tracing on
  /Users/danielsdeleo/.rvm/ree-1.8.7-2009.10/lib/ruby/1.8/tracer.rb:150: warning: tried to create Proc object without a block
  /Users/danielsdeleo/.rvm/ree-1.8.7-2009.10/lib/ruby/1.8/tracer.rb:146: warning: tried to create Proc object without a block
  tracing is <span class="nv">on</span>
    <span class="o">=</span>&gt; nil
</pre></div>
</div>
<p>and:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef &gt; tracing off
  <span class="c">#0:(irb):2:Object:-: tracing off</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:78:Shell::Extensions::Object:&gt;:       def off</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:79:Shell::Extensions::Object:-:         :off</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:79:Shell::Extensions::Object:&lt;:         :off</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:259:Object:&gt;:   def tracing(on_or_off)</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:260:Object:-:     conf.use_tracer = on_or_off.on_off_to_bool</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:135:Shell::Extensions::Symbol:&gt;:       def on_off_to_bool</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:136:Shell::Extensions::Symbol:-:         self.to_s.on_off_to_bool</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:136:Symbol:&gt;:         self.to_s.on_off_to_bool</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:136:Symbol:&lt;:         self.to_s.on_off_to_bool</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:122:Shell::Extensions::String:&gt;:       def on_off_to_bool</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:123:Shell::Extensions::String:-:         case self</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:124:Shell::Extensions::String:-:         when &quot;on&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:124:Kernel:&gt;:         when &quot;on&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:124:String:&gt;:         when &quot;on&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:124:String:&lt;:         when &quot;on&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:124:Kernel:&lt;:         when &quot;on&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:126:Shell::Extensions::String:-:         when &quot;off&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:126:Kernel:&gt;:         when &quot;off&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:126:String:&gt;:         when &quot;off&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:126:String:&lt;:         when &quot;off&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:126:Kernel:&lt;:         when &quot;off&quot;</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:127:Shell::Extensions::String:-:           false</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:127:Shell::Extensions::String:&lt;:           false</span>
  <span class="c">#0:./bin/../lib/chef/shef/ext.rb:136:Shell::Extensions::Symbol:&lt;:         self.to_s.on_off_to_bool</span>
  tracing is <span class="nv">off</span>
    <span class="o">=</span>&gt; nil
  chef &gt;
</pre></div>
</div>
</div>
<div class="section" id="help">
<h3>Help<a class="headerlink" href="#help" title="Permalink to this headline">¶</a></h3>
<p>Use the <tt class="docutils literal"><span class="pre">--help</span></tt> option in chef-shell to view help.</p>
</div>
</div>
<div class="section" id="id2">
<h2>Examples<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>The following examples show how to use chef-shell to debug recipes.</p>
<div class="section" id="hello-world">
<h3>&#8220;Hello World&#8221;<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h3>
<p>This example shows how to run chef-shell in standalone mode. (For chef-solo or chef-client modes, you would need to run chef-shell using the -s or -z command line options, and then take into consideration the necessary configuration settings.)</p>
<p>When Chef is installed using RubyGems or a package manager, chef-shell should already be installed. When Chef is run from a git clone, it will be located in <tt class="docutils literal"><span class="pre">chef/bin/chef</span> <span class="pre">shell</span></tt>. To start chef-shell, just run it without any options. You&#8217;ll see the loading message, then the banner, and then the chef-shell prompt:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>bin/shef
  ./bin/../lib/chef.rb:30: warning: already initialized constant VERSION
  loading configuration: none <span class="o">(</span>standalone shef session<span class="o">)</span>
  Loading.......done.

  This is shef, the Chef shell.
   Chef Version: 0.10.4
   http://www.opscode.com/chef
   http://wiki.opscode.com/display/chef/Home

run <span class="sb">`</span><span class="nb">help</span><span class="s1">&#39; for help, `exit&#39;</span> or ^D to quit.

Ohai2u danielsdeleo@eigenstate.local!
chef &gt;
</pre></div>
</div>
<p>(Use the help command to print a list of supported commands.) Use the recipe command to switch to recipe context:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef &gt; recipe
  chef:recipe &gt;
</pre></div>
</div>
<p>Typing is evaluated in the same context as recipes. Create a file resource:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; file <span class="s2">&quot;/tmp/ohai2u_shef&quot;</span>
    <span class="o">=</span>&gt; <span class="c">#&lt;Chef::Resource::File:0x1b691ac @enclosing_provider=nil, @resource_name=:file, @before=nil,</span>
       @supports<span class="o">={}</span>, @backup<span class="o">=</span>5, @allowed_actions<span class="o">=[</span>:nothing, :create, :delete, :touch, :create_if_missing<span class="o">]</span>,
       @only_if<span class="o">=</span>nil, @noop<span class="o">=</span>nil, @collection<span class="o">=</span><span class="c">#&lt;Chef::ResourceCollection:0x1b9926c @insert_after_idx=nil,</span>
       @resources_by_name<span class="o">={</span><span class="s2">&quot;file[/tmp/ohai2u_shef]&quot;</span><span class="o">=</span>&gt;0<span class="o">}</span>, @resources<span class="o">=[</span><span class="c">#&lt;Chef::Resource::File:0x1b691ac ...&gt;]&gt;,</span>
       @updated<span class="o">=</span><span class="nb">false</span>, @provider<span class="o">=</span>nil, @node<span class="o">=</span>&lt;Chef::Node:0xdeeaae @name<span class="o">=</span><span class="s2">&quot;eigenstate.local&quot;</span>&gt;, @recipe_name<span class="o">=</span>nil,
       @not_if<span class="o">=</span>nil, @name<span class="o">=</span><span class="s2">&quot;/tmp/ohai2u_shef&quot;</span>, @action<span class="o">=</span><span class="s2">&quot;create&quot;</span>, @path<span class="o">=</span><span class="s2">&quot;/tmp/ohai2u_shef&quot;</span>,
       @source_line<span class="o">=</span><span class="s2">&quot;/Users/danielsdeleo/ruby/chef/chef/(irb#1) line 1&quot;</span>, @params<span class="o">={}</span>, @actions<span class="o">={}</span>,
       @cookbook_name<span class="o">=</span>nil, @ignore_failure<span class="o">=</span><span class="nb">false</span>&gt;
</pre></div>
</div>
<p>(The previous example was formatted for presentation.) At this point, chef-shell has created the resource and put it in the run list, but not yet created the file. To initiate the Chef run, use the <tt class="docutils literal"><span class="pre">run_chef</span></tt> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; run_chef
  <span class="o">[</span>Fri, 15 Jan 2010 10:42:47 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span>
  <span class="o">[</span>Fri, 15 Jan 2010 10:42:47 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, 15 Jan 2010 10:42:47 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span> at /tmp/ohai2u_shef
    <span class="o">=</span>&gt; <span class="nb">true</span>
</pre></div>
</div>
<p>chef-shell can also switch to the same context as attribute files. Set an attribute with the following syntax:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; attributes
  chef:attributes &gt; <span class="nb">set</span><span class="o">[</span>:hello<span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;ohai2u-again&quot;</span>
    <span class="o">=</span>&gt; <span class="s2">&quot;ohai2u-again&quot;</span>
  chef:attributes &gt;
</pre></div>
</div>
<p>Switch back to recipe context and use the attributes:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:attributes &gt; <span class="nv">recipe</span>
    <span class="o">=</span>&gt; :attributes
  chef:recipe &gt; file <span class="s2">&quot;/tmp/#{node.hello}&quot;</span>
</pre></div>
</div>
<p>Now, run Chef again:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; run_chef
  <span class="o">[</span>Fri, 15 Jan 2010 10:53:22 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span>
  <span class="o">[</span>Fri, 15 Jan 2010 10:53:22 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, 15 Jan 2010 10:53:22 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/ohai2u-again<span class="o">]</span>
  <span class="o">[</span>Fri, 15 Jan 2010 10:53:22 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/ohai2u-again<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, 15 Jan 2010 10:53:22 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/ohai2u-again<span class="o">]</span> at /tmp/ohai2u-again
    <span class="o">=</span>&gt; <span class="nb">true</span>
<span class="nb">  </span>chef:recipe &gt;
</pre></div>
</div>
<p>Because the first resource (<tt class="docutils literal"><span class="pre">file[/tmp/ohai2u_shef]</span></tt>) is still in the run-list, it gets executed again. And because that file already exists, Chef doesn&#8217;t attempt to re-create it. Finally, the files were created using the <tt class="docutils literal"><span class="pre">ls</span></tt> method:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chef:recipe &gt; ls<span class="o">(</span><span class="s2">&quot;/tmp&quot;</span><span class="o">)</span>.grep<span class="o">(</span>/ohai/<span class="o">)</span>
    <span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;ohai2u-again&quot;</span>, <span class="s2">&quot;ohai2u_shef&quot;</span><span class="o">]</span>
      Shell Tutorial
</pre></div>
</div>
</div>
<div class="section" id="get-specific-nodes">
<h3>Get Specific Nodes<a class="headerlink" href="#get-specific-nodes" title="Permalink to this headline">¶</a></h3>
<p>To get a list of nodes using a recipe named <tt class="docutils literal"><span class="pre">postfix</span></tt> use <tt class="docutils literal"><span class="pre">search(:node,&quot;recipe:postfix&quot;)</span></tt>. To get a list of nodes using a sub-recipe named <tt class="docutils literal"><span class="pre">delivery</span></tt>, use chef-shell. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">search</span><span class="p">(</span><span class="ss">:node</span><span class="p">,</span> <span class="s1">&#39;recipes:postfix\:\:delivery&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Single (&#8216; &#8216;) vs. double (&#8221; &#8221;) is important. This is because a backslash () needs to be included in the string, instead of having Ruby interpret it as an escape.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="videos.html" title="Videos"
             >next</a></li>
        <li class="right" >
          <a href="style_guide.html" title="Style Guide"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>