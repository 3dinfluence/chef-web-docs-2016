

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Custom Knife Plugins &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="up" title="About Knife Plugins" href="plugin_knife.html" />
    <link rel="next" title="knife pushy" href="plugin_knife_pushy.html" />
    <link rel="prev" title="Authenticated API Requests" href="plugin_knife_authenticated_requests.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="plugin_knife_pushy.html" title="knife pushy"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="plugin_knife_authenticated_requests.html" title="Authenticated API Requests"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="plugin_knife.html" accesskey="U">About Knife Plugins</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Custom Knife Plugins</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a><ul>
<li><a class="reference internal" href="#namespace">Namespace</a></li>
<li><a class="reference internal" href="#class-name">Class Name</a></li>
<li><a class="reference internal" href="#banner">Banner</a></li>
<li><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#options">Options</a></li>
<li><a class="reference internal" href="#arguments">Arguments</a></li>
<li><a class="reference internal" href="#knife-rb-settings">knife.rb Settings</a></li>
<li><a class="reference internal" href="#search">Search</a></li>
<li><a class="reference internal" href="#user-interaction">User Interaction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-a-plugin">Create a Plugin</a></li>
<li><a class="reference internal" href="#exceptions">Exceptions</a></li>
<li><a class="reference internal" href="#install-a-plugin">Install a Plugin</a></li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="custom-knife-plugins">
<h1>Custom Knife Plugins<a class="headerlink" href="#custom-knife-plugins" title="Permalink to this headline">¶</a></h1>
<p>A Knife plugin is a set of one (or more) subcommands that can be added to Knife to support additional functionality that is not built-in to the base set of Knife subcommands. Many of the Knife plugins are built by members of the Opscode community and several of them are built and maintained by Opscode. A Knife plugin is installed to the ~/.chef/plugins/knife/ directory, from where it can be run just like any other Knife subcommand.</p>
<p>Chef will load Knife and Knife plugin commands from the following locations:</p>
<ul class="simple">
<li>The home directory: <tt class="docutils literal"><span class="pre">~/.chef/plugins/knife/</span></tt></li>
<li>A <tt class="docutils literal"><span class="pre">.chef/plugins/knife</span></tt> directory in the cookbook repository</li>
<li>A plugin installed from RubyGems. (For more information about releasing a plugin on RubyGems, see: <a class="reference external" href="http://guides.rubygems.org/make-your-own-gem/">http://guides.rubygems.org/make-your-own-gem/</a>.)</li>
</ul>
<p>This approach allows Knife plugins to be reused across projects in the home directory, kept in a repository that is accessible to other team members, and distributable to the Chef community using RubyGems.</p>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<p>There are many ways to structure a Knife plugin. The following syntax shows a typical Knife plugin:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;chef/knife&#39;</span>
<span class="c1"># other require attributes, as needed</span>

<span class="k">module</span> <span class="nn">ModuleName</span>
  <span class="k">class</span> <span class="nc">SubclassName</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span>

  <span class="n">deps</span> <span class="k">do</span>
    <span class="nb">require</span> <span class="s1">&#39;chef/dependency&#39;</span>
    <span class="c1"># other dependencies, as needed</span>
  <span class="k">end</span>

  <span class="n">banner</span> <span class="s2">&quot;knife subcommand argument VALUE (options)&quot;</span>

  <span class="n">option</span> <span class="ss">:name_of_option</span><span class="p">,</span>
    <span class="ss">:short</span> <span class="o">=&gt;</span> <span class="s2">&quot;-l VALUE&quot;</span><span class="p">,</span>
    <span class="ss">:long</span> <span class="o">=&gt;</span> <span class="s2">&quot;--long-option-name VALUE&quot;</span><span class="p">,</span>
    <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;The description for the option.&quot;</span><span class="p">,</span>
    <span class="ss">:proc</span> <span class="o">=&gt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="n">code_to_run</span> <span class="p">}</span>
    <span class="ss">:boolean</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="o">|</span> <span class="kp">false</span>
    <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="n">default_value</span>

  <span class="k">def</span> <span class="nf">run</span>
    <span class="c1"># Ruby code goes here</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">require</span></tt> identifies any other Knife subcommands and/or Knife plugins required by this plugin</li>
<li><tt class="docutils literal"><span class="pre">module</span> <span class="pre">ModuleName</span></tt> declares the Knife plugin as its own namespace</li>
<li><tt class="docutils literal"><span class="pre">class</span> <span class="pre">SubclassName</span> <span class="pre">&lt;</span> <span class="pre">Chef::Knife</span></tt> declares the plugin as a subclass of Knife, which is in the Chef namespace. The capitalization of this name is important. For example, <tt class="docutils literal"><span class="pre">SubclassName</span></tt> would have a Knife command of <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">subclass</span> <span class="pre">name</span></tt>, whereas <tt class="docutils literal"><span class="pre">Subclassname</span></tt> would have a Knife command of <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">subclassname</span></tt></li>
<li><tt class="docutils literal"><span class="pre">deps</span> <span class="pre">do</span></tt> is a list of dependencies</li>
<li><tt class="docutils literal"><span class="pre">banner</span> <span class="pre">&quot;knife</span> <span class="pre">subcommand</span> <span class="pre">argument</span> <span class="pre">VALUE</span> <span class="pre">(options)&quot;</span></tt> is displayed when a user enters <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">subclassName</span> <span class="pre">--help</span></tt></li>
<li><tt class="docutils literal"><span class="pre">option</span> <span class="pre">:name_of_option</span></tt> defines each of the command-line options that are available for this plugin. For example, <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">subclass</span> <span class="pre">-l</span> <span class="pre">VALUE</span></tt> or <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">subclass</span> <span class="pre">--long-option-name</span> <span class="pre">VALUE</span></tt></li>
<li><tt class="docutils literal"><span class="pre">def</span> <span class="pre">run</span></tt> is the Ruby code that is executed when the command is run</li>
</ul>
<p>and where for each command-line option:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">:short</span></tt> defines the short option name</li>
<li><tt class="docutils literal"><span class="pre">:long</span></tt> defines the long option name</li>
<li><tt class="docutils literal"><span class="pre">:description</span></tt> defines a description that is displayed when a user enters <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">subclassName</span> <span class="pre">--help</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:boolean</span></tt> defines whether the option is <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>; if the <tt class="docutils literal"><span class="pre">:short</span></tt> and <tt class="docutils literal"><span class="pre">:long</span></tt> names define a <tt class="docutils literal"><span class="pre">VALUE</span></tt>, then this attribute must not be used</li>
<li><tt class="docutils literal"><span class="pre">:proc</span></tt> defines code that determines the value for this option</li>
<li><tt class="docutils literal"><span class="pre">:default</span></tt> defines a default value</li>
</ul>
<p>The following example shows part of a Knife plugin named <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">windows</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;chef/knife&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;chef/knife/winrm_base&#39;</span>

<span class="k">class</span> <span class="nc">Chef</span>
  <span class="k">class</span> <span class="nc">Knife</span>
    <span class="k">class</span> <span class="nc">Winrm</span> <span class="o">&lt;</span> <span class="no">Knife</span>

      <span class="kp">include</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span><span class="o">::</span><span class="no">WinrmBase</span>

      <span class="n">deps</span> <span class="k">do</span>
        <span class="nb">require</span> <span class="s1">&#39;readline&#39;</span>
        <span class="nb">require</span> <span class="s1">&#39;chef/search/query&#39;</span>
        <span class="nb">require</span> <span class="s1">&#39;em-winrm&#39;</span>
      <span class="k">end</span>

      <span class="kp">attr_writer</span> <span class="ss">:password</span>

      <span class="n">banner</span> <span class="s2">&quot;knife winrm QUERY COMMAND (options)&quot;</span>

      <span class="n">option</span> <span class="ss">:attribute</span><span class="p">,</span>
        <span class="ss">:short</span> <span class="o">=&gt;</span> <span class="s2">&quot;-a ATTR&quot;</span><span class="p">,</span>
        <span class="ss">:long</span> <span class="o">=&gt;</span> <span class="s2">&quot;--attribute ATTR&quot;</span><span class="p">,</span>
        <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;The attribute to use for opening the connection - default is fqdn&quot;</span><span class="p">,</span>
        <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s2">&quot;fqdn&quot;</span>

      <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="c1"># more options</span>

      <span class="k">def</span> <span class="nf">session</span>
        <span class="n">session_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">session_opts</span><span class="o">[</span><span class="ss">:logger</span><span class="o">]</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">logger</span> <span class="k">if</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="ss">:debug</span>
        <span class="vi">@session</span> <span class="o">||=</span> <span class="k">begin</span>
          <span class="n">s</span> <span class="o">=</span> <span class="no">EventMachine</span><span class="o">::</span><span class="no">WinRM</span><span class="o">::</span><span class="no">Session</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">session_opts</span><span class="p">)</span>
          <span class="n">s</span><span class="o">.</span><span class="n">on_output</span> <span class="k">do</span> <span class="o">|</span><span class="n">host</span><span class="p">,</span> <span class="n">data</span><span class="o">|</span>
            <span class="n">print_data</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
          <span class="k">end</span>
          <span class="n">s</span><span class="o">.</span><span class="n">on_error</span> <span class="k">do</span> <span class="o">|</span><span class="n">host</span><span class="p">,</span> <span class="n">err</span><span class="o">|</span>
            <span class="n">print_data</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="ss">:red</span><span class="p">)</span>
          <span class="k">end</span>
          <span class="n">s</span><span class="o">.</span><span class="n">on_command_complete</span> <span class="k">do</span> <span class="o">|</span><span class="n">host</span><span class="o">|</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">host</span> <span class="o">==</span> <span class="ss">:all</span> <span class="p">?</span> <span class="s1">&#39;All Servers&#39;</span> <span class="p">:</span> <span class="n">host</span>
            <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;command complete on </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
          <span class="k">end</span>
          <span class="n">s</span>
        <span class="k">end</span>

      <span class="k">end</span>

      <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="c1"># more def blocks</span>

    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Take a look at all of the code for this plugin on github: <a class="reference external" href="https://github.com/opscode/knife-windows/blob/master/lib/chef/knife/winrm.rb">https://github.com/opscode/knife-windows/blob/master/lib/chef/knife/winrm.rb</a>.</p>
<div class="section" id="namespace">
<h3>Namespace<a class="headerlink" href="#namespace" title="Permalink to this headline">¶</a></h3>
<p>A Knife plugin should have its own namespace (even though Knife will load a command regardless of its namespace). The namespace is declared using the <tt class="docutils literal"><span class="pre">module</span></tt> method, for example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;chef/knife&#39;</span>
<span class="c1"># other require attributes, as needed</span>

<span class="k">module</span> <span class="nn">MyNamespace</span>
  <span class="k">class</span> <span class="nc">SubclassName</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">module</span> <span class="pre">MyNamespace</span></tt> declares that the Knife plugin has its own namespace, with a namespace of <tt class="docutils literal"><span class="pre">MyNamespace</span></tt>.</p>
</div>
<div class="section" id="class-name">
<h3>Class Name<a class="headerlink" href="#class-name" title="Permalink to this headline">¶</a></h3>
<p>The class name declares a plugin as a subclass of both Knife and Chef. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SubclassName</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">SubclassName</span></tt> is the class name used by this plugin. The capitalization of this name is important. For example, <tt class="docutils literal"><span class="pre">OMG</span></tt> would have a Knife command of <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">o</span> <span class="pre">m</span> <span class="pre">g</span></tt>, whereas <tt class="docutils literal"><span class="pre">Omg</span></tt> would have a Knife command of <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">omg</span></tt>. Use the capitalization pattern to define the word grouping that best makes sense for the plugin.</p>
<p>A plugin can override an existing Knife subcommand by using the same class name as the existing subcommand. For example, to override the current functionality of <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">cookbook</span> <span class="pre">upload</span></tt>, use the following class name:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CookbookUpload</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span>
</pre></div>
</div>
</div>
<div class="section" id="banner">
<h3>Banner<a class="headerlink" href="#banner" title="Permalink to this headline">¶</a></h3>
<p>A banner displays the syntax for the plugin to users when they enter the <tt class="docutils literal"><span class="pre">--help</span></tt> option. Use the <tt class="docutils literal"><span class="pre">banner</span></tt> method in the class body similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">module</span> <span class="nn">example</span>
  <span class="k">class</span> <span class="n">example</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span>

  <span class="n">banner</span> <span class="s2">&quot;knife example&quot;</span>

  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and the when a user enters <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">--help</span></tt>, the following will be displayed:</p>
<div class="highlight-bash"><div class="highlight"><pre>**EXAMPLE COMMANDS**
knife example
</pre></div>
</div>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>The functionality of other Knife plugins can be accessed from a plugin by using the <tt class="docutils literal"><span class="pre">deps</span></tt> method to ensure the necessary files are available. The <tt class="docutils literal"><span class="pre">deps</span></tt> method acts as a lazy loader, ensuring that dependencies are only loaded into Knife when the plugin which requires them is run. Use the following syntax just below the class declaration:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">class</span> <span class="n">subclassName</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span>

<span class="n">deps</span> <span class="k">do</span>
  <span class="nb">require</span> <span class="s1">&#39;chef/knife/name_of_command&#39;</span>
  <span class="nb">require</span> <span class="s1">&#39;chef/search/query&#39;</span>
  <span class="c1"># other dependencies, as needed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the actual path may vary from plugin to plugin, but is typically located in the <tt class="docutils literal"><span class="pre">chef/knife/</span></tt> directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using the <tt class="docutils literal"><span class="pre">deps</span></tt> method instead of <tt class="docutils literal"><span class="pre">require</span></tt> is recommended, especially if the environment in which Knife is being run contains a lot of plugins and/or any of those plugins have a lot of dependencies and/or requirements on other plugins and Chef search functionality.</p>
</div>
<div class="section" id="requirements">
<h4>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<p>The functionality of other Knife plugins can be accessed from a plugin by using the <tt class="docutils literal"><span class="pre">require</span></tt> method to ensure the necessary files are available, and then within the code for the plugin, to create a new object of the class of the plugin to be used.</p>
<p>First, ensure that the correct files are available using the following syntax:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;chef/knife/name_of_command&#39;</span>
</pre></div>
</div>
<p>where the actual path may vary from plugin to plugin, but is typically located in the <tt class="docutils literal"><span class="pre">chef/knife/</span></tt> directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using the <tt class="docutils literal"><span class="pre">deps</span></tt> method instead of <tt class="docutils literal"><span class="pre">require</span></tt> is recommended, especially when the environment in which Knife is being run contains a lot of plugins and/or any of those plugins have a lot of dependencies and/or requirements on other plugins and Chef search functionality.</p>
</div>
<p>For example, use the following to require a plugin named <tt class="docutils literal"><span class="pre">bootstrap</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;chef/knife/bootstrap&#39;</span>
</pre></div>
</div>
<p>Next, for the required plugin, create an object of that plugin, like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">bootstrap</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span><span class="o">::</span><span class="no">Bootstrap</span><span class="o">.</span><span class="n">new</span>
</pre></div>
</div>
<p>and then pass arguments or options to that object. This is done by altering that object&#8217;s <tt class="docutils literal"><span class="pre">config</span></tt> and <tt class="docutils literal"><span class="pre">name_arg</span></tt> variables. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">bootstrap</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:ssh_user</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;myuser&quot;</span>
<span class="n">bootstrap</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:distro</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;ubuntu10.04-gems&quot;</span>
<span class="n">bootstrap</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:use_sudo</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>

<span class="n">bootstrap</span><span class="o">.</span><span class="n">name_args</span> <span class="o">=</span> <span class="s2">&quot;some_host_name&quot;</span>
</pre></div>
</div>
<p>where the available configuration objects vary from plugin to plugin. Make sure those configuration objects are correct by verifying them in the source files for each plugin.</p>
<p>And then call the object&#8217;s <tt class="docutils literal"><span class="pre">run</span></tt> method, like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">bootstrap</span><span class="o">.</span><span class="n">run</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="options">
<h3>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h3>
<p>Command-line options can be added to a Knife plugin using the <tt class="docutils literal"><span class="pre">option</span></tt> method. An option can have a true/false value:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">option</span> <span class="ss">:true_or_false</span><span class="p">,</span>
  <span class="ss">:short</span> <span class="o">=&gt;</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
  <span class="ss">:long</span> <span class="o">=&gt;</span> <span class="s2">&quot;--true-or-false&quot;</span><span class="p">,</span>
  <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;Is this value true? Or is this value false?&quot;</span><span class="p">,</span>
  <span class="ss">:boolean</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="o">|</span> <span class="kp">false</span>
  <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>
</div>
<p>and it can have a string value:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">option</span> <span class="ss">:some_type_of_string_value</span><span class="p">,</span>
  <span class="ss">:short</span> <span class="o">=&gt;</span> <span class="s2">&quot;-s VALUE&quot;</span><span class="p">,</span>
  <span class="ss">:long</span> <span class="o">=&gt;</span> <span class="s2">&quot;--some-type-of-string-value VALUE&quot;</span><span class="p">,</span>
  <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;This is not a random string value.&quot;</span><span class="p">,</span>
  <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="mi">47</span>
</pre></div>
</div>
<p>and can specify code that is run to determine the option&#8217;s value:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">option</span> <span class="ss">:tags</span><span class="p">,</span>
  <span class="ss">:short</span> <span class="o">=&gt;</span> <span class="s2">&quot;-T T=V[,T=V,...]&quot;</span><span class="p">,</span>
  <span class="ss">:long</span> <span class="o">=&gt;</span> <span class="s2">&quot;--tags Tag=Value[,Tag=Value...]&quot;</span><span class="p">,</span>
  <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;A list of tags associated with the virtual machine&quot;</span><span class="p">,</span>
  <span class="ss">:proc</span> <span class="o">=&gt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">tags</span><span class="o">|</span> <span class="n">tags</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>where the Knife command allows a comma-separated list of values and the <tt class="docutils literal"><span class="pre">:proc</span></tt> attribute converts that list of values into an array.</p>
<p>When a user enters <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">--help</span></tt>, the description attributes are displayed as part of the help. Using the previous examples, something like the following will be displayed:</p>
<div class="highlight-bash"><div class="highlight"><pre>**EXAMPLE COMMANDS**
knife example
  -s, --some-type-of-string-value     This is not a random string value.
  -t, --true-or-false                 Is this value <span class="nb">true</span>? Or is this value <span class="nb">false</span>?
  -T, --tags                          A list of tags associated with the virtual machine.
</pre></div>
</div>
<p>When Knife runs the command, the options are parsed from the command-line and make the settings available as a hash that can be used to access the <tt class="docutils literal"><span class="pre">config</span></tt> method. For example, the following option:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">option</span> <span class="ss">:omg</span><span class="p">,</span>
  <span class="ss">:short</span> <span class="o">=&gt;</span> <span class="s1">&#39;-O&#39;</span><span class="p">,</span>
  <span class="ss">:long</span> <span class="o">=&gt;</span> <span class="s1">&#39;--omg&#39;</span><span class="p">,</span>
  <span class="ss">:boolean</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
  <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;I&#39;m so excited!&quot;</span>
</pre></div>
</div>
<p>can be used to update the <tt class="docutils literal"><span class="pre">run</span></tt> method of a class to change its behavior based on the <tt class="docutils literal"><span class="pre">config</span></tt> flag, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">run</span>
  <span class="k">if</span> <span class="n">config</span><span class="o">[</span><span class="ss">:omg</span><span class="o">]</span>
    <span class="c1"># Oh yeah, we are pumped.</span>
    <span class="nb">puts</span> <span class="s2">&quot;OMG HELLO WORLD!!!1!!11&quot;</span>
  <span class="k">else</span>
    <span class="c1"># meh</span>
    <span class="nb">puts</span> <span class="s2">&quot;I am just a boring example.&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>For a Knife plugin with the <tt class="docutils literal"><span class="pre">--omg</span></tt> option, run <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">example</span> <span class="pre">--omg</span></tt> to return something like:</p>
<div class="highlight-bash"><div class="highlight"><pre>OMG HELLO WORLD!!!1!!11
</pre></div>
</div>
<p>or just <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">example</span></tt> to return:</p>
<div class="highlight-bash"><div class="highlight"><pre>I am just a boring example.
</pre></div>
</div>
</div>
<div class="section" id="arguments">
<h3>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h3>
<p>A Knife plugin can also take command-line arguments that are not specified using the <tt class="docutils literal"><span class="pre">option</span></tt> flag, for example: <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">node</span> <span class="pre">show</span> <span class="pre">NODE</span></tt>. These arguments are added using the <tt class="docutils literal"><span class="pre">name_args</span></tt> method. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">banner</span> <span class="s2">&quot;knife hello world WHO&quot;</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="k">unless</span> <span class="n">name_args</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="nb">puts</span> <span class="s2">&quot;You need to say hello to someone!&quot;</span>
    <span class="n">show_usage</span>
    <span class="nb">exit</span> <span class="mi">1</span>
  <span class="k">end</span>

  <span class="n">who</span> <span class="o">=</span> <span class="n">name_args</span><span class="o">.</span><span class="n">first</span>

  <span class="k">if</span> <span class="n">config</span><span class="o">[</span><span class="ss">:omg</span><span class="o">]</span>
    <span class="nb">puts</span> <span class="s2">&quot;OMG HELLO </span><span class="si">#{</span><span class="n">who</span><span class="o">.</span><span class="n">upcase</span><span class="si">}</span><span class="s2">!!!1!!11&quot;</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">&quot;Hello, </span><span class="si">#{</span><span class="n">who</span><span class="o">.</span><span class="n">capitalize</span><span class="si">}</span><span class="s2">!&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">unless</span> <span class="pre">name_args.size</span> <span class="pre">==</span> <span class="pre">1</span></tt> is used to check the number of arguments given; the command should fail if the input does not make sense</li>
<li><tt class="docutils literal"><span class="pre">who</span> <span class="pre">=</span> <span class="pre">name_args.first</span></tt> is used to access arguments using <tt class="docutils literal"><span class="pre">name_args</span></tt></li>
<li><tt class="docutils literal"><span class="pre">show_usage</span></tt> is used to display the correct usage before exiting (if the command fails)</li>
</ul>
<p>For example, the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>knife hello world
</pre></div>
</div>
<p>will return:</p>
<div class="highlight-bash"><div class="highlight"><pre>You need to say hello to someone!
USAGE: knife hello world WHO
</pre></div>
</div>
<p>the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>knife hello world chefs
</pre></div>
</div>
<p>will return:</p>
<div class="highlight-bash"><div class="highlight"><pre>Hello, Chefs!
</pre></div>
</div>
<p>and the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>knife hello world chefs --omg
</pre></div>
</div>
<p>will return:</p>
<div class="highlight-bash"><div class="highlight"><pre>OMG HELLO CHEFS!!!1!!11
</pre></div>
</div>
</div>
<div class="section" id="knife-rb-settings">
<h3>knife.rb Settings<a class="headerlink" href="#knife-rb-settings" title="Permalink to this headline">¶</a></h3>
<p>Certain settings defined by a Knife plugin can be configured so that they can be set using the knife.rb file. This can be done in two ways:</p>
<ul class="simple">
<li>By using the <tt class="docutils literal"><span class="pre">:proc</span></tt> attribute of the <tt class="docutils literal"><span class="pre">option</span></tt> method and code that references <tt class="docutils literal"><span class="pre">Chef::Config[:knife][:setting_name]</span></tt></li>
<li>By specifying the configuration setting directly within the <tt class="docutils literal"><span class="pre">def</span></tt> Ruby blocks using either <tt class="docutils literal"><span class="pre">Chef::Config[:knife][:setting_name]</span></tt> or <tt class="docutils literal"><span class="pre">config[:setting_name]</span></tt></li>
</ul>
<p>An option that is defined in this manner may be configured using the knife.rb file with the following syntax:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">knife</span><span class="o">[</span><span class="ss">:setting_name</span><span class="o">]</span>
</pre></div>
</div>
<p>This approach can be useful when a particular setting is used a lot. The order of precedence for a Knife option is:</p>
<ol class="arabic simple">
<li>A value passed via the command line</li>
<li>A value saved in the knife.rb file</li>
<li>A default value</li>
</ol>
<p>The following example shows how the <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">bootstrap</span></tt> subcommand checks for a value in the knife.rb file by using the <tt class="docutils literal"><span class="pre">:proc</span></tt> attribute:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">option</span> <span class="ss">:ssh_port</span><span class="p">,</span>
  <span class="ss">:short</span> <span class="o">=&gt;</span> <span class="s2">&quot;-p PORT&quot;</span><span class="p">,</span>
  <span class="ss">:long</span> <span class="o">=&gt;</span> <span class="s2">&quot;--ssh-port PORT&quot;</span><span class="p">,</span>
  <span class="ss">:description</span> <span class="o">=&gt;</span> <span class="s2">&quot;The ssh port&quot;</span><span class="p">,</span>
  <span class="ss">:proc</span> <span class="o">=&gt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:knife</span><span class="o">][</span><span class="ss">:ssh_port</span><span class="o">]</span> <span class="o">=</span> <span class="n">key</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">Chef::Config[:knife][:ssh_port]</span></tt> tells Knife to check the knife.rb file for a setting named <tt class="docutils literal"><span class="pre">knife[:ssh_port]</span></tt>.</p>
<p>And the following example shows the <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">bootstrap</span></tt> subcommand calling the <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">ssh</span></tt> subcommand for the actual SSH part of running a bootstrap operation:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">def</span> <span class="nf">knife_ssh</span>
  <span class="n">ssh</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span><span class="o">::</span><span class="no">Ssh</span><span class="o">.</span><span class="n">new</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">ui</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">name_args</span> <span class="o">=</span> <span class="o">[</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">ssh_command</span> <span class="o">]</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:ssh_user</span><span class="o">]</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:knife</span><span class="o">][</span><span class="ss">:ssh_user</span><span class="o">]</span> <span class="o">||</span> <span class="n">config</span><span class="o">[</span><span class="ss">:ssh_user</span><span class="o">]</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:ssh_password</span><span class="o">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">[</span><span class="ss">:ssh_password</span><span class="o">]</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:ssh_port</span><span class="o">]</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:knife</span><span class="o">][</span><span class="ss">:ssh_port</span><span class="o">]</span> <span class="o">||</span> <span class="n">config</span><span class="o">[</span><span class="ss">:ssh_port</span><span class="o">]</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:ssh_gateway</span><span class="o">]</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:knife</span><span class="o">][</span><span class="ss">:ssh_gateway</span><span class="o">]</span> <span class="o">||</span> <span class="n">config</span><span class="o">[</span><span class="ss">:ssh_gateway</span><span class="o">]</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:identity_file</span><span class="o">]</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:knife</span><span class="o">][</span><span class="ss">:identity_file</span><span class="o">]</span> <span class="o">||</span> <span class="n">config</span><span class="o">[</span><span class="ss">:identity_file</span><span class="o">]</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:manual</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:host_key_verify</span><span class="o">]</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:knife</span><span class="o">][</span><span class="ss">:host_key_verify</span><span class="o">]</span> <span class="o">||</span> <span class="n">config</span><span class="o">[</span><span class="ss">:host_key_verify</span><span class="o">]</span>
  <span class="n">ssh</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="ss">:on_error</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:raise</span>
  <span class="n">ssh</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ssh</span> <span class="pre">=</span> <span class="pre">Chef::Knife::Ssh.new</span></tt> creates a new instance of the <tt class="docutils literal"><span class="pre">Ssh</span></tt> subclass named <tt class="docutils literal"><span class="pre">ssh</span></tt></li>
<li>A series of settings in <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">ssh</span></tt> are associated with <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">bootstrap</span></tt> using the  <tt class="docutils literal"><span class="pre">ssh.config[:setting_name]</span></tt> syntax</li>
<li><tt class="docutils literal"><span class="pre">Chef::Config[:knife][:setting_name]</span></tt> tells Knife to check the knife.rb file for various settings</li>
<li>Raises an exception if any aspect of the SSH operation fails</li>
</ul>
</div>
<div class="section" id="search">
<h3>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h3>
<p>Use the Chef search functionality within a plugin to return information about the infrastructure to that plugin. Use the <tt class="docutils literal"><span class="pre">require</span></tt> method to ensure that search functionality is available with the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;chef/search/query&#39;</span>
</pre></div>
</div>
<p>Create a search query object and assign it to a variable:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">variable_name</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Search</span><span class="o">::</span><span class="no">Query</span><span class="o">.</span><span class="n">new</span>
</pre></div>
</div>
<p>After the search object is created it can be used by the plugin to execute search queries for objects on the Chef Server. For example, using a variable named <tt class="docutils literal"><span class="pre">query_nodes</span></tt> a plugin could search for nodes with the <tt class="docutils literal"><span class="pre">webserver</span></tt> role and then return the name of each node found:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;role:webserver&quot;</span>

<span class="n">query_nodes</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">node_item</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;Node Name: </span><span class="si">#{</span><span class="n">node_item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This result can then be used to edit nodes. For example, searching for nodes with the <tt class="docutils literal"><span class="pre">webserver</span></tt> role, and then changing the run_list for those nodes to a role named <tt class="docutils literal"><span class="pre">apache2</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;role:webserver&quot;</span>

<span class="n">query_nodes</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">node_item</span><span class="o">|</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">msg</span> <span class="s2">&quot;Changing the run_list to role[apache2] for </span><span class="si">#{</span><span class="n">node_item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">node_item</span><span class="o">.</span><span class="n">run_list</span><span class="p">(</span><span class="s2">&quot;role[apache2]&quot;</span><span class="p">)</span>
  <span class="n">node_item</span><span class="o">.</span><span class="n">save</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">msg</span> <span class="s2">&quot;New run_list: </span><span class="si">#{</span><span class="n">node_item</span><span class="o">.</span><span class="n">run_list</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>It&#8217;s also possible to specify multiple items to add to the run_list:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">node_item</span><span class="o">.</span><span class="n">run_list</span><span class="p">(</span><span class="s2">&quot;role[apache2]&quot;</span><span class="p">,</span> <span class="s2">&quot;recipe[mysql]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And arguments sent with a plugin command can also be used to search. For example, if the command <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">envchange</span> <span class="pre">&quot;web*&quot;</span></tt> is sent, then the command will search for any nodes in roles beginning with &#8220;web&#8221; and then change their environment to &#8220;web&#8221;:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">module</span> <span class="nn">MyKnifePlugins</span>

  <span class="k">class</span> <span class="nc">Envchange</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span>

    <span class="n">banner</span> <span class="s2">&quot;knife envchange ROLE&quot;</span>

    <span class="n">deps</span> <span class="k">do</span>
      <span class="nb">require</span> <span class="s1">&#39;chef/search/query&#39;</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">run</span>
      <span class="k">if</span> <span class="n">name_args</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">name_args</span><span class="o">.</span><span class="n">first</span>
      <span class="k">else</span>
        <span class="n">ui</span><span class="o">.</span><span class="n">fatal</span> <span class="s2">&quot;Please provide a role name to search for&quot;</span>
        <span class="nb">exit</span> <span class="mi">1</span>
      <span class="k">end</span>

      <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;role:</span><span class="si">#{</span><span class="n">role</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="n">query_nodes</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Search</span><span class="o">::</span><span class="no">Query</span><span class="o">.</span><span class="n">new</span>

      <span class="n">query_nodes</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">node_item</span><span class="o">|</span>
        <span class="n">ui</span><span class="o">.</span><span class="n">msg</span> <span class="s2">&quot;Moving </span><span class="si">#{</span><span class="n">node_item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to the web environment&quot;</span>
        <span class="n">node_item</span><span class="o">.</span><span class="n">chef_environment</span><span class="p">(</span><span class="s2">&quot;web&quot;</span><span class="p">)</span>
        <span class="n">node_item</span><span class="o">.</span><span class="n">save</span>
      <span class="k">end</span>

    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="user-interaction">
<h3>User Interaction<a class="headerlink" href="#user-interaction" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ui</span></tt> object provides a set of methods that can be used to define user interactions and to help ensure a consistent user experience across Knife plugins. The following methods should be used in favor of manually handling user interactions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.ask(*args,</span> <span class="pre">&amp;block)</span></tt></td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.ask_question(question,</span> <span class="pre">opts={})</span></tt></td>
<td>Use to ask a user the question contained in <tt class="docutils literal"><span class="pre">question</span></tt>. If <tt class="docutils literal"><span class="pre">:default</span> <span class="pre">=&gt;</span> <span class="pre">default_value</span></tt> is passed as the second argument, <tt class="docutils literal"><span class="pre">default_value</span></tt> will be used if the user does not provide an answer. This method will respect the <tt class="docutils literal"><span class="pre">--default</span></tt> command-line option.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.color(string,</span> <span class="pre">*colors)</span></tt></td>
<td><p class="first">Use to specify a color. For example, from the <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">rackspace</span> <span class="pre">server</span> <span class="pre">list</span></tt> subcommand:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">server_list</span> <span class="o">=</span> <span class="o">[</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;Instance ID&#39;</span><span class="p">,</span> <span class="ss">:bold</span><span class="p">),</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="ss">:bold</span><span class="p">),</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;Public IP&#39;</span><span class="p">,</span> <span class="ss">:bold</span><span class="p">),</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;Private IP&#39;</span><span class="p">,</span> <span class="ss">:bold</span><span class="p">),</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;Flavor&#39;</span><span class="p">,</span> <span class="ss">:bold</span><span class="p">),</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;Image&#39;</span><span class="p">,</span> <span class="ss">:bold</span><span class="p">),</span>
  <span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="ss">:bold</span><span class="p">)</span>
<span class="o">]</span>
</pre></div>
</div>
<p>and from the <tt class="docutils literal"><span class="pre">knife</span> <span class="pre">eucalyptus</span> <span class="pre">server</span> <span class="pre">create</span></tt> subcommand:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span class="n">server</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">servers</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">server_def</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s2">&quot;Instance ID&quot;</span><span class="p">,</span> <span class="ss">:cyan</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">server</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s2">&quot;Flavor&quot;</span><span class="p">,</span> <span class="ss">:cyan</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">server</span><span class="o">.</span><span class="n">flavor_id</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="ss">:cyan</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">server</span><span class="o">.</span><span class="n">image_id</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s2">&quot;SSH Key&quot;</span><span class="p">,</span> <span class="ss">:cyan</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">server</span><span class="o">.</span><span class="n">key_name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">#{</span><span class="n">ui</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s2">&quot;Waiting for server&quot;</span><span class="p">,</span> <span class="ss">:magenta</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.color?()</span></tt></td>
<td>Indicates that colored output should be used. (Colored output can only be used when output is sent to a terminal.)</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.confirm(question,</span> <span class="pre">append_instructions=true)</span></tt></td>
<td>Use to ask a Y/N question. If the user responds with <tt class="docutils literal"><span class="pre">N</span></tt>, immediately exit with status code 3.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.edit_data(data,</span> <span class="pre">parse_output=true)</span></tt></td>
<td>Use to edit data. This opens the $EDITOR.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.edit_object(klass,</span> <span class="pre">name)</span></tt></td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.error</span></tt></td>
<td>Use to present an error to the user.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.fatal</span></tt></td>
<td>Use to present a fatal error to the user.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.highline</span></tt></td>
<td>Use to provide direct access to the <a class="reference external" href="http://highline.rubyforge.org/doc/">Highline object</a> used by many <tt class="docutils literal"><span class="pre">ui</span></tt> methods.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.info</span></tt></td>
<td>Use to present a message to a user.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.interchange</span></tt></td>
<td>Use to determine if the output is a data interchange format such as JSON or YAML.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.list(*args)</span></tt></td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.msg(message)</span></tt></td>
<td>Use to present a message to the user.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.output(data)</span></tt></td>
<td>Use to present a data structure to the user. This method will respect the output requested when the <tt class="docutils literal"><span class="pre">-F</span></tt> command-line option is used. The output will use the generic default presenter.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.pretty_print(data)</span></tt></td>
<td>Use to enable pretty-print output for JSON data.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">ui.use_presenter(presenter_class)</span></tt></td>
<td>Use to specify a custom output presenter.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ui.warn(message)</span></tt></td>
<td>Use to present a warning to the user.</td>
</tr>
</tbody>
</table>
<p>For example, to show a fatal error in a plugin in the same way that it would be shown in Knife do something similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre> <span class="k">unless</span> <span class="n">name_args</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span>
   <span class="n">ui</span><span class="o">.</span><span class="n">fatal</span> <span class="s2">&quot;Be sure to say hello to someone!&quot;</span>
   <span class="n">show_usage</span>
   <span class="nb">exit</span> <span class="mi">1</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="create-a-plugin">
<h2>Create a Plugin<a class="headerlink" href="#create-a-plugin" title="Permalink to this headline">¶</a></h2>
<p>A Knife command is a Ruby class that inherits from the <tt class="docutils literal"><span class="pre">Chef::Knife</span></tt> class.  A Knife command is run by calling the <tt class="docutils literal"><span class="pre">run</span></tt> method on an instance of the command class. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="k">module</span> <span class="nn">MyKnifePlugins</span>
  <span class="k">class</span> <span class="nc">HelloWorld</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Knife</span>

    <span class="k">def</span> <span class="nf">run</span>
      <span class="nb">puts</span> <span class="s2">&quot;Hello, World!&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and is run from the command line using:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>knife hello world
</pre></div>
</div>
</div>
<div class="section" id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<p>In most cases, the exception handling available within Knife is enough to ensure that exception handling for a plugin is consistent with how Knife ordinarily behaves. That said, exceptions can also be handled within a Knife plugin in the same way they are handled in any Ruby program.</p>
</div>
<div class="section" id="install-a-plugin">
<h2>Install a Plugin<a class="headerlink" href="#install-a-plugin" title="Permalink to this headline">¶</a></h2>
<p>To install a Knife plugin from a file, do one of the following:</p>
<ul class="simple">
<li>Copy the file to the <tt class="docutils literal"><span class="pre">~/.chef/plugins/knife</span></tt> directory; the file&#8217;s extension must be <tt class="docutils literal"><span class="pre">.rb</span></tt></li>
<li>Add the file to the Chef repository at the <tt class="docutils literal"><span class="pre">CHEF_REPO/.chef/plugins/knife</span></tt>; the file&#8217;s extension must be <tt class="docutils literal"><span class="pre">.rb</span></tt></li>
<li>Install the plugin from RubyGems</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="plugin_knife_pushy.html" title="knife pushy"
             >next</a></li>
        <li class="right" >
          <a href="plugin_knife_authenticated_requests.html" title="Authenticated API Requests"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>

          <li><a href="plugin_knife.html" >About Knife Plugins</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>