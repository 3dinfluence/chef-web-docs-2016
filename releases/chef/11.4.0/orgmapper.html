

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>orgmapper &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="next" title="chef-client" href="ctl_chef_client.html" />
    <link rel="prev" title="About Ohai" href="ohai.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="ctl_chef_client.html" title="chef-client"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="ohai.html" title="About Ohai"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">orgmapper</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="orgmapper">
<h1>orgmapper<a class="headerlink" href="#orgmapper" title="Permalink to this headline">¶</a></h1>
<p>orgmapper is a tool that can be used with Private Chef to provide administrative access to back-end objects. orgmapper can be a dangerous tool and should be used carefully. In general, anything that needs to be done around automating user creation, making permissions changes, and so on, can be done more easily using the <tt class="docutils literal"><span class="pre">knife-acl</span></tt> plugin and by using the Private Chef web interface.</p>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The following examples show how to use orgmapper:</p>
<p><strong>Start orgmapper</strong></p>
<p>Log in to the server that is hosting the Private Chef back-end. (In an high availability configuration, this should be the current primary server in that configuration.)</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>/opt/opscode/bin/orgmapper
</pre></div>
</div>
<p>Next, query organizations, users, and so on similar to the following examples</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="n">pp</span> <span class="no">ORGS</span><span class="o">.</span><span class="n">all</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="n">pp</span> <span class="no">ORGS</span><span class="o">[</span><span class="s1">&#39;ORGNAME&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="n">pp</span> <span class="no">USERS</span><span class="o">.</span><span class="n">all</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="n">pp</span> <span class="no">USERS</span><span class="o">[</span><span class="s1">&#39;USER&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>where (in each of the previous examples) <tt class="docutils literal"><span class="pre">ORGNAME</span></tt> is the name of the organization and <tt class="docutils literal"><span class="pre">USER</span></tt> is the name of the user.</p>
<p><strong>Find users in an organization</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="no">OrganizationUser</span><span class="o">.</span><span class="n">users_for_organization</span><span class="p">(</span><span class="no">ORGS</span><span class="o">[</span><span class="s1">&#39;ORGNAME&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">orguser</span><span class="o">|</span>
  <span class="no">Mixlib</span><span class="o">::</span><span class="no">Authorization</span><span class="o">::</span><span class="no">Models</span><span class="o">::</span><span class="no">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orguser</span><span class="p">)</span><span class="o">.</span><span class="n">username</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">ORGNAME</span></tt> is the name of the organization.</p>
<p><strong>Find organizations for a user</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="no">OrganizationUser</span><span class="o">.</span><span class="n">organizations_for_user</span><span class="p">(</span><span class="no">USERS</span><span class="o">[</span><span class="s1">&#39;USERNAME&#39;</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">orguser</span><span class="o">|</span>
  <span class="no">Mixlib</span><span class="o">::</span><span class="no">Authorization</span><span class="o">::</span><span class="no">Models</span><span class="o">::</span><span class="no">Organization</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orguser</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">USERNAME</span></tt> is the name of the user.</p>
<p><strong>Find a user name based on email address</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="no">USERS</span><span class="o">.</span><span class="n">select</span><span class="p">{</span><span class="o">|</span><span class="n">u</span><span class="o">|</span> <span class="n">u</span><span class="o">.</span><span class="n">email</span> <span class="o">==</span> <span class="s1">&#39;user@company.com&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">user&#64;company.com</span></tt> is the email address for the user.</p>
<p><strong>Associate a user to an organization</strong></p>
<p>Ensure that the user and organization already exist and then do something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="no">OrgMapper</span><span class="o">::</span><span class="no">Associator</span><span class="o">.</span><span class="n">associate_user</span><span class="p">(</span><span class="no">ORGS</span><span class="o">[</span><span class="s1">&#39;ORGNAME&#39;</span><span class="o">]</span><span class="p">,</span> <span class="no">USERS</span><span class="o">[</span><span class="s1">&#39;USERNAME&#39;</span><span class="o">]</span><span class="p">)</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">ORGNAME</span></tt> is the name of the organization and <tt class="docutils literal"><span class="pre">USERNAME</span></tt> is the name of the user.</p>
<p><strong>Add a user to organization&#8217;s admin group</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">ORGS</span><span class="o">[</span><span class="s1">&#39;ORGNAME&#39;</span><span class="o">].</span><span class="n">add_user_to_group</span><span class="p">(</span><span class="s1">&#39;USERNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;admins&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">ORGNAME</span></tt> is the name of the organization and <tt class="docutils literal"><span class="pre">USERNAME</span></tt> is the name of the user.</p>
<p><strong>Remove a user from organization&#8217;s admin group</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">ORGS</span><span class="o">[</span><span class="s1">&#39;ORGNAME&#39;</span><span class="o">].</span><span class="n">remove_user_from_group</span><span class="p">(</span><span class="s1">&#39;USERNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;admins&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Delete a user</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="no">USERS</span><span class="o">[</span><span class="s1">&#39;USERNAME&#39;</span><span class="o">]</span>
<span class="n">orgmapper</span><span class="p">:</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="no">USERS</span><span class="o">[</span><span class="s1">&#39;USERNAME&#39;</span><span class="o">].</span><span class="n">destroy</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">USERNAME</span></tt> is replaced by the user name that will be deleted.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="ctl_chef_client.html" title="chef-client"
             >next</a></li>
        <li class="right" >
          <a href="ohai.html" title="About Ohai"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>