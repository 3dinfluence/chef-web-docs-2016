

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>About Templates &mdash; Chef Docs</title>
    
    <link rel="stylesheet" href="_static/opscode.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.1-1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/opscode.ico"/>
    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="next" title="About Versions" href="essentials_cookbook_versions.html" />
    <link rel="prev" title="First-run Resources" href="essentials_cookbook_resources_first_run.html" /> 
  </head>
  <body>
<div style="background-color: #212c35; text-align: left; padding: 0px 0px 0px 0px">
<a href="http://docs.opscode.com/"><img src="_static/opscode_html_logo.png" border="0" alt="Opscode"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="essentials_cookbook_versions.html" title="About Versions"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="essentials_cookbook_resources_first_run.html" title="First-run Resources"
             accesskey="P">previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/opscode_chef_html_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">About Templates</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#variables">Variables</a></li>
<li><a class="reference internal" href="#location-specificity">Location Specificity</a></li>
<li><a class="reference internal" href="#host-notation">Host Notation</a></li>
<li><a class="reference internal" href="#transfer-frequency">Transfer Frequency</a></li>
</ul>
</li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="about-templates">
<h1>About Templates<a class="headerlink" href="#about-templates" title="Permalink to this headline">¶</a></h1>
<p>A cookbook template is a file written in a markup language that allows the contents of a file to be dynamically generated based on variables or complex logic. Templates can contain Ruby expressions and statements. Templates are a great way to manage configuration files across a Chef environment. A template requires a template resource being added to a recipe and then a corresponding erb template being added to a cookbook.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Chef uses Erubis for templates, which is a fast, secure, and extensible implementation of embedded Ruby. Erubis should be familiar to members of the Ruby on Rails, Merb, or Puppet communities. For more information about Erubis, see: <a class="reference external" href="http://www.kuwata-lab.com/erubis/">http://www.kuwata-lab.com/erubis/</a>.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>To use a template, two things must happen:</p>
<ol class="arabic simple">
<li>A template resource must be added to a recipe</li>
<li>An erb template must be added to a cookbook</li>
</ol>
<p>For example, the following template file and template resource settings can be used to manage a configuration file named /etc/sudoers. Within a cookbook that uses Indicates that a bootstrap operation should be executed using sudo., the following resource could be added to recipes/default.rb:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">template</span> <span class="s2">&quot;/etc/sudoers&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;sudoers.erb&quot;</span>
  <span class="n">mode</span> <span class="mo">0440</span>
  <span class="n">owner</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">group</span> <span class="s2">&quot;root&quot;</span>
  <span class="n">variables</span><span class="p">({</span>
     <span class="ss">:sudoers_groups</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="ss">:authorization</span><span class="o">][</span><span class="ss">:sudo</span><span class="o">][</span><span class="ss">:groups</span><span class="o">]</span><span class="p">,</span>
     <span class="ss">:sudoers_users</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="ss">:authorization</span><span class="o">][</span><span class="ss">:sudo</span><span class="o">][</span><span class="ss">:users</span><span class="o">]</span>
  <span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And then create a template called <tt class="docutils literal"><span class="pre">sudoers.erb</span></tt> and save it to <tt class="docutils literal"><span class="pre">templates/default/sudoers.erb</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="c1">#</span>
<span class="c1"># /etc/sudoers</span>
<span class="c1">#</span>
<span class="c1"># Generated by Chef for &lt;%= node[:fqdn] %&gt;</span>
<span class="c1">#</span>

<span class="no">Defaults</span>        <span class="o">!</span><span class="n">lecture</span><span class="p">,</span><span class="n">tty_tickets</span><span class="p">,</span><span class="o">!</span><span class="n">fqdn</span>

<span class="c1"># User privilege specification</span>
<span class="n">root</span>          <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="no">ALL</span>

<span class="o">&lt;</span><span class="sx">% @sudoers_users.each </span><span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="o">-</span><span class="sx">%&gt;</span>
<span class="sx">&lt;%= user %&gt;</span>   <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="o">&lt;</span><span class="sx">%= &quot;NOPASSWD:&quot; if @passwordless %&gt;ALL</span>
<span class="sx">&lt;% end -%&gt;</span>

<span class="sx"># Members of the sysadmin group may gain root privileges</span>
<span class="sx">%sysadmin     ALL=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="o">&lt;</span><span class="sx">%= &quot;NOPASSWD:&quot; if @passwordless %&gt;ALL</span>

<span class="sx">&lt;% @sudoers_groups.each do |group| -%&gt;</span>
<span class="sx"># Members of the group &#39;&lt;%=</span> <span class="n">group</span> <span class="sx">%&gt;&#39; may gain root privileges</span>
<span class="sx">%&lt;%= group %&gt;</span> <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="o">&lt;%=</span> <span class="s2">&quot;NOPASSWD:&quot;</span> <span class="k">if</span> <span class="vi">@passwordless</span> <span class="sx">%&gt;ALL</span>
<span class="sx">&lt;% end -%&gt;</span>
</pre></div>
</div>
<p>And then set the default attributes in attributes/default.rb:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">default</span><span class="o">[</span><span class="s2">&quot;authorization&quot;</span><span class="o">][</span><span class="s2">&quot;sudo&quot;</span><span class="o">][</span><span class="s2">&quot;groups&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;sysadmin&quot;</span><span class="p">,</span><span class="s2">&quot;wheel&quot;</span><span class="p">,</span><span class="s2">&quot;admin&quot;</span> <span class="o">]</span>
<span class="n">default</span><span class="o">[</span><span class="s2">&quot;authorization&quot;</span><span class="o">][</span><span class="s2">&quot;sudo&quot;</span><span class="o">][</span><span class="s2">&quot;users&quot;</span><span class="o">]</span>  <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;jerry&quot;</span><span class="p">,</span><span class="s2">&quot;greg&quot;</span><span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="variables">
<h2>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h2>
<p>A Chef template is an erb template. An erb template allows Ruby code to be embedded inside a text file within specially formatted tags. Ruby code can be embedded using expressions and statements. An expression is delimited by <tt class="docutils literal"><span class="pre">&lt;%=</span></tt> and <tt class="docutils literal"><span class="pre">%&gt;</span></tt>. For example:</p>
<div class="highlight-python"><pre>``&lt;%= "my name is #{$ruby}" %&gt;``</pre>
</div>
<p>A statement is delimited by <tt class="docutils literal"><span class="pre">&lt;%</span></tt> and <tt class="docutils literal"><span class="pre">-%&gt;</span></tt>. For example:</p>
<div class="highlight-python"><pre>if false
   # this won't happen
elsif nil
   # this won't either
else
   # code here will run though
end</pre>
</div>
<p>Using a Ruby expression is the most common approach because this is how all variables sent to a template are referenced. Whenever a template needs to use an <tt class="docutils literal"><span class="pre">each</span></tt>, <tt class="docutils literal"><span class="pre">if</span></tt>, or <tt class="docutils literal"><span class="pre">end</span></tt>, use a Ruby statement.</p>
<p>When a template is rendered, Ruby expressions and statements are evaluated by Chef. The variables listed in the resource&#8217;s variables attribute and the node object are identified. Chef then passes these variables to the template, where they will be accessible as instance variables within the template; a node object can be accessed just as if it were part of a recipe, using the same node.</p>
<p>For example, a simple template resource like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">node</span><span class="o">[</span><span class="ss">:fqdn</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;latte&quot;</span>
<span class="n">template</span> <span class="s2">&quot;/tmp/foo&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;foo.erb&quot;</span>
  <span class="n">variables</span><span class="p">({</span>
    <span class="ss">:x_men</span> <span class="o">=&gt;</span> <span class="s2">&quot;are keen&quot;</span>
  <span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And a simple erb template like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="no">The</span> <span class="n">node</span> <span class="o">&lt;</span><span class="sx">%= node[:fqdn] %&gt; thinks the x-men &lt;%=</span> <span class="vi">@x_men</span> <span class="o">%&gt;</span>
</pre></div>
</div>
<p>Would render something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="no">The</span> <span class="n">node</span> <span class="n">latte</span> <span class="n">thinks</span> <span class="n">the</span> <span class="n">x</span><span class="o">-</span><span class="n">men</span> <span class="n">are</span> <span class="n">keen</span>
</pre></div>
</div>
<p>Even though this is a very simple example, the full capabilities of Ruby can be used to tackle even the most complex and demanding template requirements.</p>
</div>
<div class="section" id="location-specificity">
<h2>Location Specificity<a class="headerlink" href="#location-specificity" title="Permalink to this headline">¶</a></h2>
<p>A cookbook will frequently be designed to work across many platforms. A template often needs to be specific to a platform, host, or function of a node. When these differences are minor, they can often be handled with a small amount of logic within the template itself. When these differences are significant, a cookbook can be designed to use many templates. Chef will determine the correct template based on the rules that are provided to it.</p>
<p>For example, a cookbook that has a directory structure like this:</p>
<div class="highlight-python"><pre>templates/
   host-foo.example.com
   ubuntu-8.04
   ubuntu
   default</pre>
</div>
<p>would be matched in the same order. For a node named &#8220;foo.example.com&#8221; and resource named <tt class="docutils literal"><span class="pre">sudoers.erb</span></tt>, matching would occur in the following order:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="n">host</span><span class="o">-</span><span class="n">foo</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">sudoers</span><span class="o">.</span><span class="n">erb</span>
<span class="n">ubuntu</span><span class="o">-</span><span class="mi">8</span><span class="o">.</span><span class="mo">04</span><span class="o">/</span><span class="n">sudoers</span><span class="o">.</span><span class="n">erb</span>
<span class="n">ubuntu</span><span class="o">/</span><span class="n">sudoers</span><span class="o">.</span><span class="n">erb</span>
<span class="n">default</span><span class="o">/</span><span class="n">sudoers</span><span class="o">.</span><span class="n">erb</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">sudoers.rb</span></tt> resource was placed under the <tt class="docutils literal"><span class="pre">files/host-foo.example.com/</span></tt> directory, then it would only be copied to a machine with the domain name <tt class="docutils literal"><span class="pre">foo.example.com</span></tt>.</p>
<p>So, the rule distilled:</p>
<ol class="arabic simple">
<li>host-node[:fqdn]</li>
<li>node[:platform]-node[:platform_version]</li>
<li>node[:platform]</li>
<li>default</li>
</ol>
<p>where <tt class="docutils literal"><span class="pre">default</span></tt> does not refer to a recipe in <tt class="docutils literal"><span class="pre">default.rb</span></tt>. Templates are not split up into different directories by a recipe.</p>
</div>
<div class="section" id="host-notation">
<h2>Host Notation<a class="headerlink" href="#host-notation" title="Permalink to this headline">¶</a></h2>
<p>The naming of folders within cookbook directories must literally match the host notation used for template specificity matching. For example, if a host is named <tt class="docutils literal"><span class="pre">foo.example.com</span></tt>, then the folder must be named <tt class="docutils literal"><span class="pre">host-foo.example.com</span></tt>.</p>
</div>
<div class="section" id="transfer-frequency">
<h2>Transfer Frequency<a class="headerlink" href="#transfer-frequency" title="Permalink to this headline">¶</a></h2>
<p>Chef caches a template when it is first requested. On each subsequent request for that template, Chef compares that request to the template located on the Chef Server. If the templates are the same, no transfer occurs.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="essentials_cookbook_versions.html" title="About Versions"
             >next</a></li>
        <li class="right" >
          <a href="essentials_cookbook_resources_first_run.html" title="First-run Resources"
             >previous</a> |</li>
        <li><a href="http://docs.opscode.com/chef/knife.html" target="_products">Knife</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/resources.html" target="_products">Resources</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/dsl_recipe.html" target="_products">Recipe DSL</a>&#149;</li>
        <li><a href="http://docs.opscode.com/chef/lwrps_custom.html" target="_products">LWRPs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/search.html">Search the Docs</a>&#149;</li>
        <li><a href="http://docs.opscode.com/">Home</a> &raquo;</li>
 
      </ul>
    </div>

    <div class="footer">
    This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>


    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution 3.0 Unported License.
    </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_setAccount', 'UA-6369228-7']);
_gaq.push(['_setDomainName', '.opscode.com']);
_gaq.push(['_setAllowHash', false]);
_gaq.push(['_setAllowLinker', true]);
_gaq.push(['_addIgnoredRef','opscode.com']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Async HubSpot Analytics Code -->
<script type="text/javascript">
(function(d,s,i,r) {
            if (d.getElementById(i)){return;}
            var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
            n.id=i;n.src='//js.hubspot.com/analytics/'+(Math.ceil(new Date()/r)*r)+'/57718.js';
            e.parentNode.insertBefore(n, e);
        })(document,"script","hs-analytics",300000);
    </script>
<!-- End of Async HubSpot Analytics Code -->

<!-- Start of Contact Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Contact Analytics Code -->


  </body>
</html>